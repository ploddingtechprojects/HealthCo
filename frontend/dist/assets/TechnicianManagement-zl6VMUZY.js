import{r as e,j as i,p as a,aR as n,T as t,aj as s,aP as r,U as l,aL as c,c as o,a9 as d,aM as u,f as m,a8 as h,g as p,F as f,am as x,G as y,ac as v,o as g,ad as b,ae as j,d as S,az as T,aS as k,B as w,m as C,y as I,S as N,k as D,al as E,e as W,aQ as q}from"./index-DyR0ftVW.js";import{C as A,D as z,a as O}from"./CommonCard-C_xn2Pzb.js";import{D as P}from"./DeleteConfirmationDialog-DKqJK7p7.js";import{M as L}from"./ManagementHeader-ym6m9w7H.js";import{u as M}from"./useClinicSync-pPWROp7F.js";import{g as B,d as F}from"./technician-CQyKWYBS.js";import{T as H,C as $,S as R}from"./TruncateTooltip-BVddiBa5.js";import{E as U}from"./EditButton-Dv5A9b9C.js";import{I as V}from"./AntdIcon-2OxomVw-.js";import{C as G}from"./CommonCheckbox-aJ2wZ0C8.js";import{W as Y}from"./WorkingHoursSelector-DrZf68YU.js";import{formatDateISO as Q}from"./appointmentLogic-ihgp36Gl.js";import"./Tooltip-Cof9Jr1h.js";import"./EditOutlined-CjO-a_sD.js";import"./WarningOutlined-Pm6jC2mV.js";import"./DialogActions-BmwBtQrJ.js";const _={sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6},K={FullTime:1,PartTime:2,Trainee:3};var X={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"}}]},name:"mail",theme:"outlined"};function Z(){return Z=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Z.apply(this,arguments)}const J=(i,a)=>e.createElement(V,Z({},i,{ref:a,icon:X})),ee=e.forwardRef(J);var ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M877.1 238.7L770.6 132.3c-13-13-30.4-20.3-48.8-20.3s-35.8 7.2-48.8 20.3L558.3 246.8c-13 13-20.3 30.5-20.3 48.9 0 18.5 7.2 35.8 20.3 48.9l89.6 89.7a405.46 405.46 0 01-86.4 127.3c-36.7 36.9-79.6 66-127.2 86.6l-89.6-89.7c-13-13-30.4-20.3-48.8-20.3a68.2 68.2 0 00-48.8 20.3L132.3 673c-13 13-20.3 30.5-20.3 48.9 0 18.5 7.2 35.8 20.3 48.9l106.4 106.4c22.2 22.2 52.8 34.9 84.2 34.9 6.5 0 12.8-.5 19.2-1.6 132.4-21.8 263.8-92.3 369.9-198.3C818 606 888.4 474.6 910.4 342.1c6.3-37.6-6.3-76.3-33.3-103.4zm-37.6 91.5c-19.5 117.9-82.9 235.5-178.4 331s-213 158.9-330.9 178.4c-14.8 2.5-30-2.5-40.8-13.2L184.9 721.9 295.7 611l119.8 120 .9.9 21.6-8a481.29 481.29 0 00285.7-285.8l8-21.6-120.8-120.7 110.8-110.9 104.5 104.5c10.8 10.8 15.8 26 13.3 40.8z"}}]},name:"phone",theme:"outlined"};function ae(){return ae=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},ae.apply(this,arguments)}const ne=(i,a)=>e.createElement(V,ae({},i,{ref:a,icon:ie})),te=e.forwardRef(ne),se=({technician:c,onEdit:o,onDelete:d,onToggleActive:u,setVacationModalOpen:m,setSelectedTechnician:h,setTechnicianNewStatus:p})=>{var f,x;const y=localStorage.getItem("userRole")===l.CLINIC_STAFF_MEMBER;null==(f=c.workingHours)||f.length;const v=c.qualifications||[],g=v.slice(0,3),b=v.length-g.length,[j,S]=e.useState(!1),[T,k]=e.useState(!1);return e.useEffect(()=>{const e=window.matchMedia("(hover: hover) and (pointer: fine)");k(e.matches);const i=e=>k(e.matches);return e.addEventListener("change",i),()=>e.removeEventListener("change",i)},[]),i.jsxs(A,{sx:{minWidth:"220px",width:"100%",p:2.5,cursor:"pointer"},onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),onClick:()=>o&&o(c),children:[i.jsxs(a,{sx:{display:"flex",alignItems:"center",mb:1},children:[i.jsx(a,{sx:{background:"#ebf1fd",borderRadius:"10px",p:2,display:"flex",alignItems:"center",justifyContent:"center",mr:2},children:i.jsx(n,{color:"#3c84f6",size:22})}),i.jsxs(a,{sx:{display:"flex",flexDirection:"column",flex:1,minWidth:0},children:[i.jsx(H,{title:c.fullName,children:i.jsx(t,{variant:"subtitle1",sx:{fontWeight:600,fontSize:"15px",color:"#111928",lineHeight:1.1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:c.fullName})}),i.jsx(H,{title:c.specialization,children:i.jsx(t,{variant:"body2",sx:{color:"#6c7a89",fontWeight:500,fontSize:"13px",maxWidth:140,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:c.specialization})})]}),i.jsx(a,{sx:{display:"flex",gap:.25,alignItems:"center",position:"relative"},children:i.jsxs(a,{sx:{display:"flex",gap:.25,alignItems:"center",transition:"opacity 0.25s cubic-bezier(0.4,0,0.2,1)",opacity:T?j?1:0:1,pointerEvents:T?j?"auto":"none":"auto"},onClick:e=>e.stopPropagation(),children:[!y&&i.jsx(U,{onEdit:()=>o(c)}),!y&&i.jsx(z,{onDelete:()=>d(c.technicianId)})]})}),i.jsx(s,{size:"small",checked:c.isActive,onChange:e=>{e.target.checked?u(c.technicianId,!0):(h(c),p(!1),m(!0))},onClick:e=>e.stopPropagation(),inputProps:{"aria-label":"toggle technician"}})]}),i.jsx(a,{sx:{mb:1,mt:1},children:i.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:.5},children:[i.jsx($,{backgroundColor:"#f3f4f6",color:"#374151",fontSize:"10px",children:c.category||"No Category"}),c.licenseNumber&&i.jsx(H,{title:`License: ${c.licenseNumber}`,children:i.jsx($,{backgroundColor:"#fef3c7",color:"#92400e",fontSize:"10px",wrap:!0,children:`License: ${c.licenseNumber}`})})]})}),i.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:.5,mb:1,mt:1},children:[i.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%",minWidth:0},children:[i.jsx(ee,{style:{fontSize:"13px",color:"#6b7280",flexShrink:0}}),i.jsx(t,{sx:{color:"#6b7280",fontSize:"12px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,minWidth:0},children:c.email})]}),i.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%",minWidth:0},children:[i.jsx(te,{style:{fontSize:"13px",color:"#6b7280",flexShrink:0}}),i.jsx(t,{sx:{color:"#6b7280",fontSize:"12px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,minWidth:0},children:c.phoneNumber||c.PhoneNumber})]})]}),i.jsx(r,{sx:{mb:1}}),i.jsxs(a,{sx:{mb:1},children:[i.jsx(t,{sx:{fontWeight:500,fontSize:"13px",color:"#111928",mb:.5},children:"Working Days"}),(null==(x=c.workingHours)?void 0:x.length)>0?i.jsx(a,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:c.workingHours.filter(e=>e.isAvailable).sort((e,i)=>{const a=e=>{let i=e.dayOfWeek??e.DayOfWeek;if("string"==typeof i){i={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,tues:2,wednesday:3,wed:3,thursday:4,thu:4,thurs:4,friday:5,fri:5,saturday:6,sat:6}[i.toLowerCase()]??0}return i="number"==typeof i?i:0,0===i?6:i-1};return a(e)-a(i)}).map((e,a)=>{const n="number"==typeof e.dayOfWeek?["SUN","MON","TUE","WED","THU","FRI","SAT"][e.dayOfWeek]:(e.dayOfWeek||e.DayOfWeek||"Unknown").slice(0,3).toUpperCase();return i.jsx($,{backgroundColor:"#dcfce7",color:"#166534",children:n},`${(null==c?void 0:c.technicianId)??"tech"}-wh-${(null==e?void 0:e.dayOfWeek)??(null==e?void 0:e.DayOfWeek)??a}`)})}):i.jsx(t,{sx:{color:"#6b7280",fontSize:"11px"},children:"No working days set"})]}),i.jsxs(a,{sx:{flexGrow:1},children:[i.jsx(t,{sx:{fontWeight:500,fontSize:"13px",color:"#111928",mb:.5},children:"Qualifications"}),v.length>0?i.jsxs(a,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[g.map((e,a)=>i.jsx($,{backgroundColor:"#f0f9ff",color:"#0369a1",children:e.scanTypeName||e.serviceName||"Qualification"},(null==e?void 0:e.scanTypeId)??(null==e?void 0:e.serviceId)??`${(null==c?void 0:c.technicianId)??"tech"}-qual-${a}`)),b>0&&i.jsx($,{backgroundColor:"#f0f9ff",color:"#0369a1",children:`+${b} more`},`more-${(null==c?void 0:c.technicianId)??"tech"}`)]}):i.jsx(a,{sx:{textAlign:"center",py:1,border:"1px dashed #e5e7eb",borderRadius:"8px",backgroundColor:"#f9fafb"},children:i.jsx(t,{sx:{color:"#6b7280",fontWeight:500,fontSize:"12px"},children:"No qualifications added yet"})})]})]})},re=[{label:"Monday",key:"Monday"},{label:"Tuesday",key:"Tuesday"},{label:"Wednesday",key:"Wednesday"},{label:"Thursday",key:"Thursday"},{label:"Friday",key:"Friday"},{label:"Saturday",key:"Saturday"},{label:"Sunday",key:"Sunday"}],le={SUNDAY:0,MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5,SATURDAY:6},ce={fullName:"",specialization:"",phone:"",licenseNumber:"",gender:"",providesMalePatientService:!1,providesFemalePatientService:!1,dailyServiceLimit:10,preventBackToBackComplexSubServices:!0,qualifications:[],workingHours:re.reduce((e,i)=>(e[i.key]={available:!1,startTime:"08:00",endTime:"17:00"},e),{}),category:1},oe=({open:n,onClose:N,onSubmit:D,initialData:E,clinicId:W,onCancel:q})=>{const[A,z]=e.useState({}),[O,P]=e.useState(!1),[L,M]=e.useState([]),B=e.useRef(null),F=!(!E||!E.technicianId),U=F?"Edit Technician":"Add New Technician",V=F?"Update Technician":"Add Technician",Q=c(),X=!((null==Q?void 0:Q.role)===l.CLINIC_STAFF_MEMBER)||!F;e.useEffect(()=>{n&&(async()=>{try{const e=await C.get("https://healthco.clinic/api/fhir/Practitioner/"),i=Array.isArray(e.data)?e.data:[];M(i)}catch(e){M([])}})()},[n]),e.useEffect(()=>{const e=e=>{const i={};e.forEach(e=>{const a=e.serviceName;i[a]||(i[a]=[]),e.scanTypes.forEach(n=>{i[a].push({key:n.scanTypeId.toString(),name:`${n.name} (${n.durationMinutes}min)`,scanTypeId:n.scanTypeId,scanTypeName:n.name,serviceId:e.serviceId,serviceName:a,...n})})}),z(i)};W&&(async()=>{const i=`https://healthco.clinic/api/api/services/clinic/${W}`;try{const a=await fetch(i);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const n=await a.json();e(n)}catch(a){}})()},[W]);const Z=e.useMemo(()=>o().shape({fullName:m().required("Full name is required").min(2,"Full name must be at least 2 characters"),email:p({requiredMessage:"Email is required",invalidMessage:"Invalid email format"}).test("unique-email","Email already exists",function(e){if(!e)return!0;return!L.find(i=>i.email.toLowerCase()===e.toLowerCase()&&(!F||i.technicianId!==(null==E?void 0:E.technicianId)))}),phone:h({}),gender:m().required("Gender is required").oneOf(["Male","Female"],"Please select a valid gender"),specialization:m().required("Specialization is required").min(2,"Specialization must be at least 2 characters"),qualifications:u().min(1,"Select at least one qualification").test("has-qualifications","Select at least one qualification",function(e){return Array.isArray(e)&&e.length>0}),dailyServiceLimit:d().required("Daily service limit is required").min(0,"Daily service limit cannot be less than 0").max(99999,"Daily service limit cannot exceed 99999"),category:d().required("Category is required").oneOf([1,2,3],"Please select a valid category"),workingHours:o().test("at-least-one-day","Select at least one working day",function(e){return!(!e||"object"!=typeof e)&&Object.values(e).some(e=>e&&!0===e.available)})}),[L,F,E]);e.useEffect(()=>{var e,i;if(!n||!B.current||!Object.keys(A).length)return;const a=B.current;if(!(null==(i=null==(e=null==a?void 0:a.values)?void 0:e.qualifications)?void 0:i.length))return;const t={};Object.values(A).forEach(e=>{e.forEach(e=>{t[e.scanTypeId]=e})});let s=!1;const r=a.values.qualifications.map(e=>{const i=t[e.scanTypeId];if(!i)return e;const a=!e.serviceName||/^Service \d+$/i.test(e.serviceName)||/^Unknown Service/i.test(e.serviceName),n=!e.scanTypeName||/^Scan Type \d+$/i.test(e.scanTypeName)||/^Unknown Scan/i.test(e.scanTypeName);return a||n?(s=!0,{...e,serviceName:i.serviceName,scanTypeName:i.scanTypeName}):e});s&&a.setFieldValue("qualifications",r,!1)},[A,n]);const J=e.useMemo(()=>{return{...ce,...E,phone:(null==E?void 0:E.phone)||(null==E?void 0:E.phoneNumber)||(null==E?void 0:E.PhoneNumber)||"",category:"string"==typeof(null==E?void 0:E.category)?(e=E.category,K[e]||1):(null==E?void 0:E.category)||1,qualifications:((null==E?void 0:E.qualifications)||[]).map(e=>({...e,serviceName:e.serviceName||`Service ${e.serviceId}`||"Unknown Service",scanTypeName:e.scanTypeName||`Scan Type ${e.scanTypeId}`||"Unknown Scan",isDedicated:e.isDedicated??e.IsDedicated??!1})),workingHours:(()=>{let e={};return(null==E?void 0:E.workingHours)&&Array.isArray(E.workingHours)&&E.workingHours.forEach(i=>{const a=i.dayOfWeek||Object.keys(le).find(e=>le[e]===i.DayOfWeek);if(a){const n=(e,i=!0)=>{if(!e)return i?"08:00":"17:00";if("string"==typeof e){if(e.match(/^\d{2}:\d{2}$/))return e;if(e.match(/^\d{2}:\d{2}:\d{2}/))return e.substring(0,5)}return i?"08:00":"17:00"};e[a]={technicianWorkingHourId:i.technicianWorkingHourId,available:i.isAvailable,startTime:n(i.startTime,!0),endTime:n(i.endTime,!1)}}}),re.forEach(i=>{e[i.key]||(e[i.key]={available:!1,startTime:"08:00",endTime:"17:00"})}),e})()};var e},[E]);return i.jsx(f,{innerRef:B,initialValues:J,validationSchema:Z,initialTouched:{},onSubmit:async(e,{resetForm:i})=>{var a;P(!0);try{const a={};Object.values(A).forEach(e=>{e.forEach(e=>{a[e.scanTypeId]=e})});const n=e.qualifications.map(e=>{const i=a[e.scanTypeId];return{technicianQualificationId:e.technicianQualificationId||0,serviceId:e.serviceId||(null==i?void 0:i.serviceId)||0,serviceName:(null==i?void 0:i.serviceName)||e.serviceName||"",scanTypeId:e.scanTypeId,scanTypeName:(null==i?void 0:i.scanTypeName)||e.scanTypeName||"",isDedicated:e.isDedicated||!1}}),t={...F&&(null==E?void 0:E.technicianId)?{technicianId:E.technicianId}:{},fullName:e.fullName,clinicId:W||0,email:e.email,phone:e.phone,gender:e.gender,specialization:e.specialization,category:e.category||1,licenseNumber:e.licenseNumber,providesMalePatientService:e.providesMalePatientService,providesFemalePatientService:e.providesFemalePatientService,dailyServiceLimit:e.dailyServiceLimit??10,preventBackToBackComplexSubServices:e.preventBackToBackComplexSubServices??!0,technicianQualification:n,workingHours:Object.entries(e.workingHours).map(([e,i])=>({technicianWorkingHourId:i.technicianWorkingHourId||0,dayOfWeek:_[e.toLowerCase()],isAvailable:i.available,startTime:i.available&&i.startTime?`${i.startTime}:00`:null,endTime:i.available&&i.endTime?`${i.endTime}:00`:null}))};let s,r="https://healthco.clinic/api/fhir/Practitioner";F&&(null==E?void 0:E.technicianId)?(r=`https://healthco.clinic/api/fhir/Practitioner/${E.technicianId}`,s=await C.put(r,t)):s=await C.post(r,t),D&&await D(s.data),i(),N()}catch(n){let e="An unexpected error occurred. Please try again.";if(null==(a=n.response)?void 0:a.data){const i=n.response.data;if(i.detail&&"string"==typeof i.detail)e=i.detail;else if(i.message&&"string"==typeof i.message)e=i.message;else if(i.errors){const a=[];for(const[e,n]of Object.entries(i.errors))Array.isArray(n)?a.push(...n):a.push(n);e=a.join(", ")}else if("string"==typeof i)e=i;else if(i.title&&"string"==typeof i.title){e=["Technician","Account.AlreadyExists","Validation Failed","Update Failed","Error","Conflict","BadRequest","NotFound"].includes(i.title)&&i.detail||i.detail?i.detail:i.title.replace(/([A-Z])/g," $1").trim()}}else n.message&&(e=n.message);I.error(e)}finally{P(!1)}},enableReinitialize:!0,validateOnMount:!1,validateOnChange:!0,validateOnBlur:!0,children:({values:e,errors:l,touched:c,handleChange:o,handleBlur:d,handleSubmit:u,isValid:m,dirty:h,isSubmitting:p,setFieldValue:f,setFieldTouched:C,resetForm:I,submitCount:D,validateForm:E})=>{const q=e=>c&&c[e]||D>0;return i.jsxs(x,{open:n,onClose:()=>{I(),N()},title:U,maxWidth:"md",onSubmit:u,submitLabel:O?"Processing...":V,disableSubmit:p||O||!W||D>0&&!m,loading:O,showActions:X,customActions:X?void 0:i.jsx(a,{sx:{display:"flex",justifyContent:"flex-end",gap:1.5,mt:1},children:i.jsx(w,{onClick:()=>{I(),N()},sx:{textTransform:"none",color:"#6b7280",borderRadius:"8px",px:3,py:1.5,"&:hover":{backgroundColor:"rgba(59, 130, 246, 0.1)",color:"#2563eb"}},children:"Close"})}),children:[i.jsx("div",{style:{paddingTop:"6px"}}),i.jsxs(y,{container:!0,spacing:3,children:[i.jsx(y,{item:!0,xs:12,sm:6,children:i.jsx(v,{label:"Full Name",required:!0,name:"fullName",placeholder:"Enter full name",value:e.fullName,onChange:o,onBlur:d,error:c.fullName&&l.fullName?l.fullName:""})}),i.jsx(y,{item:!0,xs:12,sm:6,children:i.jsx(v,{label:"Specialization",required:!0,name:"specialization",placeholder:"Enter specialization",value:e.specialization,onChange:o,onBlur:d,error:c.specialization&&l.specialization?l.specialization:""})}),i.jsx(y,{item:!0,xs:12,sm:6,children:i.jsx(v,{label:"Email",required:!0,name:"email",type:"email",placeholder:"Enter email address",value:e.email,onChange:o,onBlur:d,disabled:F,error:(D>0||c.email)&&l.email?l.email:""})}),i.jsx(y,{item:!0,xs:12,sm:6,children:i.jsx(v,{label:"Phone",required:!0,name:"phone",placeholder:"Enter phone number",value:e.phone,onChange:e=>{const i=(e.target.value||"").replace(/\D/g,"").slice(0,10);f("phone",i)},onBlur:d,inputProps:{maxLength:25},error:c.phone&&l.phone?l.phone:""})}),i.jsx(y,{item:!0,xs:12,sm:4,children:i.jsx(v,{label:"License Number",name:"licenseNumber",placeholder:"Enter license number",value:e.licenseNumber,onChange:o,onBlur:d,error:c.licenseNumber&&l.licenseNumber?l.licenseNumber:""})}),i.jsx(y,{item:!0,xs:12,sm:4,minWidth:195,children:i.jsx(v,{label:"Gender",required:!0,error:c.gender&&l.gender?l.gender:"",children:i.jsx(g,{fullWidth:!0,size:"medium",error:Boolean(c.gender&&l.gender),children:i.jsxs(b,{name:"gender",value:e.gender,onChange:o,onBlur:d,sx:{borderRadius:2,background:"#fff"},displayEmpty:!0,children:[i.jsx(j,{value:"",disabled:!0,children:i.jsx("span",{style:{color:"#9ca3af"},children:"Select Gender"})}),i.jsx(j,{value:"Male",children:"Male"}),i.jsx(j,{value:"Female",children:"Female"})]})})})}),i.jsx(y,{item:!0,xs:12,sm:4,minWidth:195,children:i.jsx(v,{label:"Technician Category",required:!0,error:c.category&&l.category?l.category:"",children:i.jsx(g,{fullWidth:!0,size:"medium",error:Boolean(c.category&&l.category),children:i.jsxs(b,{name:"category",value:e.category,onChange:o,onBlur:d,sx:{borderRadius:2,background:"#fff"},displayEmpty:!0,children:[i.jsx(j,{value:"",disabled:!0,children:i.jsx("span",{style:{color:"#9ca3af"},children:"Select Category"})}),i.jsx(j,{value:1,children:"Full Time"}),i.jsx(j,{value:2,children:"Part Time"}),i.jsx(j,{value:3,children:"Trainee"})]})})})})]}),i.jsx(r,{sx:{my:3}}),i.jsx(t,{variant:"h6",sx:{mb:1,color:"#333",fontWeight:600},children:"Scan Performance Capabilities (optional)"}),i.jsxs(y,{container:!0,spacing:2,children:[i.jsx(y,{item:!0,xs:12,sm:6,children:i.jsx(S,{control:i.jsx(s,{checked:e.providesMalePatientService,onChange:()=>f("providesMalePatientService",!e.providesMalePatientService)}),label:"Can perform Gender sensitive scans for Male Patients"})}),i.jsx(y,{item:!0,xs:12,sm:6,children:i.jsx(S,{control:i.jsx(s,{checked:e.providesFemalePatientService,onChange:()=>f("providesFemalePatientService",!e.providesFemalePatientService)}),label:"Can perform Gender sensitive scans for Female Patients"})})]}),i.jsx(r,{sx:{my:3}}),i.jsx(t,{variant:"h6",sx:{mb:1,color:"#333",fontWeight:600},children:"Service Limits & Scheduling (optional)"}),i.jsxs(y,{container:!0,spacing:3,sx:{mt:1},children:[i.jsx(y,{item:!0,xs:12,sm:6,children:i.jsx(v,{label:"Daily Complex Scan Limit",required:!0,name:"dailyServiceLimit",type:"number",value:e.dailyServiceLimit??10,onChange:o,onBlur:d,inputProps:{min:0,max:999,step:1},error:c.dailyServiceLimit&&l.dailyServiceLimit?l.dailyServiceLimit:""})}),i.jsxs(y,{item:!0,xs:12,sm:6,children:[i.jsx(S,{control:i.jsx(s,{checked:e.preventBackToBackComplexSubServices,onChange:()=>f("preventBackToBackComplexSubServices",!e.preventBackToBackComplexSubServices)}),label:"Prevent Back-to-Back Complex Services",sx:{mt:2}}),i.jsx(t,{variant:"caption",sx:{display:"block",color:"#666",mt:.5},children:"When enabled, prevents scheduling complex services consecutively"})]})]}),i.jsx(r,{sx:{my:3}}),i.jsx(t,{variant:"h6",sx:{mb:1,color:"#333",fontWeight:600},children:"Qualifications"}),i.jsx(t,{variant:"body2",sx:{mb:3,color:"#666"},children:"Select which scan types this technician is qualified to perform"}),q("qualifications")&&l.qualifications&&i.jsx(t,{variant:"body2",sx:{mb:2,color:"#d32f2f"},children:l.qualifications}),i.jsx(y,{container:!0,spacing:3,children:Object.entries(A).filter(([e,i])=>i.length>0).map(([n,s])=>(s.length,i.jsx(y,{item:!0,xs:12,sm:6,children:i.jsxs(T,{variant:"outlined",sx:{padding:"20px",borderRadius:"12px",border:"1.5px solid #e5e7eb",boxShadow:"0 2px 8px 0 rgba(0,0,0,0.04)",backgroundColor:"#fff",width:"100%",display:"flex",flexDirection:"column",transition:"box-shadow 0.35s cubic-bezier(.4,0,.2,1), border-color 0.35s cubic-bezier(.4,0,.2,1), transform 0.35s cubic-bezier(.4,0,.2,1)",cursor:"pointer","&:hover":{boxShadow:"0 16px 48px 0 rgba(60,72,88,0.30)",borderColor:"#2563eb",transform:"translateY(-2px) scale(1.02)"},"&:active":{boxShadow:"0 4px 12px 0 rgba(60,72,88,0.12)",borderColor:"#3b82f6"}},children:[i.jsx(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:i.jsx(H,{title:n,children:i.jsx(t,{sx:{fontWeight:700},children:n})})}),i.jsx(r,{sx:{mb:1}}),i.jsx(R,{sx:{display:"flex",flexDirection:"column",gap:1,minHeight:200,maxHeight:200},overflowY:"auto",overflowX:"hidden",children:i.jsx(k,{sx:{mt:0},children:s.map(n=>{const s=(e.qualifications||[]).some(e=>e.scanTypeId===n.scanTypeId),r=(e.qualifications||[]).find(e=>e.scanTypeId===n.scanTypeId);let l=null,c=null,o=null;n.isGenderSensitive&&(2===n.genderRequirement?(l="female only",c="#d32f2f",o="#ffebee"):1===n.genderRequirement&&(l="male only",c="#1976d2",o="#e3f2fd"));const d=!0===n.requiresDedicatedTechnician||!0===n.RequiresDedicatedTechnician||!0===n.requiresDedicated;return i.jsxs(a,{sx:{mb:1},children:[i.jsx(G,{CustomAlign:"center",checked:s,onChange:()=>{let i=null;for(const[e,t]of Object.entries(A)){const e=t.find(e=>e.key===n.key);if(e){i={technicianQualificationId:0,scanTypeId:e.scanTypeId,scanTypeName:e.scanTypeName,serviceId:e.serviceId,serviceName:e.serviceName,isDedicated:!1};break}}if(!i)return;const a=s?e.qualifications.filter(e=>e.scanTypeId!==i.scanTypeId):[...e.qualifications,i];f("qualifications",a,!0),C("qualifications",!0,!1)},boxSize:18,label:i.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:.5},children:[i.jsx(H,{title:`${n.scanTypeName}${d?" (Requires dedicated technician)":""}`,children:i.jsx(t,{variant:"body2",sx:{flex:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",maxWidth:"100%",color:"#222",fontWeight:500},children:n.scanTypeName})}),l&&i.jsx($,{color:c,backgroundColor:o,children:l}),n.durationMinutes&&i.jsxs(t,{variant:"caption",sx:{color:"#666",backgroundColor:"#f5f5f5",px:.5,py:.25,borderRadius:1,fontSize:"0.7rem"},children:[n.durationMinutes,"min"]})]})}),d&&i.jsx(a,{sx:{ml:5,mt:.5,position:"relative"},children:i.jsx(G,{CustomAlign:"center",disabled:!s,checked:(null==r?void 0:r.isDedicated)||!1,onChange:i=>{if(!s)return;const a=e.qualifications.map(e=>e.scanTypeId===n.scanTypeId?{...e,isDedicated:i.target.checked}:e);f("qualifications",a,!0)},boxSize:16,label:i.jsx(t,{variant:"caption",sx:{color:s?"#444":"#999",fontSize:"0.72rem"},children:"This technician is dedicated to perform this task"})})})]},n.key)})})})]})},n)))}),i.jsx(r,{sx:{my:3}}),i.jsx(t,{variant:"h6",sx:{mb:1,color:"#333",fontWeight:600},children:"Working Hours"}),i.jsx(Y,{workingHours:re.map(i=>{var a;const n=(null==(a=e.workingHours)?void 0:a[i.key])||{available:!1,startTime:"08:00",endTime:"17:00"};return{key:i.key,label:i.label,available:n.available,startTime:n.startTime,endTime:n.endTime}}),onToggle:(e,i)=>{const a=re[e];f(`workingHours.${a.key}.available`,i.target.checked,!0),C("workingHours",!0,!1)},onTimeChange:(e,i,a)=>{const n=re[e],t="start"===i?"startTime":"endTime";f(`workingHours.${n.key}.${t}`,a.target.value)},variant:"grid",error:q("workingHours")&&l.workingHours?l.workingHours:null})]})}})},de=({open:a,onClose:n,technician:t,onSubmit:s})=>{const[r,l]=e.useState(""),[c,o]=e.useState(""),[d,u]=e.useState(!1),[m,h]=e.useState("");e.useEffect(()=>{a&&(l(""),o(""),h(""),u(!1))},[a]);return i.jsx(x,{open:a,onClose:n,title:`Mark Vacation for ${(null==t?void 0:t.fullName)||""}`,onSubmit:()=>{h(""),(null==t?void 0:t.technicianId)&&r&&c&&(new Date(r)>new Date(c)?h("From Date cannot be after To Date."):(u(!0),s&&s(t.technicianId,Q(new Date(r)),Q(new Date(c))),u(!1)))},submitLabel:d?"Saving...":"Confirm",loading:d,disableSubmit:!r||!c||d,customWidth:"350px",PaperProps:{sx:{width:"350px",maxWidth:"100%"}},children:i.jsxs(N,{spacing:2,mt:1,children:[i.jsx(D,{label:"From Date",type:"date",value:r,onChange:e=>l(e.target.value),fullWidth:!0,error:!!m,slotProps:{inputLabel:{shrink:!0},htmlInput:{}}}),i.jsx(D,{label:"To Date",type:"date",value:c,onChange:e=>o(e.target.value),fullWidth:!0,error:!!m,helperText:m,slotProps:{inputLabel:{shrink:!0},htmlInput:{}}})]})})},ue=()=>{const{selectedClinicId:n,clinicList:t,loadingClinics:s,clinicError:r}=M(),[l,c]=e.useState([]),[o,d]=e.useState(!1),[u,m]=e.useState(null),[h,p]=e.useState(!1),[f,x]=e.useState(null),[y,v]=e.useState(!1),[g,b]=e.useState(null),[j,S]=e.useState(!1),[T,k]=e.useState(!1),w=(e,i,a)=>{i?N(e,!0):(m({...a,technicianId:e}),p(!0))},N=async(e,i,a=null,t=null)=>{var s,r,l,o;try{const s={technicianId:e,isActive:i,inactiveFromDate:a,inactiveToDate:t};await C.put(`https://healthco.clinic/api/fhir/Practitioner/status?technicianId=${e}`,s),c(a=>a.map(a=>(a.technicianId||a.id)===e?{...a,isActive:i}:a)),I.success(i?"Technician activated successfully":"Technician deactivated successfully"),setTimeout(()=>{n&&D(n)},100)}catch(d){const e=(null==(r=null==(s=null==d?void 0:d.response)?void 0:s.data)?void 0:r.detail)||(null==(o=null==(l=null==d?void 0:d.response)?void 0:l.data)?void 0:o.message)||(null==d?void 0:d.message)||"Error updating technician status";I.error(e)}},D=async e=>{try{k(!0);const i=await B(e),a=Array.isArray(i.data)?i.data:[];c(a),S(e=>!e)}catch(i){c([])}finally{k(!1)}};e.useEffect(()=>{n&&(k(!0),D(n))},[n]);const A=()=>{d(!1),m(null)};return i.jsxs(a,{children:[i.jsx(L,{icon:E.Technicians,title:"Technician Management",description:"Manage technician qualifications, gender assignments, and working hours",clinics:t,selectedClinicId:n,addButtonLabel:"Add Technician",onAdd:()=>{m({clinicId:n,dailyServiceLimit:10,preventBackToBackComplexSubServices:!0}),d(!0)},addButtonDisabled:!n,loadingClinics:s,clinicError:r}),n&&T&&0===l.length&&i.jsx(W,{}),n&&!T&&0===l.length&&i.jsx(q,{message:"No technicians found"}),i.jsx(O,{children:!T&&l.map(e=>i.jsx(se,{technician:e,onEdit:()=>(async e=>{try{const i=(await C.get(`https://healthco.clinic/api/fhir/Practitioner/${e.technicianId}`)).data;m(i),d(!0)}catch(i){m(e),d(!0)}})(e),onToggleActive:w,setVacationModalOpen:p,setSelectedTechnician:m,setTechnicianNewStatus:x,onDelete:()=>(async e=>{b(e),v(!0)})(e.technicianId||e.id)},e.technicianId||e.id))}),i.jsx(oe,{open:o,onClose:A,onSubmit:async e=>{const i=e,a=Boolean(u&&(u.technicianId||u.id));try{a?(I.success("Technician updated successfully"),c(e=>e.map(e=>(e.technicianId||e.id)===(i.technicianId||i.id)?{...e,...i}:e))):(I.success("Technician added successfully"),c(e=>[...e,i])),A(),setTimeout(()=>{D(n)},100)}catch(t){I.error("An unexpected error occurred while updating the UI")}},initialData:u,clinicId:n}),i.jsx(de,{open:h,onClose:()=>p(!1),technician:u,onSubmit:(e,i,a)=>{N(e,!1,i,a),p(!1)}}),i.jsx(P,{open:y,onClose:()=>{v(!1),b(null)},onConfirm:async()=>{if(g)try{await F(g),c(e=>e.filter(e=>(e.technicianId||e.id)!==g)),I.success("Technician deleted successfully"),setTimeout(()=>{D(n)},100)}catch(e){I.error("Failed to delete technician")}v(!1),b(null)},title:"Delete Technician",message:"Are you sure you want to delete this technician? This action cannot be undone. To confirm, type DELETE below."})]})};export{ue as default};
