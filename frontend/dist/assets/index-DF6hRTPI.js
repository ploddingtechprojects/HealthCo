import{m as i,r as n,j as t,p as e,al as a,C as o,A as s,T as l}from"./index-DyR0ftVW.js";import{M as r}from"./ManagementHeader-ym6m9w7H.js";import{V as c,f as d,d as m}from"./ViewCalendarModal-BHjHQ6rY.js";import{s as p}from"./bookingSubmission-DyCoRkv0.js";import{getCurrentClinicTime as u}from"./appointmentLogic-ihgp36Gl.js";import{B as h}from"./BookAppointmentForm-BgtXT8oZ.js";import"./technician-CQyKWYBS.js";import"./displayDate-BRGhvOnj.js";import"./Tooltip-Cof9Jr1h.js";import"./DateOfBirthField-8J2568o0.js";import"./InputAdornment-BBfdgTpM.js";import"./DialogActions-BmwBtQrJ.js";import"./ListItem-BPokTJtf.js";import"./calendarService-uG1S5kl9.js";import"./bookingRules-DFQhlYAe.js";import"./calendarRulesService-tdjIi356.js";import"./CommonCheckbox-aJ2wZ0C8.js";import"./useProvinces-BxWqgMCH.js";import"./TruncateTooltip-BVddiBa5.js";const j=()=>{const[j,f]=n.useState(null),[g,y]=n.useState(null),[I,x]=n.useState(!0),[w,C]=n.useState(null),[S,A]=n.useState(!1),[v,D]=n.useState(0),[b,T]=n.useState({isEdit:!1,appointmentId:null,appointmentData:null,loading:!1});return n.useEffect(()=>{(async()=>{try{x(!0),C(null);const n=await(async()=>{try{const n=localStorage.getItem("userName");if(!n)return null;const t=await i.get("https://healthco.clinic/api/fhir/Practitioner/"),e=(Array.isArray(t.data)?t.data:[]).find(i=>{var t;return(null==(t=i.email)?void 0:t.toLowerCase())===n.toLowerCase()});return e?{technicianId:e.technicianId||e.id,clinicId:e.clinicId||e.ClinicId,fullName:e.fullName||e.name,email:e.email}:null}catch(w){return null}})();if(!n)return void C("Unable to load technician information. Please ensure you are logged in as a technician.");f(n);const t=await(async n=>{try{if(!n)return null;const t=(await i.get(`https://healthco.clinic/api/fhir/Organization/${n}`)).data;return t?{clinicId:t.clinicId||t.id,clinicName:t.clinicName||t.name}:null}catch(w){return null}})(n.clinicId);if(!t)return void C("Unable to load clinic information.");y(t)}catch(n){C("Failed to load appointment data. Please try refreshing the page.")}finally{x(!1)}})()},[]),I?t.jsxs(e,{children:[t.jsx(r,{icon:a.Appointments,title:"Calendar View",description:"View and manage your assigned appointments",hideClinicDropdown:!0,hideAddButton:!0}),t.jsx(e,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"400px"},children:t.jsx(o,{})})]}):w?t.jsxs(e,{children:[t.jsx(r,{icon:a.Appointments,title:"Calendar View",description:"View and manage your assigned appointments",hideClinicDropdown:!0,hideAddButton:!0}),t.jsx(s,{severity:"error",sx:{mt:2},children:w})]}):t.jsxs(e,{children:[t.jsx(r,{icon:a.Appointments,title:"Calendar View",description:`View and manage your appointments at ${(null==g?void 0:g.clinicName)||"your clinic"}`,hideClinicDropdown:!0,hideAddButton:!0}),j&&t.jsxs(e,{sx:{mt:3},children:[t.jsxs(l,{variant:"h6",sx:{mb:2},children:["Welcome, ",j.fullName]}),t.jsx(c,{clinicId:j.clinicId,technicianId:j.technicianId,asModal:!1,showTitle:!1,hideTechnicianDropdown:!0,readOnlyBlockTimes:!0,onEdit:m(T,A,null,u),canModifyAppointment:i=>d(i,null,u())},v),S&&t.jsx(h,{open:S,onClose:()=>{A(!1),T({isEdit:!1,appointmentId:null,appointmentData:null,loading:!1})},clinicId:j.clinicId,editState:b,onSubmit:async(i,n)=>{const t=await p({bookingData:i,updateType:n,clinicId:j.clinicId,editState:b});return t&&D(i=>i+1),t}})]})]})};export{j as default};
