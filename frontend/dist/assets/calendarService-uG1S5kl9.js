import{m as e}from"./index-DyR0ftVW.js";const a="https://healthco.clinic/api/fhir/Calendar",n=()=>{const e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}},r=(e,a)=>{const n=e.map(e=>({code:e.RuleCode,masterId:e.CalendarRuleMasterId,config:e.Config})),r=a.map(e=>({code:e.ruleCode||e.RuleCode,masterId:e.calendarRuleMasterId||e.CalendarRuleMasterId,config:e.config||e.Config})),t=n.filter(e=>!r.some(a=>a.code===e.code&&a.masterId===e.masterId));return t.length>0?t:[]},t=e=>new Promise((a,n)=>{const r=new FileReader;r.readAsDataURL(e),r.onload=()=>a(r.result),r.onerror=e=>n(e)}),i=e=>{var a,n;if(e.response){const r=(null==(a=e.response.data)?void 0:a.detail)||(null==(n=e.response.data)?void 0:n.message)||e.response.statusText;throw new Error(r)}throw e.request?new Error("No response received from server"):e},s=e=>{const a=[];if(!e)return a;const n=e;return n.separateByServicesEnabled&&n.separateByServicesRules&&n.separateByServicesRules.length>0&&n.separateByServicesRules.forEach(e=>{e.service1&&e.service2&&a.push({CalendarRuleMasterId:1,RuleName:"Separate Appointments by Services",RuleCode:"SAS",Config:{enabled:!0,service1:e.service1,service2:e.service2}})}),n.seqEnabled&&n.seqRules&&n.seqRules.length>0&&n.seqRules.forEach(e=>{e.primary&&e.secondary&&e.secondary.length>0&&e.enabled&&a.push({CalendarRuleMasterId:2,RuleName:"Sequential Scan Ordering",RuleCode:"SSO",Config:{enabled:!0,primary:e.primary,secondary:e.secondary,minWait:e.minWait||0}})}),n.efficiencyEnabled&&(n.efficiencyRules&&n.efficiencyRules.length>0&&n.efficiencyRules.forEach(e=>{e.leftServiceId&&e.rightServiceId&&e.minutes>0&&a.push({CalendarRuleMasterId:3,RuleName:"Multi-Scan Efficiency Bonus",RuleCode:"MEB",Config:{enabled:!0,leftServiceId:e.leftServiceId,rightServiceId:e.rightServiceId,minutes:e.minutes}})}),n.defaultSameServiceEfficiencyBonus&&n.defaultSameServiceEfficiencyBonus>0&&a.push({CalendarRuleMasterId:3,RuleName:"Multi-Scan Efficiency Bonus",RuleCode:"MEB",Config:{enabled:!0,type:"same-service",minutes:n.defaultSameServiceEfficiencyBonus}})),n.technicianBufferEnabled&&n.technicianBufferGlobalMinutes>0&&a.push({CalendarRuleMasterId:4,RuleName:"Technician Buffer Time",RuleCode:"TBT",Config:{enabled:!0,globalMinutes:n.technicianBufferGlobalMinutes}}),n.patientCooldownEnabled&&(n.patientCooldownGlobalMinutes>0&&a.push({CalendarRuleMasterId:5,RuleName:"Patient Cooldown Time",RuleCode:"PCT",Config:{enabled:!0,type:"global",minutes:n.patientCooldownGlobalMinutes}}),n.patientCooldownRules&&n.patientCooldownRules.length>0&&n.patientCooldownRules.forEach(e=>{e.leftScanId&&e.rightScanId&&e.minutes>0&&a.push({CalendarRuleMasterId:5,RuleName:"Patient Cooldown Time",RuleCode:"PCT",Config:{enabled:!0,type:"specific",leftScanId:e.leftScanId,rightScanId:e.rightScanId,minutes:e.minutes}})})),n.sameDayPriority&&(a.push({CalendarRuleMasterId:6,RuleName:"Prioritize Same-Day Bookings",RuleCode:"PSB",Config:{enabled:!0,isException:!1}}),n.sameDayExceptions&&n.sameDayExceptions.length>0&&n.sameDayExceptions.forEach(e=>{e.leftScanId&&e.rightScanId&&a.push({CalendarRuleMasterId:6,RuleName:"Prioritize Same-Day Bookings",RuleCode:"PSB",Config:{enabled:!0,isException:!0,subServiceIds:[e.leftScanId,e.rightScanId]}})})),n.dailyLimitsEnabled&&(!n.dailyLimits||0===n.dailyLimits.length||n.dailyLimits.every(e=>!e.enabled||!e.subServiceIds||0===e.subServiceIds.length||e.max<=0)?a.push({CalendarRuleMasterId:7,RuleName:"Daily Complex Scan Limit per Technician",RuleCode:"DCL",Config:{enabled:!0}}):n.dailyLimits.forEach(e=>{e.enabled&&e.subServiceIds&&e.subServiceIds.length>0&&e.max>0&&a.push({CalendarRuleMasterId:7,RuleName:"Daily Complex Scan Limit per Technician",RuleCode:"DCL",Config:{enabled:!0,subServiceIds:e.subServiceIds,maxPerDay:e.max}})})),n.genderMatchingEnabled&&a.push({CalendarRuleMasterId:8,RuleName:"Auto Gender Matching",RuleCode:"AGM",Config:{enabled:!0}}),n.dedicatedAssignmentsEnabled&&n.dedicatedAssignments&&a.push({CalendarRuleMasterId:9,RuleName:"Dedicated Technicians for scans",RuleCode:"DTS",Config:{enabled:!0,assignments:n.dedicatedAssignments}}),n.preventBackToBack&&n.preventBackToBackRules&&n.preventBackToBackRules.length>0&&n.preventBackToBackRules.forEach(e=>{const n=Array.isArray(e.rightScanIds)&&e.rightScanIds.length>0?e.rightScanIds:e.rightScanId?[e.rightScanId]:[];e.leftScanId&&n.length>0&&e.minutes>0&&n.forEach(n=>{n&&a.push({CalendarRuleMasterId:10,RuleName:"Prevent Back-to-Back Complex scans",RuleCode:"PBC",Config:{enabled:!0,leftScanId:e.leftScanId,rightScanId:n,minutes:e.minutes}})})}),n.slotRangeEnabled&&n.slotDisplayRangeDays>0&&a.push({CalendarRuleMasterId:11,RuleName:"Slot Display Range",RuleCode:"SDR",Config:{enabled:!0,days:n.slotDisplayRangeDays}}),n.variableRescheduleEnabled&&n.variableRescheduleHours>0&&a.push({CalendarRuleMasterId:12,RuleName:"Variable Advance Time for Reschedule/Cancel",RuleCode:"VTRC",Config:{enabled:!0,hours:n.variableRescheduleHours}}),n.separateCombinationEnabled&&n.separateCombinations&&n.separateCombinations.length>0&&n.separateCombinations.forEach(e=>{e.enabled&&e.leftScanId&&e.rightScanId?a.push({CalendarRuleMasterId:13,RuleName:"Separate-Day Scan Combinations",RuleCode:"SDCC",Config:{enabled:!0,leftScanId:e.leftScanId,rightScanId:e.rightScanId}}):e.enabled&&e.scans&&e.scans.length>0&&a.push({CalendarRuleMasterId:13,RuleName:"Separate-Day Scan Combinations",RuleCode:"SDCC",Config:{enabled:!0,scans:e.scans,firstScan:e.firstScan||""}})}),a},l={createCalendar:async l=>{var o,d,c,u,h,p,m,y,g;try{if(!l.clinicId)throw new Error("Clinic ID is required");if(!(null==(o=l.calendarName)?void 0:o.trim()))throw new Error("Calendar name is required");let i=null;if(l.logo&&l.logo instanceof File){if(l.logo.size>5242880)throw new Error("Logo file size must be less than 5MB");if(!l.logo.type.startsWith("image/"))throw new Error("Logo must be an image file");i=await t(l.logo)}const h=[];l.patientFormSettings&&Object.entries(l.patientFormSettings).forEach(([e,a])=>{h.push({PatientFormFieldId:0,FieldName:e,Enabled:a.enabled,Required:a.required})});const p=[];l.workingHours&&Array.isArray(l.workingHours)&&l.workingHours.forEach((e,a)=>{p.push({ClinicWorkingHourId:0,ClinicId:parseInt(l.clinicId),DayOfWeek:{sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6}[e.day]??a,IsAvailable:!!e.enabled,StartTime:e.enabled&&e.start?`${e.start}:00`:null,EndTime:e.enabled&&e.end?`${e.end}:00`:null})});const m=s(l.logicEngine),y=[];if(l.selectedScanTypeIds&&Array.isArray(l.selectedScanTypeIds)&&l.selectedScanTypeIds.length>0){const a={};try{const n=await e.get(`https://healthco.clinic/api/api/services/clinic/${l.clinicId}`),r=Array.isArray(n.data)?n.data:[],t={};r.forEach(e=>{e.scanTypes&&Array.isArray(e.scanTypes)&&e.scanTypes.forEach(a=>{t[a.scanTypeId]=e.serviceId})}),l.selectedScanTypeIds.forEach(e=>{const n=t[e];n&&(a[n]||(a[n]=[]),a[n].push(e))}),Object.entries(a).forEach(([e,a])=>{y.push({ServiceId:parseInt(e),IsEnabled:!0,ScanTypeIds:a})})}catch(f){}}const g=localStorage.getItem("userId")||localStorage.getItem("Id"),I=g?parseInt(g):1,C={ClinicId:parseInt(l.clinicId),Title:l.calendarName.trim(),Description:(null==(d=l.description)?void 0:d.trim())||null,WelcomeMessage:(null==(c=l.welcomeMessage)?void 0:c.trim())||null,ThankyouMessage:(null==(u=l.thankYouMessage)?void 0:u.trim())||null,OwnerUserId:I,Color:l.primaryColor||null,SecondaryColor:l.secondaryColor||null,LogoUrl:i,BannerUrl:null,PatientFormFields:h,WorkingHours:p,Rules:m,AvailableServices:y};if(!C.ClinicId||isNaN(C.ClinicId))throw new Error("Invalid clinic ID");if(!C.Title||0===C.Title.length)throw new Error("Calendar title is required");const S=await e.post(a,C,{headers:{...n(),"Content-Type":"application/json"}});if(S.data&&S.data.rules){r(m,S.data.rules).length}return S.data}catch(f){if(400===(null==(h=f.response)?void 0:h.status)){const e=null==(p=f.response.data)?void 0:p.errors;if(e){const a=Object.entries(e).map(([e,a])=>`${e}: ${Array.isArray(a)?a.join(", "):a}`).join("; ");throw new Error(`Validation failed: ${a}`)}}else{if(409===(null==(m=f.response)?void 0:m.status))throw new Error("A calendar with this name already exists for this clinic");if(401===(null==(y=f.response)?void 0:y.status))throw new Error("You are not authorized to create calendars for this clinic");if(500===(null==(g=f.response)?void 0:g.status))throw new Error("Server error occurred. Please try again later.")}i(f)}},updateCalendar:async(l,o)=>{var d,c,u,h,p,m,y,g;try{if(!l)throw new Error("Calendar ID is required");if(!(null==(d=o.calendarName)?void 0:d.trim()))throw new Error("Calendar name is required");let i=null;o.logo&&o.logo instanceof File&&(i=await t(o.logo));const p=[];o.patientFormSettings&&Object.entries(o.patientFormSettings).forEach(([e,a])=>{p.push({PatientFormFieldId:0,FieldName:e,Enabled:a.enabled,Required:a.required})});const m=[];o.workingHours&&Array.isArray(o.workingHours)&&o.workingHours.forEach((e,a)=>{m.push({ClinicWorkingHourId:0,ClinicId:parseInt(o.clinicId),DayOfWeek:{sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6}[e.day]??a,IsAvailable:!!e.enabled,StartTime:e.enabled&&e.start?`${e.start}:00`:null,EndTime:e.enabled&&e.end?`${e.end}:00`:null})});const y=s(o.logicEngine),g=[];if(o.selectedScanTypeIds&&Array.isArray(o.selectedScanTypeIds)&&o.selectedScanTypeIds.length>0){const a={};try{const n=await e.get(`https://healthco.clinic/api/api/services/clinic/${o.clinicId}`),r=Array.isArray(n.data)?n.data:[],t={};r.forEach(e=>{e.scanTypes&&Array.isArray(e.scanTypes)&&e.scanTypes.forEach(a=>{t[a.scanTypeId]=e.serviceId})}),o.selectedScanTypeIds.forEach(e=>{const n=t[e];n&&(a[n]||(a[n]=[]),a[n].push(e))}),Object.entries(a).forEach(([e,a])=>{g.push({ServiceId:parseInt(e),IsEnabled:!0,ScanTypeIds:a})})}catch(f){}}const I=localStorage.getItem("userId")||localStorage.getItem("Id"),C=I?parseInt(I):1,S={CalendarId:l,ClinicId:parseInt(o.clinicId),Title:o.calendarName.trim(),Description:(null==(c=o.description)?void 0:c.trim())||null,WelcomeMessage:(null==(u=o.welcomeMessage)?void 0:u.trim())||null,ThankyouMessage:(null==(h=o.thankYouMessage)?void 0:h.trim())||null,OwnerUserId:C,Color:o.primaryColor||null,SecondaryColor:o.secondaryColor||null,LogoUrl:i||o.logoUrl||null,BannerUrl:null,PatientFormFields:p,WorkingHours:m,Rules:y,AvailableServices:g},R=await e.put(`${a}/${l}`,S,{headers:{"Content-Type":"application/json",...n()}});if(R.data&&R.data.rules){r(y,R.data.rules).length}return R.data}catch(f){if(400===(null==(p=f.response)?void 0:p.status))throw new Error("Invalid calendar data. Please check your inputs.");if(404===(null==(m=f.response)?void 0:m.status))throw new Error("Calendar not found");if(401===(null==(y=f.response)?void 0:y.status))throw new Error("You are not authorized to update this calendar");if(500===(null==(g=f.response)?void 0:g.status))throw new Error("Server error occurred. Please try again later.");i(f)}},getCalendarSummaries:async(r=null)=>{try{const t=r?{clinicId:r}:{};return(await e.get(`${a}/summaries`,{headers:n(),params:t})).data}catch(t){i(t)}},getCalendars:async(r=null)=>{try{const t=r?{clinicId:r}:{};return(await e.get(a,{headers:n(),params:t})).data}catch(t){i(t)}},getCalendarById:async r=>{try{return(await e.get(`${a}/${r}`,{headers:n()})).data}catch(t){i(t)}},reserveSlot:async a=>{try{return(await e.post("https://healthco.clinic/api/fhir/Appointment/reserve-slot",a,{headers:{"Content-Type":"application/json",...n()}})).data}catch(r){i(r)}},releaseSessionSlots:async a=>{try{return(await e.delete("https://healthco.clinic/api/fhir/Appointment/release-session-slots",{data:a,headers:{"Content-Type":"application/json",...n()}})).data}catch(r){i(r)}},releaseSessionSlots:async a=>{try{return(await e.delete("https://healthco.clinic/api/fhir/Appointment/reserve-slot/session",{data:a,headers:{"Content-Type":"application/json",...n()}})).data}catch(r){i(r)}},releaseSlot:async a=>{try{return(await e.delete(`https://healthco.clinic/api/fhir/Appointment/reserve-slot/${a}`,{headers:n()})).data}catch(r){i(r)}}};export{l as c};
