import{r as e,j as t,ad as n,ae as i,m as a,y as r,D as s,h as o,T as l,S as d,B as c,aD as h,ak as u,bm as p,i as m,p as x,a3 as f,bw as g,P as b,I as y,o as j,a as v,c as D,aO as T,f as k,F as w,am as C,ac as I,k as S,bx as M,by as N,bz as R,O as W,aI as E,U as O,C as $}from"./index-DyR0ftVW.js";import{g as A}from"./technician-CQyKWYBS.js";import{formatDateISO as B,getCurrentClinicTime as H,fetchAndSetClinicTimezone as z,getClinicTimezoneOffset as F}from"./appointmentLogic-ihgp36Gl.js";import{C as L}from"./BookAppointmentForm-BgtXT8oZ.js";import{f as P,S as U}from"./displayDate-BRGhvOnj.js";import{T as V}from"./Tooltip-Cof9Jr1h.js";import{d as q}from"./DateOfBirthField-8J2568o0.js";const Y={BOOKED:0,CONFIRMED:1,IN_PROGRESS:2,COMPLETED:3,CANCELLED:4,RESCHEDULED:5,NO_SHOW:6},_={[Y.BOOKED]:"Booked",[Y.CONFIRMED]:"Confirmed",[Y.IN_PROGRESS]:"In Progress",[Y.COMPLETED]:"Completed",[Y.CANCELLED]:"Cancelled",[Y.RESCHEDULED]:"Rescheduled",[Y.NO_SHOW]:"No Show"},G={[Y.BOOKED]:"#1677ff",ARRIVED:"green",[Y.IN_PROGRESS]:"orange",[Y.COMPLETED]:"grey",[Y.CANCELLED]:"grey",[Y.CONFIRMED]:"teal",[Y.RESCHEDULED]:"#fcf4a3",[Y.NO_SHOW]:"#ff4d4f"},K=e=>String(e||"").toLowerCase().replace(/[^a-z0-9]/g,""),J=e=>"number"!=typeof e?"":(null==_?void 0:_[e])??"",Q=e=>{if("number"==typeof e)return e;const t=K(e);for(const[n,i]of Object.entries(_||{}))if(K(i)===t)return Number(n)},X=e=>{const t="number"==typeof e?e:Q(e);return G&&G[t]||void 0},Z=e=>{const t=String(e).trim().toLowerCase();return["#fcf4a3","orange"].includes(t)?"#000":"#fff"},ee=({appointmentId:r,currentStatus:s,onStatusChanged:o,disabled:l=!1,remarks:d=""})=>{const c=e.useMemo(()=>"number"==typeof s?s:Q(s),[s]),[h,u]=e.useState(c),[p,m]=e.useState(!1);e.useEffect(()=>{u(c)},[c]);const x=e.useMemo(()=>"number"==typeof s?J(s):"string"==typeof s?s:"",[s]),f=X("number"==typeof h?h:c??Q(s)),g=f?Z(f):void 0,b=[Y.CONFIRMED,Y.NO_SHOW,Y.IN_PROGRESS,Y.COMPLETED];return t.jsxs(n,{size:"small",value:h??"",onChange:async e=>{const t=e.target.value,n=h;u(t),m(!0);try{await a.put(`https://healthco.clinic/api/fhir/Appointment/${r}/status`,{appointmentId:Number(r),newStatus:t,remarks:d}),null==o||o(t,J(t))}catch(i){u(n),null==o||o(n,J(n))}finally{m(!1)}},disabled:l||p,displayEmpty:!0,sx:{minWidth:150,bgcolor:f||void 0,color:g||void 0,"& .MuiSelect-icon":{color:g||void 0}},renderValue:e=>""===e?x||"—":J(e),children:[null!=h&&!b.includes(h)&&t.jsx(i,{value:h,disabled:!0,children:J(h)}),b.map(e=>t.jsx(i,{value:e,disabled:p,children:J(e)},e))]})},te=async e=>{var t;if(!e)return{clinicDetails:null,rescheduleRule:null};try{const i=(await a.get(`https://healthco.clinic/api/fhir/Calendar/ClinicDetails/${e}`)).data,r=null==(t=i.rules)?void 0:t.find(e=>"VTRC"===e.ruleCode&&e.isEnabled);let s=null;if(r&&r.config)try{const e=JSON.parse(r.config);e.enabled&&void 0!==e.hours&&(s={enabled:!0,hours:parseFloat(e.hours)})}catch(n){}return{clinicDetails:i,rescheduleRule:s}}catch(i){return{clinicDetails:null,rescheduleRule:null}}},ne=(e,t,n=new Date)=>{try{const i=e.date,a=e.time.split(" - ")[0].trim(),r=new Date(`${i} ${a}`);if(isNaN(r.getTime()))return{allowed:!0,reason:""};if(r<n)return{allowed:!1,reason:"Cannot edit past appointments"};if(!t||!t.enabled)return{allowed:!0,reason:""};const s=60*t.hours*60*1e3,o=new Date(r.getTime()-s);if(!(n<=o)){return{allowed:!1,reason:`Appointments must be cancelled or rescheduled at least ${t.hours<1?60*t.hours+" minutes":1===t.hours?"1 hour":`${t.hours} hours`} in advance`}}return{allowed:!0,reason:""}}catch(i){return{allowed:!0,reason:""}}},ie=(e,t,n,i)=>async(s,o)=>{if(o){const e=i?i():new Date,t=ne(o,n,e);if(!t.allowed)return void r.error(t.reason)}e(e=>({...e,loading:!0}));const l=await(async e=>{var t;try{const n=await a.get(`https://healthco.clinic/api/fhir/Appointment/${e}`);return(null==(t=n.data)?void 0:t.value)||n.data}catch(n){return r.error("Failed to fetch appointment details. Please try again."),null}})(s);l?(e({isEdit:!0,appointmentId:s,appointmentData:l,loading:!1}),t(!0)):e(e=>({...e,loading:!1}))},ae=({open:n,onClose:i,selectedAppointment:a,appointmentDetailsLoading:r,onEdit:g,canModifyAppointment:b,onStatusUpdated:y})=>{var j,v;const D=()=>a?{date:P(a.appointmentDate),time:a.startTime&&a.endTime?`${a.startTime.slice(0,5)} - ${a.endTime.slice(0,5)}`:"",status:a.status,appointmentId:a.appointmentId}:null,T=b&&a?b(D()):{allowed:!0,reason:""},[k,w]=e.useState(null==a?void 0:a.status);e.useEffect(()=>{w(null==a?void 0:a.status)},[a]);const C=k,I="number"==typeof C?C:Q(C),S=I===Y.CANCELLED||"cancelled"===String(C||"").toLowerCase(),M=I===Y.COMPLETED||"completed"===String(C||"").toLowerCase(),N=S||M,R=!a||S||M||!T.allowed;return t.jsxs(s,{open:n,onClose:i,maxWidth:"md",fullWidth:!0,scroll:"body",slotProps:{paper:{sx:{borderRadius:"16px",marginY:1,overflow:"visible"}}},children:[t.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pb:2},children:[t.jsx(l,{variant:"h6",fontWeight:600,children:"Appointment Details"}),t.jsxs(d,{direction:"row",spacing:1,alignItems:"center",children:[g&&t.jsx(V,{title:a?S?"Cannot edit cancelled appointment":M?"Cannot edit completed appointment":T.allowed?"Edit appointment":T.reason:"",children:t.jsx("span",{children:t.jsx(c,{variant:"contained",startIcon:t.jsx(h,{}),onClick:()=>{if(a&&g){const e=D();g(a.appointmentId,e),i()}},disabled:R,size:"small",sx:{textTransform:"none",borderRadius:2,fontWeight:600},children:"Edit"})})}),t.jsx(u,{onClick:i,size:"small",children:t.jsx(p,{})})]})]}),t.jsx(m,{sx:{p:3,overflow:"visible","&.MuiDialogContent-root":{overflow:"visible"}},children:r?t.jsx(x,{sx:{display:"flex",justifyContent:"center",p:4},children:t.jsx(l,{children:"Loading appointment details..."})}):a?t.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:3},children:[t.jsxs(x,{children:[t.jsx(l,{variant:"h6",fontWeight:600,sx:{mb:2,color:"primary.main"},children:"Patient Information"}),t.jsxs(x,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:2},children:[t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Full Name"}),t.jsx(l,{variant:"body1",fontWeight:500,children:a.fullName||"Not provided"})]}),t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Email"}),t.jsx(l,{variant:"body1",children:a.email||"Not provided"})]}),t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Phone"}),t.jsx(l,{variant:"body1",children:a.phone||"Not provided"})]}),t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Gender"}),t.jsx(l,{variant:"body1",children:a.genderDisplay||"Not provided"})]}),t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Date of Birth"}),t.jsx(l,{variant:"body1",children:a.dateOfBirth?P(a.dateOfBirth):"Not provided"})]}),t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Health Card Number"}),t.jsx(l,{variant:"body1",children:a.healthCardNumber||"Not provided"})]}),t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"UCI Number"}),t.jsx(l,{variant:"body1",children:a.uciNumber||"Not provided"})]}),t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Coverage Type"}),t.jsx(l,{variant:"body1",children:void 0!==a.coverageType&&null!==a.coverageType?L[a.coverageType]||"Not specified":"Not provided"})]}),t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Identified As"}),t.jsx(l,{variant:"body1",children:a.identifiedAsDisplay||"Not specified"})]})]})]}),t.jsxs(x,{children:[t.jsx(l,{variant:"h6",fontWeight:600,sx:{mb:2,color:"primary.main"},children:"Appointment Information"}),t.jsxs(x,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:2},children:[t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Appointment ID"}),t.jsxs(l,{variant:"body1",fontWeight:500,children:["#",a.appointmentId]})]}),t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Clinic"}),t.jsx(l,{variant:"body1",children:a.clinicName})]}),t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Technician"}),t.jsx(l,{variant:"body1",children:a.technicianName})]}),t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Date"}),t.jsx(l,{variant:"body1",children:P(a.appointmentDate)})]}),t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Time"}),t.jsxs(l,{variant:"body1",children:[null==(j=a.startTime)?void 0:j.slice(0,5)," - ",null==(v=a.endTime)?void 0:v.slice(0,5)]})]}),t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Status"}),N?(()=>{const e=(e=>{const t="number"==typeof e?e:Q(e);return J(t)||("string"==typeof e?e:"")})(C)||"Booked",n=X(C),i=n?Z(n):void 0,r=S&&a.cancellationReason?a.cancellationReason:"";return t.jsx(V,{title:r,children:t.jsx(f,{label:e,size:"small",variant:"filled",sx:{fontWeight:500,bgcolor:n||void 0,color:i||void 0}})})})():t.jsx(ee,{appointmentId:a.appointmentId,currentStatus:C,onStatusChanged:e=>{if(w(e),"function"==typeof y)try{y(e)}catch(t){}}})]})]})]}),S&&a.cancellationReason&&t.jsxs(x,{children:[t.jsx(l,{variant:"h6",fontWeight:600,sx:{mb:2,color:"error.main"},children:"Cancellation Details"}),t.jsxs(x,{sx:{backgroundColor:"#fef2f2",p:2,borderRadius:1,border:"1px solid #fecaca"},children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Reason"}),t.jsx(l,{variant:"body1",color:"error.main",children:a.cancellationReason})]})]}),a.scans&&a.scans.length>0&&t.jsxs(x,{children:[t.jsx(l,{variant:"h6",fontWeight:600,sx:{mb:2,color:"primary.main"},children:"Scans"}),t.jsx(x,{sx:{display:"flex",flexDirection:"column",gap:1},children:a.scans.map((e,n)=>t.jsxs(x,{sx:{backgroundColor:"#f8fafc",p:2,borderRadius:1,border:"1px solid #e2e8f0"},children:[t.jsx(l,{variant:"body1",fontWeight:500,children:e.scanTypeName}),t.jsxs(l,{variant:"body2",color:"text.secondary",children:["Duration: ",e.durationMinutes," minutes"]})]},n))})]}),(a.reasonForVisit||a.notes||a.medicalNotes||a.allergies)&&t.jsxs(x,{children:[t.jsx(l,{variant:"h6",fontWeight:600,sx:{mb:2,color:"primary.main"},children:"Additional Information"}),t.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:2},children:[a.reasonForVisit&&t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Reason for Visit"}),t.jsx(l,{variant:"body1",children:a.reasonForVisit})]}),a.notes&&t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Notes"}),t.jsx(l,{variant:"body1",children:a.notes})]}),a.medicalNotes&&t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Medical Notes"}),t.jsx(l,{variant:"body1",children:a.medicalNotes})]}),a.allergies&&t.jsxs(x,{children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"Allergies"}),t.jsx(l,{variant:"body1",sx:{color:"error.main",fontWeight:500},children:a.allergies})]})]})]}),a.isRescheduled&&t.jsxs(x,{children:[t.jsx(l,{variant:"h6",fontWeight:600,sx:{mb:2,color:"warning.main"},children:"Reschedule Information"}),t.jsxs(x,{sx:{backgroundColor:"#fffbeb",p:2,borderRadius:1,border:"1px solid #fed7aa"},children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:"This appointment has been rescheduled"}),a.previousAppointmentId&&t.jsxs(l,{variant:"body1",color:"warning.main",children:["Previous Appointment ID: #",a.previousAppointmentId]})]})]})]}):t.jsx(x,{sx:{display:"flex",justifyContent:"center",p:4},children:t.jsx(l,{color:"text.secondary",children:"No appointment details available"})})})]})},re="https://healthco.clinic/api/api/technician-blocked-time",se=e=>{const{data:t}=e;if(t&&"object"==typeof t){if(!1===t.success)throw new Error(t.message||"Request failed");return void 0!==t.data?t.data:t}return t},oe=async(e={})=>{var t,n;try{const t=await a.get(re,{params:e});return se(t)}catch(i){const e=(null==(n=null==(t=i.response)?void 0:t.data)?void 0:n.message)||i.message||"Failed to fetch blocked times";throw new Error(e)}},le=async e=>{var t,n;try{const t=await a.post(re,e);return se(t)}catch(i){const e=(null==(n=null==(t=i.response)?void 0:t.data)?void 0:n.message)||i.message||"Failed to create blocked time";throw new Error(e)}},de=async(e,t)=>{var n,i;try{const n=await a.put(`${re}/${e}`,t);return se(n)}catch(r){const e=(null==(i=null==(n=r.response)?void 0:n.data)?void 0:i.message)||r.message||"Failed to update blocked time";throw new Error(e)}},ce=async e=>{var t,n;try{const t=await a.delete(`${re}/${e}`);return se(t)}catch(i){const e=(null==(n=null==(t=i.response)?void 0:t.data)?void 0:n.message)||i.message||"Failed to delete blocked time";throw new Error(e)}},he=(e=7,t=19)=>{const n=[];for(let i=e;i<=t;i++){const e=new Date;e.setHours(i,0,0,0),n.push({time:e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),hour:i})}return n},ue=e=>{const t=new Date(e),n=t.getDay(),i=t.getDate()-n;return new Date(t.setDate(i))},pe=e=>new Date(e.getFullYear(),e.getMonth(),1),me=e=>new Date(e.getFullYear(),e.getMonth()+1,0),xe=e=>{const t=pe(e),n=me(e),i=ue(t),a=new Date(ue(n));a.setDate(a.getDate()+6);const r=[],s=new Date(i);for(;s<=a;)r.push(new Date(s)),s.setDate(s.getDate()+1);return r},fe=e=>{if(!e)return 0;const t=e.split(":");return 60*parseInt(t[0])+parseInt(t[1])},ge=(e,t=7)=>(e-60*t)/60*60,be=e=>{if(!e)return"";const[t,n]=e.split(":"),i=parseInt(t);return`${0===i?12:i>12?i-12:i}:${n} ${i>=12?"PM":"AM"}`},ye=(e,t)=>e.filter(e=>t.includes(e.technicianId||e.id)),je=(e,t)=>{if(!e||!t)return!1;if(!e.inactiveFromDate||!e.inactiveToDate)return!1;const n=new Date(t);n.setHours(0,0,0,0);const i=new Date(e.inactiveFromDate);i.setHours(0,0,0,0);const a=new Date(e.inactiveToDate);return a.setHours(0,0,0,0),n>=i&&n<=a},ve=({appointment:e,onClick:n,variant:i="default",showTechnician:a=!1,technicianName:r=null,offsetDivisor:s=8,padding:o=null,...d})=>{const c={backgroundColor:"Cancelled"===e.status?"#fef2f2":"#dbeafe",border:"1px solid "+("Cancelled"===e.status?"#dc2626":"#3b82f6"),borderRadius:1,p:.5,cursor:"pointer",overflow:"hidden","&:hover":{backgroundColor:"Cancelled"===e.status?"#fee2e2":"#bfdbfe",transform:"scale(1.02)",zIndex:"positioned"===i?12:5},transition:"all 0.15s ease",position:"positioned"===i?"absolute":"relative",...d};return"positioned"===i&&(c.top=e.top,c.left=2+(e.leftOffset||0),c.right=2+(e.rightOffset||0),c.height=e.height,c.zIndex=Math.min(3+(e.leftOffset?Math.floor(e.leftOffset/s):0),9),c.border="2px solid "+("Cancelled"===e.status?"#dc2626":"#3b82f6"),c.borderRadius=2,c.p=null!==o?o:1,c["&:hover"].boxShadow="0 4px 12px rgba(0,0,0,0.15)",c["&:hover"].zIndex=Math.min(12,c.zIndex+3)),t.jsxs(x,{onClick:t=>{t.stopPropagation(),n(e.appointmentId)},sx:c,children:[t.jsxs(l,{variant:"caption",fontWeight:600,color:"Cancelled"===e.status?"#dc2626":"#1e40af",sx:{display:"block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:"10px",lineHeight:1},children:[(()=>{var t;const n=null==(t=e.scans)?void 0:t[0];return`${(null==n?void 0:n.serviceName)||"Service"}${(null==n?void 0:n.serviceCode)?` (${n.serviceCode})`:""}`})()," ","- ",e.fullName||"Patient"]}),t.jsxs(l,{variant:"caption",color:"#374151",sx:{display:"block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:"9px",lineHeight:1.2},children:[be(e.startTime)," - ",be(e.endTime)]})]})},De=({blockedTime:e,onClick:n,variant:i="positioned",padding:a=.5})=>{const{technicianName:r,reason:s,top:o,height:d}=e,c={backgroundColor:"rgba(156, 163, 175, 0.3)",border:"2px solid #9ca3af",borderLeft:"4px solid #6b7280",borderRadius:"4px",padding:a,cursor:n?"pointer":"default",overflow:"hidden",transition:"all 0.2s ease","&:hover":n?{backgroundColor:"rgba(107, 114, 128, 0.4)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)",transform:"translateY(-1px)"}:{}},h="positioned"===i?{position:"absolute",top:o,left:0,right:0,height:d,zIndex:5}:{};return t.jsxs(x,{onClick:t=>{t.stopPropagation(),n&&n(e)},sx:{...c,...h},children:[t.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5,mb:.25},children:[t.jsx(g,{size:12,style:{flexShrink:0,color:"#6b7280"}}),t.jsx(l,{variant:"caption",sx:{fontWeight:600,color:"#374151",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:"Blocked Time"})]}),s&&t.jsx(l,{variant:"caption",sx:{color:"#6b7280",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",fontSize:"0.7rem",lineHeight:1.2},children:s})]})};De.propTypes={blockedTime:b.shape({technicianBlockedTimeId:b.number,technicianId:b.number,technicianName:b.string,blockedDate:b.string,startTime:b.string,endTime:b.string,reason:b.string,isActive:b.bool,top:b.oneOfType([b.number,b.string]),height:b.oneOfType([b.number,b.string])}).isRequired,onClick:b.func,variant:b.oneOf(["positioned","static"]),padding:b.number};const Te=({label:e,value:a,onChange:r,disabled:s,error:o,helperText:l,required:d})=>{const c=Array.from({length:24},(e,t)=>String(t).padStart(2,"0")),[h,u]=a?a.split(":"):["",""];return t.jsxs(x,{children:[t.jsx(y,{error:o,required:d,sx:{mb:1,fontSize:"0.75rem"},children:e}),t.jsxs(x,{sx:{display:"flex",gap:1},children:[t.jsxs(j,{fullWidth:!0,error:o,disabled:s,children:[t.jsx(y,{id:`${e}-hour-label`,children:"Hour"}),t.jsx(n,{labelId:`${e}-hour-label`,value:h,label:"Hour",onChange:e=>{const t=e.target.value;r(`${t}:${u||"00"}`)},sx:{borderRadius:"8px"},children:c.map(e=>t.jsx(i,{value:e,children:e},e))})]}),t.jsxs(j,{fullWidth:!0,error:o,disabled:s,children:[t.jsx(y,{id:`${e}-minute-label`,children:"Min"}),t.jsx(n,{labelId:`${e}-minute-label`,value:u,label:"Min",onChange:e=>{const t=e.target.value;r(`${h||"00"}:${t}`)},sx:{borderRadius:"8px"},children:["00","10","20","30","40","50"].map(e=>t.jsx(i,{value:e,children:e},e))})]})]}),l&&t.jsx(v,{error:o,children:l})]})};Te.propTypes={label:b.string.isRequired,value:b.string,onChange:b.func.isRequired,disabled:b.bool,error:b.bool,helperText:b.string,required:b.bool};const ke=()=>"undefined"!=typeof navigator&&/safari/i.test(navigator.userAgent)&&!/chrome|crios|android/i.test(navigator.userAgent)&&!/iPad|iPhone|iPod/i.test(navigator.userAgent),we=(e,t)=>{if(!e||!t)return null;const n=q(e),i=t.split(":"),a=parseInt(i[0],10),r=parseInt(i[1],10),s=i[2]?parseInt(i[2],10):0;return n.hour(a).minute(r).second(s)},Ce=(e,t,n,i,a)=>{if(!(e&&t&&n&&i&&0!==i.length&&a))return null;const r=q(a).format("YYYY-MM-DD"),s=i.filter(t=>{const n=t.technicianId||t.practitionerId,i=(t.status||"").toLowerCase(),a=q(t.appointmentDate).format("YYYY-MM-DD");return n===parseInt(e)&&"cancelled"!==i&&"canceled"!==i&&a===r});if(0===s.length)return null;const o=q(a).hour(q(t).hour()).minute(q(t).minute()).second(0),l=q(a).hour(q(n).hour()).minute(q(n).minute()).second(0),d=s.filter(e=>{const t=we(e.appointmentDate,e.startTime),n=we(e.appointmentDate,e.endTime);if(!t||!n)return!1;return o.isBefore(n)&&t.isBefore(l)});if(d.length>0){const e=d[0];return`This technician has an appointment with ${e.fullName||e.patientName||"a patient"} from ${we(e.appointmentDate,e.startTime).format("h:mm A")} to ${we(e.appointmentDate,e.endTime).format("h:mm A")}`}return null};const Ie=({open:a,onClose:r,onSubmit:s,onDelete:o,technicians:l=[],initialData:d=null,selectedDate:h=null,selectedTime:u=null,appointments:p=[],isEditMode:m=!1,isReadOnly:f=!1})=>{const g=e.useMemo(()=>function(e=[],t=null,n=!1){return D().shape({technicianId:k().required("Technician is required."),reason:k().notRequired(),startTime:T().required("Start time is required.").test("is-valid-time","Invalid start time",e=>e&&q(e).isValid()).test("is-multiple-of-10","Minutes must be in multiples of 10",e=>!e||!q(e).isValid()||q(e).minute()%10==0).test("is-not-past","Cannot block time in the past",function(e){if(n||!e||!t)return!0;const i=H();return!q(t).hour(q(e).hour()).minute(q(e).minute()).second(0).isBefore(q(i))||this.createError({message:"Cannot block time in the past"})}).test("no-appointment-conflict",function(n){const{technicianId:i,endTime:a}=this.parent;if(!n||!a||!i)return!0;const r=Ce(i,n,a,e,t);return!r||this.createError({message:r})}),endTime:T().required("End time is required.").test("is-valid-time","Invalid end time",e=>e&&q(e).isValid()).test("is-multiple-of-10","Minutes must be in multiples of 10",e=>!e||!q(e).isValid()||q(e).minute()%10==0).test("is-after-start","End time must be after start time",function(e){const{startTime:t}=this.parent;if(!t||!e)return!0;const n=q(t).hour(),i=q(t).minute();return 60*q(e).hour()+q(e).minute()>60*n+i}).test("is-not-past","Cannot block time ending in the past",function(e){if(n||!e||!t)return!0;const i=H();return!q(t).hour(q(e).hour()).minute(q(e).minute()).second(0).isBefore(q(i))||this.createError({message:"Cannot block time ending in the past"})}).test("no-appointment-conflict",function(n){const{technicianId:i,startTime:a}=this.parent;if(!n||!a||!i)return!0;const r=Ce(i,a,n,e,t);return!r||this.createError({message:r})})})}(p,h,f),[p,h,f]),b=e=>10*Math.round(e/10),y=e=>{if(!e)return"";const t=q.isDayjs(e)?e:q(e);return`${String(t.hour()).padStart(2,"0")}:${String(t.minute()).padStart(2,"0")}`},v=e=>{if(!e)return null;const[t,n]=e.split(":").map(Number),i=b(n),a=new Date;return a.setHours(t),a.setMinutes(i),a.setSeconds(0),a.setMilliseconds(0),q(a)},N=e.useMemo(()=>{const e=function(e=null){return e?{technicianId:e.technicianId||"",reason:e.reason||"",startTime:e.startTime?q.isDayjs(e.startTime)?e.startTime:q(e.startTime):null,endTime:e.endTime?q.isDayjs(e.endTime)?e.endTime:q(e.endTime):null}:{technicianId:"",reason:"",startTime:null,endTime:null}}(d);return e},[d,h,u]),R=()=>{o&&(null==d?void 0:d.technicianBlockedTimeId)&&(o(d.technicianBlockedTimeId),r())};return t.jsx(w,{initialValues:N,validationSchema:g,onSubmit:async(e,{resetForm:t})=>{const n=new Date(h);if(e.startTime){const t=q.isDayjs(e.startTime)?e.startTime:q(e.startTime);n.setHours(t.hour()),n.setMinutes(t.minute()),n.setSeconds(0),n.setMilliseconds(0)}const i=new Date(h);if(e.endTime){const t=q.isDayjs(e.endTime)?e.endTime:q(e.endTime);i.setHours(t.hour()),i.setMinutes(t.minute()),i.setSeconds(0),i.setMilliseconds(0)}const a={technicianId:e.technicianId,reason:e.reason.trim()||null,startTime:n.toISOString(),endTime:i.toISOString()};m&&(null==d?void 0:d.technicianBlockedTimeId)&&(a.technicianBlockedTimeId=d.technicianBlockedTimeId),s(a),t(),r()},enableReinitialize:!0,validateOnMount:!0,validateOnBlur:!0,validateOnChange:!0,children:({values:e,errors:s,touched:d,handleChange:h,handleBlur:u,handleSubmit:p,setFieldValue:g,isValid:D,isSubmitting:T,resetForm:k,submitCount:w})=>t.jsxs(C,{open:a,onClose:()=>{k(),r()},title:f?"View Blocked Time (Read Only)":m?"Edit Blocked Time":"Block Off Time",onSubmit:f?void 0:p,submitLabel:m?"Update":"Block Time",disableSubmit:T||w>0&&!D,customActions:f?t.jsx(c,{variant:"contained",onClick:()=>{k(),r()},sx:{textTransform:"none",borderRadius:"8px",px:3,py:1.5,backgroundColor:"#3b82f6",color:"#ffffff","&:hover":{backgroundColor:"#2563eb"}},children:"Close"}):t.jsxs(t.Fragment,{children:[m&&o&&t.jsx(c,{onClick:R,disabled:T,startIcon:t.jsx(M,{}),sx:{textTransform:"none",color:"#ef4444",borderRadius:"8px",px:3,py:1.5,mr:"auto","&:hover":{backgroundColor:"rgba(239, 68, 68, 0.1)",color:"#dc2626"}},children:"Delete"}),t.jsx(c,{onClick:()=>{k(),r()},disabled:T,sx:{textTransform:"none",color:"#6b7280",borderRadius:"8px",px:3,py:1.5,"&:hover":{backgroundColor:"rgba(59, 130, 246, 0.1)",color:"#2563eb"}},children:"Cancel"}),t.jsx(c,{variant:"contained",onClick:p,disabled:T||w>0&&!D,sx:{textTransform:"none",borderRadius:"8px",px:3,py:1.5,backgroundColor:T||w>0&&!D?"#d1d5db":"#3b82f6",color:T||w>0&&!D?"#9ca3af":"#ffffff",cursor:T||w>0&&!D?"not-allowed":"pointer","&:hover":{backgroundColor:T||w>0&&!D?"#d1d5db":"#2563eb"},"&.Mui-disabled":{backgroundColor:"#d1d5db",color:"#9ca3af",cursor:"not-allowed"}},children:T?"Processing...":m?"Update":"Block Time"})]}),children:[t.jsx(I,{label:"Technician",required:!0,error:(d.technicianId||w>0)&&s.technicianId,children:t.jsx(j,{fullWidth:!0,error:Boolean((d.technicianId||w>0)&&s.technicianId),children:t.jsxs(n,{id:"technicianId",name:"technicianId",value:e.technicianId,onChange:h,onBlur:u,disabled:m||f,displayEmpty:!0,sx:{borderRadius:"8px",backgroundColor:m||f?"#f3f4f6":"#ffffff"},children:[t.jsx(i,{value:"",disabled:!0,children:t.jsx("span",{style:{color:"#9ca3af"},children:"Select a Technician"})}),l.map(e=>t.jsx(i,{value:e.technicianId||e.id,children:e.fullName||(e.firstName&&e.lastName?`${e.firstName} ${e.lastName}`:e.name||"Unknown")},e.technicianId||e.id))]})})}),t.jsx(I,{label:"Reason",placeholder:"e.g., Lunch break, Meeting, Training",value:e.reason,onChange:h,onBlur:u,name:"reason",error:(d.reason||w>0)&&s.reason,disabled:f,inputProps:{readOnly:f,sx:{backgroundColor:f?"#f3f4f6":"#ffffff"}}}),t.jsxs(x,{sx:{display:"flex",gap:2},children:[t.jsx(x,{sx:{flex:1},children:ke()?t.jsx(Te,{label:"Start Time",required:!0,value:y(e.startTime),onChange:e=>{if(!f){const t=v(e);g("startTime",t)}},disabled:f,error:Boolean((d.startTime||w>0)&&s.startTime),helperText:(d.startTime||w>0)&&s.startTime}):t.jsx(I,{label:"Start Time",required:!0,error:(d.startTime||w>0)&&s.startTime,children:t.jsx(S,{type:"time",name:"startTime",fullWidth:!0,value:y(e.startTime),onChange:e=>{if(!f){const t=v(e.target.value);g("startTime",t)}},onBlur:t=>{if(!f&&(u(t),e.startTime)){const t=q.isDayjs(e.startTime)?e.startTime:q(e.startTime),n=t.minute(b(t.minute()));g("startTime",n)}},inputProps:{step:600},InputProps:{readOnly:f},disabled:f,error:Boolean((d.startTime||w>0)&&s.startTime),sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:f?"#f3f4f6":"#ffffff"},"& .MuiOutlinedInput-input":{cursor:f?"not-allowed":"text"}}})})}),t.jsx(x,{sx:{flex:1},children:ke()?t.jsx(Te,{label:"End Time",required:!0,value:y(e.endTime),onChange:e=>{if(!f){const t=v(e);g("endTime",t)}},disabled:f,error:Boolean((d.endTime||w>0)&&s.endTime),helperText:(d.endTime||w>0)&&s.endTime}):t.jsx(I,{label:"End Time",required:!0,error:(d.endTime||w>0)&&s.endTime,children:t.jsx(S,{type:"time",name:"endTime",fullWidth:!0,value:y(e.endTime),onChange:e=>{if(!f){const t=v(e.target.value);g("endTime",t)}},onBlur:t=>{if(!f&&(u(t),e.endTime)){const t=q.isDayjs(e.endTime)?e.endTime:q(e.endTime),n=t.minute(b(t.minute()));g("endTime",n)}},inputProps:{step:600},InputProps:{readOnly:f},disabled:f,error:Boolean((d.endTime||w>0)&&s.endTime),sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:f?"#f3f4f6":"#ffffff"},"& .MuiOutlinedInput-input":{cursor:f?"not-allowed":"text"}}})})})]})]})})};Ie.propTypes={open:b.bool.isRequired,onClose:b.func.isRequired,onSubmit:b.func.isRequired,onDelete:b.func,technicians:b.arrayOf(b.shape({technicianId:b.oneOfType([b.string,b.number]),id:b.oneOfType([b.string,b.number]),fullName:b.string,firstName:b.string,lastName:b.string,name:b.string})),initialData:b.object,selectedDate:b.instanceOf(Date),selectedTime:b.number,appointments:b.arrayOf(b.object),isEditMode:b.bool,isReadOnly:b.bool};const Se=({view:e,setView:a,currentDate:r,setCurrentDate:s,selectedTechnicians:o,handleTechnicianChange:d,technicians:h,handleDateNavigation:p,formatDateHeader:m,appointments:g,hideTechnicianDropdown:b=!1,clinicTimezoneInfo:v=null,readOnlyBlockTimes:D=!1})=>t.jsxs(t.Fragment,{children:[t.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:{xs:1,sm:2},mt:1,mb:3,flexWrap:"wrap","& > *":{flexShrink:0}},children:[t.jsxs(j,{size:"small",sx:{minWidth:{xs:"100%",sm:120},maxWidth:{xs:"100%",sm:"auto"},"& .MuiOutlinedInput-root":{height:"40px"}},children:[t.jsx(y,{children:"View"}),t.jsxs(n,{value:e,label:"View",onChange:e=>a(e.target.value),children:[t.jsx(i,{value:"day",children:"Day View"}),t.jsx(i,{value:"week",children:"Week View"}),t.jsx(i,{value:"month",children:"Month View"})]})]}),t.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,flex:{xs:"1 1 100%",sm:"0 1 auto"},justifyContent:{xs:"space-between",sm:"flex-start"}},children:[t.jsx(u,{onClick:()=>p(-1),size:"small",sx:{height:"40px",width:"40px"},children:t.jsx(N,{})}),t.jsx(S,{type:"date",size:"small",required:!0,value:B(r).split("T")[0],onChange:e=>{if(e.target.value){const[t,n,i]=e.target.value.split("-").map(Number),a=new Date(Date.UTC(t,n-1,i,12,0,0,0));s(a)}},sx:{minWidth:{xs:140,sm:160},flex:{xs:"1",sm:"0 0 auto"},"& .MuiOutlinedInput-root":{height:"40px"},"& input::-webkit-clear-button":{display:"none"},"& input::-ms-clear":{display:"none"}},InputLabelProps:{shrink:!0}}),t.jsx(u,{onClick:()=>p(1),size:"small",sx:{height:"40px",width:"40px"},children:t.jsx(R,{})})]}),t.jsx(c,{variant:"outlined",size:"small",onClick:()=>s(H()),sx:{width:{xs:"100%",sm:"auto"},flex:{xs:"1 1 100%",sm:"0 0 auto"},height:"40px"},children:"Today"}),!b&&t.jsxs(j,{size:"small",sx:{minWidth:{xs:"100%",sm:200},flex:{xs:"1 1 100%",sm:"0 0 auto"},"& .MuiOutlinedInput-root":{height:"40px"}},children:[t.jsx(y,{children:"Technicians"}),t.jsx(n,{multiple:!0,value:o,onChange:d,input:t.jsx(W,{label:"Technicians"}),renderValue:e=>t.jsx(x,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.length===h.length?t.jsx(f,{size:"small",label:"All Technicians"}):e.slice(0,2).map(e=>{const n=h.find(t=>(t.technicianId||t.id)===e),i=(null==n?void 0:n.fullName)||((null==n?void 0:n.firstName)&&(null==n?void 0:n.lastName)?`${n.firstName} ${n.lastName}`:(null==n?void 0:n.name)||"Unknown");return t.jsx(f,{label:i,size:"small"},e)}).concat(e.length>2?[t.jsx(f,{label:`+${e.length-2} more`,size:"small"},"more")]:[])}),children:h.map(e=>t.jsx(i,{value:e.technicianId||e.id,children:e.fullName||(e.firstName&&e.lastName?`${e.firstName} ${e.lastName}`:e.name||"Dr. Unknown")},e.technicianId||e.id))})]}),"day"===e&&!D&&t.jsx(x,{sx:{display:"flex",alignItems:"center",gap:.5,px:1.5,py:.75,borderRadius:1,backgroundColor:"#eef3fe",border:"1px solid rgba(99, 102, 241, 0.2)",flex:{xs:"1 1 100%",sm:"0 0 auto"}},children:t.jsx(l,{variant:"caption",sx:{color:"#8c8c8c",fontWeight:500},children:"Click on empty time slots to block technician time"})})]}),t.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,flexDirection:{xs:"column",sm:"row"},gap:{xs:1,sm:0}},children:[t.jsx(l,{variant:"h6",sx:{textAlign:"center",flex:1,fontSize:{xs:"1.1rem",sm:"1.25rem"}},children:m()}),v&&t.jsx(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:t.jsxs(l,{variant:"caption",sx:{color:"text.secondary",fontSize:"0.75rem",fontWeight:500,backgroundColor:"rgba(59, 130, 246, 0.08)",px:1,py:.5,borderRadius:1,border:"1px solid rgba(59, 130, 246, 0.2)"},children:["All times in ",v]})}),t.jsx(x,{sx:{display:"flex",gap:1,alignItems:"center"}})]})]}),Me=({currentDate:n,appointments:i,technicians:a,selectedTechnicians:r,handleAppointmentClick:s,workingHoursRange:o={startHour:7,endHour:19},isWorkingDay:d,getWorkingHoursForDay:c,onTimeSlotClick:h,blockedTimes:u=[],onBlockedTimeClick:p})=>{const m=ye(a,r),{startHour:f,endHour:g}=o,b=he(f,g),y=60*(g-f+1),[,j]=e.useState(0),v=e.useRef(null);e.useEffect(()=>(v.current=setInterval(()=>{j(e=>e+1)},6e4),()=>{v.current&&clearInterval(v.current)}),[]);const D=n.getDay(),T=!d||d(D);return t.jsxs(x,{sx:{display:"flex",flexDirection:"column"},children:[t.jsx(x,{sx:{display:"flex",borderBottom:"2px solid #e5e7eb",backgroundColor:"#f9fafb",position:"sticky",top:0,zIndex:20},children:t.jsxs(x,{sx:{display:"grid",gridTemplateColumns:`100px repeat(${m.length}, minmax(150px, 1fr))`,flex:1,minWidth:"max-content"},children:[t.jsx(x,{sx:{p:2,borderRight:"1px solid #e5e7eb"},children:t.jsx(l,{variant:"subtitle2",fontWeight:600,children:"Time"})}),m.map(e=>{const i=je(e,n),a=e.fullName||(e.firstName&&e.lastName?`${e.firstName} ${e.lastName}`:e.name||"Dr. Unknown");return t.jsx(V,{title:i?`${a} is on vacation`:"",arrow:!0,placement:"top",children:t.jsxs(x,{sx:{py:2,borderRight:"1px solid #e5e7eb",textAlign:"center",backgroundColor:i?"rgba(239, 68, 68, 0.08)":"transparent"},children:[t.jsxs(l,{variant:"subtitle2",fontWeight:600,noWrap:!0,children:[a,t.jsx(l,{variant:"caption",color:"text.secondary",children:i?" (On Vacation)":""})]}),t.jsx(l,{variant:"caption",color:"text.secondary",children:e.specialization||"General Radiologist"})]})},e.technicianId||e.id)})]})}),t.jsxs(x,{sx:{position:"relative"},children:[!T&&t.jsxs(x,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.05)",zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[t.jsx(l,{variant:"h6",color:"text.secondary",sx:{mb:1},children:"Clinic Closed"}),t.jsxs(l,{variant:"body2",color:"text.secondary",children:["This clinic is not open on ",n.toLocaleDateString("en-US",{weekday:"long"})]})]}),t.jsxs(x,{sx:{display:"grid",gridTemplateColumns:`100px repeat(${m.length}, minmax(150px, 1fr))`,height:y,position:"relative",minWidth:"max-content"},children:[t.jsx(x,{sx:{borderRight:"1px solid #e5e7eb",position:"relative"},children:b.map((e,n)=>t.jsx(x,{sx:{position:"absolute",top:60*n,left:0,right:0,height:60,p:1,display:"flex",alignItems:"flex-start",borderBottom:n<b.length-1?"1px solid #f3f4f6":"none"},children:t.jsx(l,{variant:"caption",color:"text.secondary",children:e.time})},e.hour))}),(()=>{const e=H();if(!(n.toDateString()===e.toDateString())||!T)return null;const i=e.getHours(),a=e.getMinutes();if(i<f||i>g)return null;const r=ge(60*i+a,f);return t.jsx(x,{sx:{position:"absolute",top:r,left:0,right:0,height:"2px",backgroundColor:"#ef4444",zIndex:15,"&::before":{content:'""',position:"absolute",left:"-6px",top:"-4px",width:"8px",height:"8px",backgroundColor:"#ef4444",borderRadius:"50%"}}})})(),m.map((e,a)=>{const r=je(e,n),o=((e,t,n,i=7)=>{const a=B(t).split("T")[0],r=n.filter(t=>{const n=t.appointmentDate?t.appointmentDate.split("T")[0]:null,i=t.technicianId||t.practitionerId;return n===a&&i===e}).map(e=>{const t=fe(e.startTime),n=fe(e.endTime),a=n-t;return{...e,startMinutes:t,endMinutes:n,duration:a,top:ge(t,i),height:Math.max(a/60*60,30)}});return r.forEach((e,t)=>{let n=0;for(let i=0;i<t;i++){const t=r[i];(e.startMinutes>=t.startMinutes&&e.startMinutes<t.endMinutes||t.startMinutes>=e.startMinutes&&t.startMinutes<e.endMinutes||e.startMinutes===t.startMinutes&&e.endMinutes===t.endMinutes)&&n++}e.leftOffset=8*n,e.rightOffset=4*n}),r})(e.technicianId||e.id,n,i,f),l=((e,t,n,i=7)=>{if(!n||0===n.length)return[];const a=B(t).split("T")[0];return n.filter(t=>(t.blockedDate?t.blockedDate.split("T")[0]:null)===a&&t.technicianId==e&&t.isActive).map(e=>{const t=fe(e.startTime),n=fe(e.endTime),a=n-t;return{...e,startMinutes:t,endMinutes:n,duration:a,top:ge(t,i),height:Math.max(a/60*60,20)}})})(e.technicianId||e.id,n,u,f);return t.jsxs(x,{sx:{borderRight:a<m.length-1?"1px solid #e5e7eb":"none",position:"relative",height:y,backgroundColor:r?"rgba(239, 68, 68, 0.1)":"transparent"},children:[b.map((i,a)=>{const s=60*i.hour+60,o=H(),l=60*o.getHours()+o.getMinutes(),d=n.getFullYear()===o.getFullYear()&&n.getMonth()===o.getMonth()&&n.getDate()===o.getDate()&&s<=l;return t.jsx(x,{onClick:t=>{if(t.target===t.currentTarget&&T&&!r&&!d&&h){const a=t.currentTarget.getBoundingClientRect(),r=t.clientY-a.top,s=Math.max(0,Math.min(59,Math.floor(r/a.height*60))),o=10*Math.round(s/10),l=60*i.hour+o;h(n,l,e.technicianId||e.id)}},sx:{position:"absolute",top:60*a,left:0,right:0,height:60,borderBottom:a<b.length-1?"1px solid #f3f4f6":"none",opacity:d?.5:1,backgroundColor:d?"#f9fafb":"transparent","&:hover":{backgroundColor:d?"#f9fafb":r?"rgba(239, 68, 68, 0.15)":"#f9fafb",cursor:d||r||!T?"not-allowed":"pointer"},transition:"background-color 0.1s ease"}},`grid-${i.hour}`)}),l.map(e=>t.jsx(De,{blockedTime:e,onClick:p,variant:"positioned",padding:.5},e.technicianBlockedTimeId)),o.map(e=>t.jsx(ve,{appointment:e,onClick:s,variant:"positioned",padding:.5},e.appointmentId))]},e.technicianId||e.id)})]})]})]})},Ne=({title:e,children:n,placement:i="top",arrow:a=!0,enterDelay:r=500,leaveDelay:s=200,...o})=>t.jsx(V,{title:e,placement:i,arrow:a,enterDelay:r,leaveDelay:s,componentsProps:{tooltip:{sx:{fontSize:"0.75rem",fontWeight:500,backgroundColor:"rgba(55, 65, 81, 0.95)",backdropFilter:"blur(8px)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"6px",padding:"8px 12px",maxWidth:"250px",lineHeight:1.4,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"}},arrow:{sx:{color:"rgba(55, 65, 81, 0.95)","&::before":{border:"1px solid rgba(255, 255, 255, 0.1)",backgroundColor:"rgba(55, 65, 81, 0.95)"}}}},...o,children:n}),Re=({currentDate:e,appointments:n,technicians:i,selectedTechnicians:a,handleAppointmentClick:r,workingDays:s=[],isWorkingDay:o,getWorkingHoursForDay:d,onDayClick:c})=>{const h=xe(e),u=pe(e),p=me(e),m=ye(i,a),g=[];for(let t=0;t<h.length;t+=7)g.push(h.slice(t,t+7));return t.jsxs(x,{sx:{display:"flex",flexDirection:"column"},children:[t.jsx(x,{sx:{display:"grid",gridTemplateColumns:"repeat(7, minmax(100px, 1fr))",borderBottom:"2px solid #e5e7eb",backgroundColor:"#f9fafb",position:"sticky",top:0,zIndex:20,minWidth:"700px"},children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>t.jsx(x,{sx:{p:2,textAlign:"center",borderRight:"1px solid #e5e7eb","&:last-child":{borderRight:"none"}},children:t.jsx(l,{variant:"subtitle2",fontWeight:600,color:"text.secondary",children:e})},e))}),t.jsx(x,{children:t.jsx(x,{sx:{display:"flex",flexDirection:"column"},children:g.map((e,i)=>t.jsx(x,{sx:{display:"grid",gridTemplateColumns:"repeat(7, minmax(100px, 1fr))",minHeight:"120px",minWidth:"700px"},children:e.map((e,a)=>{const s=e>=u&&e<=p,d=H(),h=e.toDateString()===d.toDateString(),b=e.getDay(),y=!o||o(b),j=((e,t,n)=>{const i=B(e).split("T")[0];return t.filter(e=>{const t=e.appointmentDate?e.appointmentDate.split("T")[0]:null,a=e.technicianId||e.practitionerId,r=t===i,s=n.some(e=>(e.technicianId||e.id)===a);return r&&s})})(e,n,m),v=m.filter(t=>je(t,e)),D=v.length,T=v.map(e=>e.fullName||(e.firstName&&e.lastName?`${e.firstName} ${e.lastName}`:e.name||"Unknown")).join(", ");return t.jsxs(x,{sx:{borderRight:a<6?"1px solid #e5e7eb":"none",borderBottom:i<g.length-1?"1px solid #e5e7eb":"none",p:1,backgroundColor:h?"rgba(59, 130, 246, 0.04)":s?y?"transparent":"rgba(107, 114, 128, 0.015)":"rgba(107, 114, 128, 0.02)",position:"relative",minHeight:"120px",minWidth:0,overflow:"hidden","&:hover":{backgroundColor:h?"rgba(59, 130, 246, 0.08)":s?y?"#f9fafb":"rgba(107, 114, 128, 0.03)":"rgba(107, 114, 128, 0.04)",cursor:y&&s?"pointer":"not-allowed"},transition:"background-color 0.15s ease"},onClick:()=>{y&&s&&c&&c(e)},children:[t.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[t.jsx(l,{variant:"body2",fontWeight:h?700:s?600:400,sx:{color:h?"primary.main":s?y?"text.primary":"#6b7280":"#9ca3af",backgroundColor:h?"primary.50":"transparent",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",opacity:y?1:.6},children:e.getDate()}),!y&&s&&t.jsx(l,{variant:"caption",sx:{fontSize:"8px",color:"#6b7280",fontWeight:500,position:"absolute",top:"2px",right:"2px",opacity:.7},children:"✕"}),j.length>0&&t.jsx(Ne,{title:`${j.length} appointment${1===j.length?"":"s"}`,children:t.jsx(x,{sx:{backgroundColor:"primary.main",color:"white",borderRadius:"10px",px:.5,py:.25,fontSize:"10px",fontWeight:600,minWidth:"16px",textAlign:"center",cursor:"help"},children:j.length})})]}),D>0&&s&&t.jsx(x,{sx:{mb:.5},children:t.jsx(V,{title:T,arrow:!0,placement:"top",children:t.jsx(f,{label:`${D} on vacation`,size:"small",sx:{height:"16px",fontSize:"9px",backgroundColor:"rgba(239, 68, 68, 0.1)",color:"#dc2626",fontWeight:500,"& .MuiChip-label":{px:.75}}})})}),t.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:.25,maxHeight:"90px",overflow:"hidden",width:"100%",minWidth:0},children:[j.slice(0,4).map((e,n)=>t.jsx(ve,{appointment:e,onClick:r,variant:"default"},e.appointmentId)),j.length>4&&t.jsxs(x,{sx:{textAlign:"center",color:"text.secondary",fontSize:"9px",fontWeight:500,pt:.25},children:["+",j.length-4," more"]})]})]},B(e))})},i))})})]})},We=({currentDate:n,appointments:i,technicians:a,selectedTechnicians:r,handleAppointmentClick:s,workingHoursRange:o={startHour:7,endHour:19},isWorkingDay:d,getWorkingHoursForDay:c})=>{const h=ye(a,r),u=(e=>{const t=ue(e),n=[];for(let i=0;i<7;i++){const e=new Date(t);e.setDate(t.getDate()+i),n.push(e)}return n})(n),{startHour:p,endHour:m}=o,g=he(p,m),b=60*(m-p+1),[,y]=e.useState(0),j=e.useRef(null);return e.useEffect(()=>(j.current=setInterval(()=>{y(e=>e+1)},6e4),()=>{j.current&&clearInterval(j.current)}),[]),t.jsxs(x,{sx:{display:"flex",flexDirection:"column"},children:[t.jsxs(x,{sx:{display:"flex",borderBottom:"2px solid #e5e7eb",backgroundColor:"#f9fafb",position:"sticky",top:0,zIndex:20},children:[t.jsx(x,{sx:{width:"100px",p:2,borderRight:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(l,{variant:"subtitle2",fontWeight:600,children:"Time"})}),t.jsx(x,{sx:{flex:1,display:"grid",gridTemplateColumns:`repeat(${u.length}, minmax(120px, 1fr))`,minWidth:"max-content"},children:u.map((e,n)=>{const i=e.getDay(),a=!d||d(i),r=H(),s=e.toDateString()===r.toDateString(),o=h.filter(t=>je(t,e)),c=o.length,p=o.map(e=>e.fullName||(e.firstName&&e.lastName?`${e.firstName} ${e.lastName}`:e.name||"Unknown")).join(", ");return t.jsx(x,{sx:{borderRight:n<u.length-1?"1px solid #e5e7eb":"none",p:1,backgroundColor:a?"transparent":"rgba(107, 114, 128, 0.05)"},children:t.jsxs(x,{sx:{textAlign:"center",mb:1},children:[t.jsx(l,{variant:"caption",color:"text.secondary",sx:{display:"block",textTransform:"uppercase",letterSpacing:"0.5px",color:a?"text.secondary":"#6b7280"},children:e.toLocaleDateString("en-US",{weekday:"short"})}),t.jsx(l,{variant:"h6",fontWeight:600,sx:{color:s?"primary.main":a?"text.primary":"#6b7280",backgroundColor:s?"primary.50":"transparent",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto"},children:e.getDate()}),c>0&&t.jsx(V,{title:p,arrow:!0,placement:"top",children:t.jsx(f,{label:`${c} on vacation`,size:"small",sx:{mt:.5,height:"18px",fontSize:"10px",backgroundColor:"rgba(239, 68, 68, 0.1)",color:"#dc2626",fontWeight:500,"& .MuiChip-label":{px:1}}})})]})},B(e))})})]}),t.jsx(x,{sx:{position:"relative"},children:t.jsxs(x,{sx:{display:"flex",height:b,position:"relative"},children:[t.jsx(x,{sx:{width:"100px",borderRight:"1px solid #e5e7eb",position:"relative"},children:g.map((e,n)=>t.jsx(x,{sx:{position:"absolute",top:60*n,left:0,right:0,height:60,p:1,display:"flex",alignItems:"flex-start",borderBottom:n<g.length-1?"1px solid #f3f4f6":"none"},children:t.jsx(l,{variant:"caption",color:"text.secondary",children:e.time})},e.hour))}),t.jsx(x,{sx:{flex:1,display:"grid",gridTemplateColumns:`repeat(${u.length}, minmax(120px, 1fr))`,position:"relative",minWidth:"max-content"},children:u.map((e,n)=>{const a=H(),r=e.toDateString()===a.toDateString(),o=e.getDay(),c=!d||d(o);return t.jsxs(x,{sx:{borderRight:n<u.length-1?"1px solid #e5e7eb":"none",position:"relative",height:b,backgroundColor:r?"rgba(59, 130, 246, 0.04)":c?"transparent":"rgba(107, 114, 128, 0.02)"},children:[!c&&t.jsx(x,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.03)",zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(l,{variant:"caption",color:"text.secondary",sx:{transform:"rotate(-45deg)",fontSize:"10px",fontWeight:500,opacity:.7},children:"CLOSED"})}),g.map((e,n)=>t.jsx(x,{sx:{position:"absolute",top:60*n,left:0,right:0,height:60,borderBottom:n<g.length-1?"1px solid #f3f4f6":"none","&:hover":{backgroundColor:r?"rgba(59, 130, 246, 0.08)":c?"#f9fafb":"rgba(107, 114, 128, 0.05)",cursor:c?"pointer":"not-allowed"},transition:"background-color 0.15s ease"}},`grid-${e.hour}`)),r&&c&&(()=>{const e=H(),n=e.getHours(),i=e.getMinutes();if(n>=p&&n<=m){const e=ge(60*n+i,p);return t.jsx(x,{sx:{position:"absolute",top:e,left:0,right:0,height:"2px",backgroundColor:"#ef4444",zIndex:15,"&::before":{content:'""',position:"absolute",left:"-6px",top:"-4px",width:"8px",height:"8px",backgroundColor:"#ef4444",borderRadius:"50%"}}})}return null})(),(()=>{const n=[];return h.forEach((t,a)=>{const r=((e,t,n,i=7)=>{const a=B(e).split("T")[0];return n.filter(e=>{const n=e.appointmentDate?e.appointmentDate.split("T")[0]:null,i=e.technicianId||e.practitionerId;return n===a&&i===t}).map(e=>{const t=fe(e.startTime),n=fe(e.endTime),a=n-t;return{...e,startMinutes:t,endMinutes:n,duration:a,top:ge(t,i),height:Math.max(a/60*60,30)}})})(e,t.technicianId||t.id,i,p);r.forEach(e=>{n.push({...e,technicianName:t.fullName||(t.firstName&&t.lastName?`${t.firstName} ${t.lastName}`:t.name||"Dr. Unknown"),technicianIndex:a})})}),n.sort((e,t)=>e.startMinutes-t.startMinutes),n.forEach((e,t)=>{let i=0;for(let a=0;a<t;a++){const t=n[a];(e.startMinutes>=t.startMinutes&&e.startMinutes<t.endMinutes||t.startMinutes>=e.startMinutes&&t.startMinutes<e.endMinutes||e.startMinutes===t.startMinutes&&e.endMinutes===t.endMinutes)&&i++}e.leftOffset=6*i,e.rightOffset=3*i}),n.map((e,n)=>t.jsx(ve,{appointment:e,onClick:s,variant:"positioned",showTechnician:h.length>1,technicianName:e.technicianName,offsetDivisor:6,padding:.5},`${e.appointmentId}-${e.technicianIndex}`))})()]},B(e))})})]})})]})},Ee=({open:n=!0,onClose:i=()=>{},clinicId:d,technicianId:c=null,asModal:h=!0,showTitle:f=!0,hideTechnicianDropdown:g=!1,onEdit:b=null,canModifyAppointment:y=null,readOnlyBlockTimes:j=!1})=>{const[v,D]=e.useState(()=>null!==F()?H():new Date),[T,k]=e.useState("day"),[w,C]=e.useState([]),[I,S]=e.useState([]),[M,N]=e.useState([]),[R,W]=e.useState(!1),[L,P]=e.useState(null),[V,q]=e.useState(!1),[Y,_]=e.useState(!1),[G,K]=e.useState(!1),[J,Q]=e.useState(null),[X,Z]=e.useState(!1),[ee,te]=e.useState(null),{createBlockedTime:ne}=(()=>{const[t,n]=e.useState(!1),[i,a]=e.useState(null),[r,s]=e.useState(null);return{createBlockedTime:e.useCallback(async e=>{n(!0),a(null),s(null);try{const t=await le(e);return s(t),t}catch(t){throw a(t.message||"Failed to create blocked time"),t}finally{n(!1)}},[]),isLoading:t,error:i,lastCreated:r}})(),{updateBlockedTime:ie}=(()=>{const[t,n]=e.useState(!1),[i,a]=e.useState(null),[r,s]=e.useState(null);return{updateBlockedTime:e.useCallback(async(e,t)=>{n(!0),a(null),s(null);try{const n=await de(e,t);return s(n),n}catch(i){throw a(i.message||"Failed to update blocked time"),i}finally{n(!1)}},[]),isLoading:t,error:i,lastUpdated:r}})(),{deleteBlockedTime:re}=(()=>{const[t,n]=e.useState(!1),[i,a]=e.useState(null);return{deleteBlockedTime:e.useCallback(async e=>{n(!0),a(null);try{return await ce(e)}catch(t){throw a(t.message||"Failed to delete blocked time"),t}finally{n(!1)}},[]),isLoading:t,error:i}})(),{blockedTimes:se,fetchBlockedTimes:he}=(()=>{const[t,n]=e.useState(!1),[i,a]=e.useState(null),[r,s]=e.useState([]);return{blockedTimes:r,fetchBlockedTimes:e.useCallback(async(e={})=>{n(!0),a(null);try{const t=await oe(e);return s(t||[]),t}catch(t){throw a(t.message||"Failed to fetch blocked times"),s([]),t}finally{n(!1)}},[]),isLoading:t,error:i}})(),{workingHours:pe,workingDays:me,isLoading:fe,error:ge,getWorkingHoursRange:be,isWorkingDay:ye,getWorkingHoursForDay:je}=(t=>{const[n,i]=e.useState([]),[r,s]=e.useState(!1),[o,l]=e.useState(null),d=e.useCallback(async()=>{if(t){s(!0),l(null);try{const e=(await a.get(`https://healthco.clinic/api/fhir/Calendar/ClinicDetails/${t}`)).data;i(e.workingHours||[])}catch(e){l(e.message||"Failed to fetch clinic working hours")}finally{s(!1)}}},[t]);e.useEffect(()=>{d()},[d]);const c=n.filter(e=>e.isAvailable).map(e=>e.dayOfWeek).sort((e,t)=>e-t);return{workingHours:n,workingDays:c,isLoading:r,error:o,refetch:d,getWorkingHoursRange:()=>{const e=n.filter(e=>e.isAvailable&&e.startTime&&e.endTime);if(0===e.length)return{startHour:7,endHour:19};const t=e.map(e=>{const[t]=e.startTime.split(":").map(Number);return t}),i=e.map(e=>{const[t]=e.endTime.split(":").map(Number);return t});return{startHour:Math.min(...t),endHour:Math.max(...i)}},isWorkingDay:e=>c.includes(e),getWorkingHoursForDay:e=>n.find(t=>t.dayOfWeek===e&&t.isAvailable)}})(d);e.useEffect(()=>{if(ge&&(h?n:d)){const e=localStorage.getItem("userRole");e===O.TECHNICIAN||e===O.CLINIC_STAFF_MEMBER?r.error("The clinic working hours have not been set up. Please contact the Clinic Admin."):r.error("We couldn't find your clinic's working hours. Have you set up the clinic calendar yet?")}},[ge,n,h,d]),e.useEffect(()=>{h&&!n||!d||(async()=>{if(d)try{await z(d);const e=F();if(null!==e){const t=Math.floor(Math.abs(e)/60),n=Math.abs(e)%60,i=`UTC${e>=0?"+":"-"}${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`;te(i),D(H())}}catch(e){r.error("Failed to load clinic timezone. Using browser time.")}})()},[n,d,h]),e.useEffect(()=>{h&&!n||!d||(async()=>{if(d)try{const e=await A(d),t=Array.isArray(e.data)?e.data:[];if(S(t),c){const e=[parseInt(c)];N(e)}else{const e=t.map(e=>e.technicianId||e.id);N(e)}}catch(e){r.error("Failed to fetch technicians")}})()},[n,d,c,h]),e.useEffect(()=>{const e=e=>{h&&!n||G||("ArrowLeft"===e.key?(e.preventDefault(),D(e=>{const t=new Date(e);return"day"===T?t.setDate(t.getDate()-1):"week"===T?t.setDate(t.getDate()-7):"month"===T&&t.setMonth(t.getMonth()-1),t})):"ArrowRight"===e.key?(e.preventDefault(),D(e=>{const t=new Date(e);return"day"===T?t.setDate(t.getDate()+1):"week"===T?t.setDate(t.getDate()+7):"month"===T&&t.setMonth(t.getMonth()+1),t})):"t"!==e.key&&"T"!==e.key||(e.preventDefault(),D(new Date)))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[n,T,h,G]),e.useEffect(()=>{(async()=>{var e,t;if(d&&(!h||n)){W(!0);try{let n,i,r=[];if("week"===T)n=ue(v),i=new Date(n),i.setDate(n.getDate()+6);else if("month"===T){const e=xe(v);n=e[0],i=e[e.length-1]}else n=new Date(v),i=new Date(v);if(M.length>0&&M.length<I.length){const e=M.map(e=>a.get("https://healthco.clinic/api/fhir/Appointment",{params:{clinicId:d,technicianId:e}}));r=(await Promise.all(e)).flatMap(e=>{var t,n;return(null==(t=e.data)?void 0:t.data)||(null==(n=e.data)?void 0:n.value)||e.data||[]})}else{const n=await a.get("https://healthco.clinic/api/fhir/Appointment",{params:{clinicId:d}});r=(null==(e=n.data)?void 0:e.data)||(null==(t=n.data)?void 0:t.value)||n.data||[]}C(r)}catch(i){r.error("Failed to fetch appointments")}finally{W(!1)}}})()},[n,d,M,v,I.length,T,h]),e.useEffect(()=>{(async()=>{if(d&&(!h||n)&&"day"===T)try{let e,t;if("week"===T)e=ue(v),t=new Date(e),t.setDate(e.getDate()+6);else if("month"===T){const n=xe(v);e=n[0],t=n[n.length-1]}else e=new Date(v),t=new Date(v);const n={fromDate:B(e),toDate:B(t),isActive:!0};await he(n)}catch(e){}})()},[n,d,v,T,h,he]);const ve=e=>{const t=e.target.value;N("string"==typeof t?t.split(","):t)},De=e=>{(async e=>{var t;_(!0);try{const n=await a.get(`https://healthco.clinic/api/fhir/Appointment/${e}`),i=(null==(t=n.data)?void 0:t.value)||n.data;P(i),q(!0)}catch(n){r.error("Failed to fetch appointment details")}finally{_(!1)}})(e)},Te=()=>{q(!1),P(null)},ke=e=>{const t=new Date(v);"day"===T?t.setDate(t.getDate()+e):"week"===T?t.setDate(t.getDate()+7*e):"month"===T&&t.setMonth(t.getMonth()+e),D(t)},we=e=>{D(e),k("day")},Ce=(e,t,n)=>{if(j)return;const i=new Date(e),a=Math.floor(t/60),s=t%60;i.setHours(a,s,0,0);i<H()?r.error("Cannot block time in the past"):(Q({selectedDate:e,selectedTime:t,selectedTechnicianId:n}),Z(!1),K(!0))},Ne=e=>{let t;if("string"==typeof e.blockedDate){const n=e.blockedDate.split("T")[0],[i,a,r]=n.split("-").map(Number);t=new Date(i,a-1,r)}else t=new Date(e.blockedDate);const n=e=>{const[t,n]=e.split(":").map(Number);return{hours:t,minutes:n}},i=n(e.startTime),a=n(e.endTime),r=new Date(t);r.setHours(i.hours,i.minutes,0,0);const s=new Date(t);s.setHours(a.hours,a.minutes,0,0);const o=H(),l=j||r<o;Q({selectedDate:t,selectedTime:null,selectedTechnicianId:e.technicianId,initialData:{technicianBlockedTimeId:e.technicianBlockedTimeId,technicianId:e.technicianId,reason:e.reason||"",startTime:r,endTime:s},isReadOnly:l}),Z(!l),K(!0)},Ee=async e=>{try{const t=new Date(e.startTime),n=new Date(e.endTime),i=e=>String(e).padStart(2,"0"),a=`${i(t.getHours())}:${i(t.getMinutes())}:00`,s=`${i(n.getHours())}:${i(n.getMinutes())}:00`;if(X&&e.technicianBlockedTimeId){const t={technicianBlockedTimeId:e.technicianBlockedTimeId,technicianId:e.technicianId,startTime:a,endTime:s,reason:e.reason||null};await ie(e.technicianBlockedTimeId,t),r.success("Blocked time updated successfully")}else{const n=B(t),i={technicianId:e.technicianId,blockedDate:n,startTime:a,endTime:s,reason:e.reason||null};await ne(i),r.success("Time blocked successfully")}const o=new Date(v),l=new Date(v);await he({fromDate:B(o),toDate:B(l),isActive:!0}),K(!1),Q(null),Z(!1)}catch(t){r.error(t.message||`Failed to ${X?"update":"block"} time`)}},Oe=async e=>{try{await re(e),r.success("Blocked time deleted successfully");const t=new Date(v),n=new Date(v);await he({fromDate:B(t),toDate:B(n),isActive:!0}),K(!1),Q(null),Z(!1)}catch(t){r.error(t.message||"Failed to delete blocked time")}},$e=()=>{K(!1),Q(null),Z(!1)},Ae=()=>t.jsxs(x,{sx:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[f&&!h&&t.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:3,px:3,pt:3},children:[t.jsx(E,{size:24}),t.jsx(l,{variant:"h6",fontWeight:600,children:"Appointments Calendar"})]}),t.jsx(x,{sx:{px:h?3:0,pt:0,flexShrink:0},children:t.jsx(Se,{view:T,setView:k,currentDate:v,setCurrentDate:D,selectedTechnicians:M,handleTechnicianChange:ve,technicians:I,handleDateNavigation:ke,formatDateHeader:()=>((e,t)=>{if("day"===e)return t.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});if("week"===e){const e=ue(t),n=new Date(e);return n.setDate(e.getDate()+6),e.getMonth()===n.getMonth()?`${e.toLocaleDateString("en-US",{month:"long",year:"numeric"})} ${e.getDate()} - ${n.getDate()}`:`${e.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`}return"month"===e?t.toLocaleDateString("en-US",{year:"numeric",month:"long"}):t.toLocaleDateString()})(T,v),appointments:w,workingHours:pe,workingDays:me,isWorkingDay:ye,hideTechnicianDropdown:g,clinicTimezoneInfo:ee,readOnlyBlockTimes:j})}),t.jsx(x,{sx:{flex:1,overflow:"auto",px:h?3:0,pb:h?3:0,"&::-webkit-scrollbar":{height:"8px",width:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:"rgba(0, 0, 0, 0.05)",borderRadius:"4px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0, 0, 0, 0.2)",borderRadius:"4px","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.3)"}}},children:t.jsx(x,{sx:{minWidth:"day"===T?`${Math.max(600,100+200*(M.length||1))}px`:"week"===T?"900px":"month"===T?"700px":"auto",width:"month"===T?"100%":"auto"},children:R||fe?t.jsxs(x,{sx:{display:"flex",flexDirection:"column"},children:[t.jsx(x,{sx:{display:"flex",borderBottom:"2px solid #e5e7eb",backgroundColor:"#f9fafb",position:"sticky",top:0,zIndex:2},children:"month"===T?t.jsx(x,{sx:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",width:"100%"},children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>t.jsx(x,{sx:{p:2,borderRight:"1px solid #e5e7eb"},children:t.jsx(U,{variant:"text",width:"60%",height:20,sx:{mx:"auto"}})},e))}):t.jsxs(x,{sx:{display:"flex",width:"100%"},children:[t.jsx(x,{sx:{width:"100px",p:2,borderRight:"1px solid #e5e7eb"},children:t.jsx(U,{variant:"text",width:"60%",height:20})}),[...Array("day"===T?M.length||3:7)].map((e,n)=>t.jsxs(x,{sx:{flex:1,p:2,borderRight:"1px solid #e5e7eb",minWidth:"150px"},children:[t.jsx(U,{variant:"text",width:"80%",height:20,sx:{mx:"auto"}}),t.jsx(U,{variant:"text",width:"60%",height:16,sx:{mx:"auto",mt:.5}})]},n))]})}),t.jsxs(x,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:3},children:[t.jsx($,{size:48,sx:{color:"#3b82f6","& .MuiCircularProgress-circle":{strokeLinecap:"round"}}}),t.jsxs(x,{sx:{textAlign:"center"},children:[t.jsx(l,{variant:"h6",color:"text.secondary",fontWeight:500,children:"Loading appointments..."}),t.jsx(l,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Fetching your schedule data"})]}),t.jsx(x,{sx:{width:"100%",maxWidth:"800px",px:4},children:"month"===T?t.jsx(x,{sx:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:1},children:[...Array(28)].map((e,n)=>t.jsxs(x,{sx:{height:"80px",border:"1px solid #f3f4f6",borderRadius:1,p:1},children:[t.jsx(U,{variant:"text",width:"30%",height:16}),t.jsx(U,{variant:"rectangular",width:"90%",height:12,sx:{mt:1,borderRadius:.5}}),t.jsx(U,{variant:"rectangular",width:"70%",height:10,sx:{mt:.5,borderRadius:.5}})]},n))}):t.jsx(x,{sx:{display:"flex",flexDirection:"column",gap:1},children:[...Array(6)].map((e,n)=>t.jsxs(x,{sx:{display:"flex",gap:2,alignItems:"center"},children:[t.jsx(U,{variant:"text",width:"60px",height:20}),t.jsx(x,{sx:{flex:1,display:"flex",gap:1},children:[...Array(Math.floor(3*Math.random())+1)].map((e,n)=>t.jsx(U,{variant:"rectangular",width:20+30*Math.random()+"%",height:40,sx:{borderRadius:1}},n))})]},n))})})]})]}):"day"===T?t.jsx(Me,{currentDate:v,appointments:w,technicians:I,selectedTechnicians:M,handleAppointmentClick:De,workingHoursRange:be(),isWorkingDay:ye,getWorkingHoursForDay:je,onTimeSlotClick:j?void 0:Ce,blockedTimes:se,onBlockedTimeClick:Ne}):"week"===T?t.jsx(We,{currentDate:v,appointments:w,technicians:I,selectedTechnicians:M,handleAppointmentClick:De,workingHoursRange:be(),isWorkingDay:ye,getWorkingHoursForDay:je}):"month"===T?t.jsx(Re,{currentDate:v,appointments:w,technicians:I,selectedTechnicians:M,handleAppointmentClick:De,workingDays:me,isWorkingDay:ye,getWorkingHoursForDay:je,onDayClick:we}):t.jsx(x,{sx:{display:"flex",justifyContent:"center",p:4},children:t.jsxs(l,{color:"text.secondary",children:[T.charAt(0).toUpperCase()+T.slice(1)," view coming soon..."]})})})}),t.jsx(ae,{open:V,onClose:Te,selectedAppointment:L,appointmentDetailsLoading:Y,onEdit:b,canModifyAppointment:y}),t.jsx(Ie,{open:G,onClose:$e,onSubmit:Ee,onDelete:Oe,technicians:I,selectedDate:null==J?void 0:J.selectedDate,selectedTime:null==J?void 0:J.selectedTime,initialData:(null==J?void 0:J.initialData)||((null==J?void 0:J.selectedTechnicianId)?{technicianId:J.selectedTechnicianId}:null),appointments:w,isEditMode:X,isReadOnly:(null==J?void 0:J.isReadOnly)||!1})]});return h?t.jsxs(s,{open:n,onClose:i,maxWidth:"xl",fullWidth:!0,scroll:"paper",slotProps:{paper:{sx:{borderRadius:"16px",margin:"32px",maxHeight:"calc(100vh - 64px)",height:"auto",overflow:"hidden",display:"flex",flexDirection:"column","@media (max-width: 768px)":{margin:"16px",maxWidth:"calc(100vw - 32px)",maxHeight:"calc(100vh - 32px)"}}}},children:[t.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pb:2,flexShrink:0},children:[t.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2},children:[t.jsx(E,{size:24}),t.jsx(l,{variant:"h6",fontWeight:600,children:"Appointments Calendar"})]}),t.jsx(u,{onClick:i,size:"small",children:t.jsx(p,{})})]}),t.jsx(m,{sx:{p:0,flex:1,overflow:"hidden",display:"flex",flexDirection:"column","&.MuiDialogContent-root":{padding:0,overflow:"hidden"}},children:t.jsx(Ae,{})})]}):t.jsx(x,{sx:{width:"100%"},children:t.jsx(Ae,{})})};export{_ as A,Ee as V,Z as a,Y as b,ee as c,ie as d,ae as e,ne as f,X as g,te as h,Q as l};
