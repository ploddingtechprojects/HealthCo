import{r as e,aG as i,j as a,p as t,T as s,o as n,ad as r,ae as o,k as l,aI as d,P as c,aJ as u,d as p,aK as x,ak as m,aL as f,c as y,aM as h,f as g,aN as b,a9 as v,aO as j,F as C,am as I,ac as T,S,B as k,m as w,y as R,U as q,aP as D,al as N,e as A,aQ as O}from"./index-DyR0ftVW.js";import{D as M,C as H,a as G}from"./CommonCard-C_xn2Pzb.js";import{D as B}from"./DeleteConfirmationDialog-DKqJK7p7.js";import{M as E}from"./ManagementHeader-ym6m9w7H.js";import{u as z}from"./useClinicSync-pPWROp7F.js";import{A as _,R as Q}from"./AddRuleButton-CNq58Mhk.js";import{C as W}from"./CommonCheckbox-aJ2wZ0C8.js";import{S as F,a as P,P as L,b as $,R as U,c as V}from"./bookingRules-DFQhlYAe.js";import{C as K}from"./Cancel-C2DgCmhH.js";import{I as Y}from"./InputAdornment-BBfdgTpM.js";import{I as J}from"./AntdIcon-2OxomVw-.js";import{E as X}from"./EditButton-Dv5A9b9C.js";import{T as Z,S as ee,C as ie}from"./TruncateTooltip-BVddiBa5.js";import"./Tooltip-Cof9Jr1h.js";import"./EditOutlined-CjO-a_sD.js";import"./WarningOutlined-Pm6jC2mV.js";import"./DialogActions-BmwBtQrJ.js";const ae={range:1,"less than":2,"more than":3},te=0,se=1,ne=2,re={yesno:1,text:2,radio:3,multiselect:4,dateselect:5};var oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"minus",theme:"outlined"};function le(){return le=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t])}return e},le.apply(this,arguments)}const de=(i,a)=>e.createElement(J,le({},i,{ref:a,icon:oe})),ce=e.forwardRef(de),ue=i(a.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"})),pe=i(a.jsx("path",{d:"M16.53 11.06 15.47 10l-4.88 4.88-2.12-2.12-1.06 1.06L10.59 17zM19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V8h14z"})),xe=i(a.jsx("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02z"}));function me(e){if(null==e)return[];if(Array.isArray(e))return ye(e);const i=String(e).trim();if(0===i.length)return[];try{const e=JSON.parse(i);if(Array.isArray(e))return ye(e)}catch(a){}return ye(i.split(",").map(e=>e.trim()).filter(e=>e.length>0))}function fe(e){const i=ye(Array.isArray(e)?e:me(e));return JSON.stringify(i)}function ye(e){const i=[],a=new Set;for(const t of e){if(null==t)continue;const e=String(t).trim();if(!e)continue;const s=e.toLowerCase();a.has(s)||(a.add(s),i.push(e))}return i}const he=({bookingRules:e=[],errors:i={},submitCount:c=0,setFieldValue:u})=>{const p=(i,a)=>{const t=[...e||[]];t[i]={...t[i],...a},u("bookingRules",t)},x=(i,a)=>(e||[]).some((e,t)=>t!==a&&e.ruleType===i),m=()=>{const i=(e||[]).map(e=>e.ruleType).filter(Boolean);return[P.OB_HIGH_RISK,P.NT_SCAN].every(e=>i.includes(e))};return a.jsxs(t,{sx:{mt:2},children:[a.jsx(s,{variant:"body1",sx:{mb:.5,color:"#374151",fontWeight:500},children:"Special Booking Rules (optional)"}),a.jsx(s,{variant:"caption",sx:{display:"block",color:"#6b7280",mb:2},children:"Configure special booking requirements for OB High-Risk Scans and NT Scans only."}),c>0&&i.bookingRules&&a.jsxs(t,{sx:{mb:2,p:1.5,borderRadius:1,background:"#fef2f2",border:"1px solid #fca5a5",display:"flex",alignItems:"center",gap:1},children:[a.jsx(t,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:16,height:16,borderRadius:"50%",backgroundColor:"#dc2626",color:"white",fontSize:"12px",fontWeight:"bold"},children:"!"}),a.jsx(s,{variant:"caption",sx:{color:"#dc2626",fontWeight:500},children:i.bookingRules})]}),(e||[]).map((i,c)=>a.jsxs(t,{sx:{mb:1,p:2,borderRadius:2,background:"#f0f9ff",border:"1px solid #bae6fd"},children:[a.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[a.jsxs(s,{variant:"subtitle2",sx:{fontWeight:600,color:"#0c4a6e"},children:["Booking Rule ",c+1]}),a.jsx(M,{onDelete:()=>(i=>{const a=[...e||[]];a.splice(i,1),u("bookingRules",a)})(c),fontSize:16})]}),a.jsxs(t,{sx:{display:"flex",gap:2,mb:2,flexDirection:{xs:"column",sm:"row"},alignItems:"flex-start"},children:[a.jsxs(t,{sx:{minWidth:{xs:"100%",sm:200},flex:{xs:"1",sm:"0 0 200px"}},children:[a.jsx(s,{variant:"caption",sx:{mb:.5,color:"#374151",display:"block"},children:"Scan Type"}),a.jsx(n,{fullWidth:!0,size:"small",children:a.jsxs(r,{value:i.ruleType||"",onChange:e=>{const i=e.target.value,a={ruleType:i};i===P.OB_HIGH_RISK?(a.ruleName="OB High-Risk Priority Booking",a.priority=L.HIGH,a.requiredTimeframe=U.WITHIN_24_HOURS):i===P.NT_SCAN&&(a.ruleName="NT Scan Window Restrictions",a.minGestationalDays=77,a.maxGestationalDays=98,a.earlyGestationalDaysStart=49,a.earlyGestationalDaysEnd=56,a.earlyMaxAdvanceBookingDays=30,a.urgentGestationalDaysStart=91,a.urgentGestationalDaysEnd=98,a.urgentRequiredTimeframe=U.WITHIN_48_HOURS),p(c,a)},displayEmpty:!0,sx:{borderRadius:"8px",backgroundColor:"#ffffff"},children:[a.jsxs(o,{value:P.OB_HIGH_RISK,disabled:x(P.OB_HIGH_RISK,c),sx:{opacity:x(P.OB_HIGH_RISK,c)?.5:1,"&.Mui-disabled":{opacity:.5,color:"text.disabled"}},children:[F[P.OB_HIGH_RISK],x(P.OB_HIGH_RISK,c)&&" (Already used)"]}),a.jsxs(o,{value:P.NT_SCAN,disabled:x(P.NT_SCAN,c),sx:{opacity:x(P.NT_SCAN,c)?.5:1,"&.Mui-disabled":{opacity:.5,color:"text.disabled"}},children:[F[P.NT_SCAN],x(P.NT_SCAN,c)&&" (Already used)"]})]})})]}),a.jsxs(t,{sx:{flex:1,minWidth:{xs:"100%",sm:200}},children:[a.jsx(s,{variant:"caption",sx:{mb:.5,color:"#374151",display:"block"},children:"Rule Name"}),a.jsx(l,{size:"small",fullWidth:!0,value:i.ruleName||"",onChange:e=>p(c,{ruleName:e.target.value}),placeholder:"Descriptive name for this rule",sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff"}}})]})]}),a.jsxs(t,{sx:{mb:2},children:[a.jsx(s,{variant:"caption",sx:{mb:.5,color:"#374151",display:"block"},children:"Description"}),a.jsx(l,{size:"small",multiline:!0,rows:2,value:i.description||"",onChange:e=>p(c,{description:e.target.value}),placeholder:"Detailed description of this booking rule and its purpose",fullWidth:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff"}}})]}),i.ruleType===P.OB_HIGH_RISK&&a.jsxs(t,{sx:{mb:2,p:1.5,borderRadius:1,background:"#fef2f2",border:"1px solid #fca5a5"},children:[a.jsx(s,{variant:"caption",sx:{display:"block",mb:1.5,fontWeight:500,color:"#991b1b"},children:"High-Risk Scan Priority Settings"}),a.jsxs(t,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[a.jsxs(l,{label:"Priority Level",select:!0,size:"small",value:i.priority??L.HIGH,onChange:e=>p(c,{priority:e.target.value}),sx:{minWidth:{xs:"100%",sm:150},"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff"}},children:[a.jsx(o,{value:L.HIGH,children:$[L.HIGH]}),a.jsx(o,{value:L.URGENT,children:$[L.URGENT]}),a.jsx(o,{value:L.CRITICAL,children:$[L.CRITICAL]})]}),a.jsxs(l,{label:"Required Timeframe",select:!0,size:"small",value:i.requiredTimeframe??U.WITHIN_24_HOURS,onChange:e=>p(c,{requiredTimeframe:e.target.value}),sx:{minWidth:{xs:"100%",sm:180},"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff"}},children:[a.jsx(o,{value:U.WITHIN_24_HOURS,children:V[U.WITHIN_24_HOURS]}),a.jsx(o,{value:U.WITHIN_48_HOURS,children:V[U.WITHIN_48_HOURS]})]})]}),a.jsx(s,{variant:"caption",sx:{display:"block",mt:1,color:"#b91c1c",fontStyle:"italic"},children:"This scan requires immediate priority booking. The system will prioritize these appointments over regular bookings."})]}),i.ruleType===P.NT_SCAN&&a.jsxs(t,{sx:{mb:2},children:[a.jsxs(t,{sx:{mb:2,p:1.5,borderRadius:1,background:"#f0fdf4",border:"1px solid #86efac"},children:[a.jsx(s,{variant:"caption",sx:{display:"block",mb:1.5,fontWeight:500,color:"#166534"},children:"Valid NT Scan Window"}),a.jsxs(t,{sx:{display:"flex",gap:2,alignItems:"center",flexDirection:{xs:"column",sm:"row"}},children:[a.jsx(l,{label:"Min Days",size:"small",type:"number",value:i.minGestationalDays||77,onChange:e=>p(c,{minGestationalDays:parseInt(e.target.value)||77}),sx:{width:{xs:"100%",sm:120},"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff"}}}),a.jsx(s,{variant:"body2",sx:{color:"#6b7280",display:{xs:"none",sm:"block"}},children:"to"}),a.jsx(l,{label:"Max Days",size:"small",type:"number",value:i.maxGestationalDays||98,onChange:e=>p(c,{maxGestationalDays:parseInt(e.target.value)||98}),sx:{width:{xs:"100%",sm:120},"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff"}}}),a.jsx(s,{variant:"caption",sx:{color:"#15803d",fontStyle:"italic"},children:"NT scans are only valid between these gestational days"})]})]}),a.jsxs(t,{sx:{mb:2,p:1.5,borderRadius:1,background:"#fefce8",border:"1px solid #fde047"},children:[a.jsx(s,{variant:"caption",sx:{display:"block",mb:1.5,fontWeight:500,color:"#92400e"},children:"Advance Booking (Early Patients)"}),a.jsxs(t,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(3, 1fr)"},gap:2,mb:1},children:[a.jsx(l,{label:"From Day",size:"small",type:"number",value:i.earlyGestationalDaysStart||49,onChange:e=>p(c,{earlyGestationalDaysStart:parseInt(e.target.value)||49}),sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff"}}}),a.jsx(l,{label:"To Day",size:"small",type:"number",value:i.earlyGestationalDaysEnd||56,onChange:e=>p(c,{earlyGestationalDaysEnd:parseInt(e.target.value)||56}),sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff"}}}),a.jsx(l,{label:"Days Ahead",size:"small",type:"number",value:i.earlyMaxAdvanceBookingDays||30,onChange:e=>p(c,{earlyMaxAdvanceBookingDays:parseInt(e.target.value)||30}),sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff"}}})]}),a.jsx(s,{variant:"caption",sx:{color:"#a16207",fontStyle:"italic"},children:"Patients between these gestational days can book up to the specified days in advance"})]}),a.jsxs(t,{sx:{mb:2,p:1.5,borderRadius:1,background:"#fef2f2",border:"1px solid #fca5a5"},children:[a.jsx(s,{variant:"caption",sx:{display:"block",mb:1.5,fontWeight:500,color:"#991b1b"},children:"Urgent Booking (Late Patients)"}),a.jsxs(t,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(3, 1fr)"},gap:2,mb:1},children:[a.jsx(l,{label:"From Day",size:"small",type:"number",value:i.urgentGestationalDaysStart||91,onChange:e=>p(c,{urgentGestationalDaysStart:parseInt(e.target.value)||91}),sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff"}}}),a.jsx(l,{label:"To Day",size:"small",type:"number",value:i.urgentGestationalDaysEnd||98,onChange:e=>p(c,{urgentGestationalDaysEnd:parseInt(e.target.value)||98}),sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff"}}}),a.jsxs(l,{label:"Urgent Timeframe",select:!0,size:"small",value:i.urgentRequiredTimeframe??U.WITHIN_48_HOURS,onChange:e=>p(c,{urgentRequiredTimeframe:e.target.value}),sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff"}},children:[a.jsx(o,{value:U.WITHIN_24_HOURS,children:V[U.WITHIN_24_HOURS]}),a.jsx(o,{value:U.WITHIN_48_HOURS,children:V[U.WITHIN_48_HOURS]})]})]}),a.jsx(s,{variant:"caption",sx:{color:"#b91c1c",fontStyle:"italic"},children:"Patients between these gestational days must book within the urgent timeframe to ensure they don't exceed the valid window"})]}),a.jsxs(t,{sx:{mt:2,p:1.5,borderRadius:1,background:"#f0f9ff",border:"1px solid #bae6fd"},children:[a.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[a.jsx(d,{size:14,color:"#0c4a6e"}),a.jsx(s,{variant:"caption",sx:{fontWeight:500,color:"#0c4a6e"},children:"Automatic Due Date Collection"})]}),a.jsx(s,{variant:"caption",sx:{color:"#0369a1",fontStyle:"italic",display:"block"},children:"Enabling this NT scan rule will automatically prompt patients to provide their pregnancy due date during the booking process. No separate prequalifying question with date input needs to be created - the system will calculate gestational age and apply the appropriate booking restrictions automatically."})]})]}),a.jsx(t,{sx:{display:"flex",gap:3,flexWrap:"wrap",mt:2},children:a.jsx(W,{checked:!1!==i.isEnabled,onChange:e=>p(c,{isEnabled:e.target.checked}),label:"Rule Enabled",boxSize:18})})]},c)),a.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:1,mb:2},children:[a.jsx(_,{label:"Add Booking Rule",onClick:()=>{const i=(e||[]).map(e=>e.ruleType).filter(Boolean),a=[P.OB_HIGH_RISK,P.NT_SCAN].filter(e=>!i.includes(e)),t=a.length>0?a[0]:P.OB_HIGH_RISK,s={ruleType:t,ruleName:"",description:"",priority:L.HIGH,requiredTimeframe:U.WITHIN_24_HOURS,isEnabled:!0};t===P.OB_HIGH_RISK?(s.ruleName="OB High-Risk Priority Booking",s.priority=L.HIGH,s.requiredTimeframe=U.WITHIN_24_HOURS):t===P.NT_SCAN&&(s.ruleName="NT Scan Window Restrictions",s.minGestationalDays=77,s.maxGestationalDays=98,s.earlyGestationalDaysStart=49,s.earlyGestationalDaysEnd=56,s.earlyMaxAdvanceBookingDays=30,s.urgentGestationalDaysStart=91,s.urgentGestationalDaysEnd=98,s.urgentRequiredTimeframe=U.WITHIN_48_HOURS),u("bookingRules",[...e||[],s])},disabled:m()}),m()&&a.jsx(s,{variant:"caption",sx:{color:"#6b7280",fontStyle:"italic"},children:"All available rule types have been added. You can only have one rule per type."})]}),a.jsx(t,{sx:{mt:2,p:2,backgroundColor:"#f8fafc",borderRadius:1},children:a.jsxs(s,{variant:"caption",sx:{color:"#4b5563",fontStyle:"italic"},children:[a.jsx("strong",{children:"Rule Examples:"}),a.jsx("br",{}),"• ",a.jsx("strong",{children:"OB High-Risk Scan:"})," High priority with 24-hour or 48-hour timeframe requirement",a.jsx("br",{}),"• ",a.jsx("strong",{children:"NT Scan:"}),a.jsx("br",{}),"  - Valid window: 77-98 days gestational age (11-14 weeks)",a.jsx("br",{}),"  - Early booking: Patients at 49-56 days (7-8 weeks) can book 30 days ahead",a.jsx("br",{}),"  - Urgent booking: Patients at 91-98 days (13-14 weeks) have strict timeframe requirements",a.jsx("br",{}),"  - Rules enforce proper timing to stay within valid NT scan window"]})})]})};he.propTypes={bookingRules:c.arrayOf(c.shape({scanTypeBookingRuleId:c.number,ruleType:c.oneOf([P.OB_HIGH_RISK,P.NT_SCAN]),ruleName:c.string,description:c.string,priority:c.oneOf([L.NORMAL,L.HIGH,L.URGENT,L.CRITICAL]),requiredTimeframe:c.oneOf([U.ANY_TIME,U.WITHIN_24_HOURS,U.WITHIN_48_HOURS]),minGestationalDays:c.number,maxGestationalDays:c.number,maxAdvanceBookingDays:c.number,minAdvanceBookingDays:c.number,earlyGestationalDaysStart:c.number,earlyGestationalDaysEnd:c.number,earlyMaxAdvanceBookingDays:c.number,urgentGestationalDaysStart:c.number,urgentGestationalDaysEnd:c.number,urgentRequiredTimeframe:c.oneOf([U.ANY_TIME,U.WITHIN_24_HOURS,U.WITHIN_48_HOURS]),isEnabled:c.bool})),errors:c.object,submitCount:c.number,setFieldValue:c.func.isRequired};const ge=({preQualifyingQuestions:e=[],errors:i={},submitCount:d=0,setFieldValue:c})=>a.jsxs(t,{sx:{mt:1.5},children:[a.jsx(s,{variant:"body1",sx:{mb:.5,color:"#374151",fontWeight:500},children:"Pre-qualifying Questions (optional)"}),a.jsx(s,{variant:"caption",sx:{display:"block",color:"#6b7280",mb:1},children:"These questions will be asked to patients while booking this scan. You can set the answer type for each question."}),(e||[]).map((m,f)=>{var y,h,g,b,v,j,C,I,T,S,k,w,R,q,D,N;const A=d>0&&(null==(h=null==(y=i.preQualifyingQuestions)?void 0:y[f])?void 0:h.answerType),O=i=>{const a=[...e||[]];a[f]={...a[f],...i},"radio"!==i.answerType&&"multiselect"!==i.answerType||Array.isArray(a[f].options)||(a[f].options=[{text:"",qualifies:!1}]),"yesno"===i.answerType&&void 0===a[f].yesNoTrue&&(a[f].yesNoTrue="qualify"),"dateselect"!==i.answerType||a[f].dateCriteria||(a[f].dateCriteria={condition:"range",from:"",to:"",strictQualification:!1}),i.answerType&&!["radio","multiselect"].includes(i.answerType)&&delete a[f].options,i.answerType&&"dateselect"!==i.answerType&&delete a[f].dateCriteria,i.answerType&&"yesno"!==i.answerType&&delete a[f].yesNoTrue,c("preQualifyingQuestions",a)};return a.jsxs(t,{sx:{mb:1,p:1,borderRadius:2,background:"#e6eefa69",border:"1px solid #eee"},children:[a.jsxs(t,{sx:{display:"flex",gap:1,alignItems:"center",flexDirection:{xs:"column",sm:"row"},mb:1},children:[a.jsx(l,{fullWidth:!0,placeholder:`Question ${f+1}`,value:m.question,onChange:e=>O({question:e.target.value}),size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff"}}}),a.jsxs(n,{sx:{minWidth:180,width:{xs:"100%",sm:180}},size:"small",error:A,children:[a.jsxs(r,{value:m.answerType,onChange:e=>O({answerType:e.target.value}),displayEmpty:!0,sx:{borderRadius:"8px",backgroundColor:"#ffffff"},children:[a.jsx(o,{value:"",disabled:!0,children:a.jsx("span",{style:{color:"#cbcbcb"},children:"Select Answer Type"})}),a.jsx(o,{value:"yesno",children:"Yes/No"}),a.jsx(o,{value:"text",children:"Text"}),a.jsx(o,{value:"radio",children:"Single choice (Radio)"}),a.jsx(o,{value:"multiselect",children:"Multi select"}),a.jsx(o,{value:"dateselect",children:"Date Select"})]}),A&&a.jsx(s,{variant:"caption",color:"error",sx:{mt:.25},children:i.preQualifyingQuestions[f].answerType})]}),a.jsx(t,{sx:{alignSelf:{xs:"flex-end",sm:"center"}},children:a.jsx(M,{onDelete:()=>{const i=[...e||[]];i.splice(f,1),0===i.length&&i.push({question:"",answerType:""}),c("preQualifyingQuestions",i)},fontSize:16})})]}),["radio","multiselect"].includes(m.answerType)&&a.jsxs(t,{sx:{pl:{xs:0,sm:1}},children:[(m.options||[]).map((i,n)=>a.jsx(t,{sx:{mb:1},children:a.jsxs(t,{sx:{display:"flex",gap:1,alignItems:"flex-start",flexDirection:{xs:"column",sm:"row"}},children:[a.jsx(l,{size:"small",placeholder:`Option ${n+1}`,value:i.text,onChange:i=>{const a=[...e||[]],t={...a[f]},s=[...t.options||[]];s[n]={...s[n],text:i.target.value},t.options=s,a[f]=t,c("preQualifyingQuestions",a)},sx:{flex:1,minWidth:0,maxWidth:{xs:"100%",sm:420},"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff"}}}),a.jsxs(t,{sx:{display:"flex",gap:1,alignItems:"center",mt:{xs:1,sm:0},ml:{sm:1}},children:[a.jsx(W,{checked:Boolean(i.qualifies),onChange:i=>{const a=[...e||[]],t={...a[f]},s=[...t.options||[]];s[n]={...s[n],qualifies:i.target.checked},t.options=s,a[f]=t,c("preQualifyingQuestions",a)},label:a.jsx(s,{variant:"caption",children:"If selected then qualify?"}),boxSize:18,marginTop:0}),a.jsx(M,{onDelete:()=>{const i=[...e||[]],a={...i[f]},t=[...a.options||[]];t.splice(n,1),a.options=t.length?t:[{text:"",qualifies:!1}],i[f]=a,c("preQualifyingQuestions",i)},fontSize:14})]})]})},n)),a.jsxs(t,{children:[a.jsx(_,{label:"Add option",disabled:(m.options||[]).length>=5,onClick:()=>{const i=[...e||[]],a={...i[f]},t=[...a.options||[]];t.length<5&&(t.push({text:"",qualifies:!1}),a.options=t,i[f]=a,c("preQualifyingQuestions",i))}}),(m.options||[]).length>=5&&a.jsxs(s,{variant:"caption",sx:{display:"block",color:"#ef4444",mt:.5},children:["Maximum ",5," options allowed"]})]})]}),"yesno"===m.answerType&&a.jsxs(t,{sx:{mt:1,pl:{xs:0,sm:1}},children:[a.jsx(s,{variant:"caption",sx:{display:"block",mb:1,color:"#374151"},children:'If patient answers "Yes" then:'}),a.jsx(n,{component:"fieldset",size:"small",children:a.jsxs(u,{row:!0,value:m.yesNoTrue||"qualify",onChange:i=>{const a=[...e||[]],t={...a[f]};t.yesNoTrue=i.target.value,a[f]=t,c("preQualifyingQuestions",a)},children:[a.jsx(p,{value:"qualify",control:a.jsx(x,{size:"small"}),label:a.jsx(s,{variant:"caption",children:"Qualify"})}),a.jsx(p,{value:"disqualify",control:a.jsx(x,{size:"small"}),label:a.jsx(s,{variant:"caption",children:"Disqualify"})})]})})]}),"dateselect"===m.answerType&&a.jsxs(t,{sx:{mt:1,pl:{xs:0,sm:1},display:"flex",flexDirection:"column",gap:1},children:[a.jsxs(t,{sx:{display:"flex",gap:1,flexDirection:{xs:"column",sm:"row"}},children:[a.jsx(n,{size:"small",sx:{minWidth:140},children:a.jsxs(r,{value:(null==(g=m.dateCriteria)?void 0:g.condition)||"range",onChange:i=>{const a=[...e||[]],t={...a[f]},s=i.target.value;let n={...t.dateCriteria||{}};n.condition=s,n="range"===s?{condition:"range",from:"",to:"",strictQualification:!1}:{condition:s,value:"",strictQualification:!1},t.dateCriteria=n,a[f]=t,c("preQualifyingQuestions",a)},sx:{borderRadius:"8px",backgroundColor:"#ffffff"},children:[a.jsx(o,{value:"range",children:"Range"}),a.jsx(o,{value:"less than",children:"Less Than"}),a.jsx(o,{value:"more than",children:"More Than"})]})}),"range"===(null==(b=m.dateCriteria)?void 0:b.condition)?a.jsxs(t,{sx:{display:"flex",gap:1,flex:1,alignItems:"center",flexDirection:{xs:"column",sm:"row"}},children:[a.jsx(l,{size:"small",placeholder:"Enter number of days e.g. 126",value:(null==(v=m.dateCriteria)?void 0:v.from)||"",onChange:i=>{const a=[...e||[]],t={...a[f]};t.dateCriteria={...t.dateCriteria,from:i.target.value.replace(/[^0-9]/g,"")},a[f]=t,c("preQualifyingQuestions",a)},sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff",width:"100%"},flex:1}}),a.jsx(s,{variant:"caption",sx:{color:"#6b7280",mx:{xs:0,sm:.5},alignSelf:{xs:"flex-start",sm:"center"}},children:"to"}),a.jsx(l,{size:"small",placeholder:"Enter number of days e.g. 140",value:(null==(j=m.dateCriteria)?void 0:j.to)||"",onChange:i=>{const a=[...e||[]],t={...a[f]};t.dateCriteria={...t.dateCriteria,to:i.target.value.replace(/[^0-9]/g,"")},a[f]=t,c("preQualifyingQuestions",a)},sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff",width:"100%"},flex:1}})]}):a.jsx(l,{size:"small",placeholder:"Enter number of days e.g. 126",value:(null==(C=m.dateCriteria)?void 0:C.value)||"",onChange:i=>{const a=[...e||[]],t={...a[f]};t.dateCriteria={...t.dateCriteria,value:i.target.value.replace(/[^0-9]/g,"")},a[f]=t,c("preQualifyingQuestions",a)},sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff",width:320},flex:1}})]}),a.jsx(t,{sx:{mt:1.5},children:a.jsx(W,{checked:Boolean(null==(I=m.dateCriteria)?void 0:I.strictQualification),onChange:i=>{const a=[...e||[]],t={...a[f]};t.dateCriteria={...t.dateCriteria,strictQualification:i.target.checked},a[f]=t,c("preQualifyingQuestions",a)},label:a.jsxs(t,{children:[a.jsx(s,{variant:"caption",sx:{fontWeight:500},children:"Strict qualification"}),a.jsxs(s,{variant:"caption",sx:{display:"block",color:"#6b7280",fontStyle:"italic"},children:["If checked: Patient will be qualified/disqualified based on gestational age.",a.jsx("br",{}),"If unchecked: Show eligible appointment slots or contact clinic message based on timing."]})]}),boxSize:18,marginTop:0})}),"range"===(null==(T=m.dateCriteria)?void 0:T.condition)&&(null==(S=m.dateCriteria)?void 0:S.from)&&(null==(k=m.dateCriteria)?void 0:k.to)&&a.jsxs(t,{sx:{mt:1.5,p:1.5,backgroundColor:"#f8fafc",borderRadius:1,border:"1px solid #e2e8f0"},children:[a.jsxs(s,{variant:"caption",sx:{fontWeight:500,color:"#374151",display:"block",mb:1},children:["Example for ",m.dateCriteria.from,"-",m.dateCriteria.to," day scan:"]}),(null==(w=m.dateCriteria)?void 0:w.strictQualification)?a.jsxs(t,{sx:{pl:1},children:[a.jsxs(s,{variant:"caption",sx:{display:"block",color:"#059669",mb:.5},children:[a.jsx(ue,{sx:{color:"#059669",fontSize:16,verticalAlign:"middle",mr:.5}}),"At ",m.dateCriteria.from,"-",m.dateCriteria.to," days: Patient qualified"]}),a.jsxs(s,{variant:"caption",sx:{display:"block",color:"#dc2626",mb:.5},children:[a.jsx(K,{sx:{color:"#dc2626",fontSize:16,verticalAlign:"middle",mr:.5}}),"At ",Math.max(1,parseInt(m.dateCriteria.from)-14)," days: Patient disqualified"]}),a.jsxs(s,{variant:"caption",sx:{display:"block",color:"#dc2626"},children:[a.jsx(K,{sx:{color:"#dc2626",fontSize:16,verticalAlign:"middle",mr:.5}}),"At ",parseInt(m.dateCriteria.to)+14," days: Patient disqualified"]})]}):a.jsxs(t,{sx:{pl:1},children:[a.jsxs(s,{variant:"caption",sx:{display:"block",color:"#d97706",mb:.5},children:[a.jsx(pe,{sx:{color:"#d97706",fontSize:16,verticalAlign:"middle",mr:.5}}),"At ",Math.max(1,parseInt(m.dateCriteria.from)-14)," days (before range): Show only eligible slots within"," ",m.dateCriteria.from,"-",m.dateCriteria.to," day timeframe"]}),a.jsxs(s,{variant:"caption",sx:{display:"block",color:"#059669",mb:.5},children:[a.jsx(ue,{sx:{color:"#059669",fontSize:16,verticalAlign:"middle",mr:.5}}),"At ",Math.floor((parseInt(m.dateCriteria.from)+parseInt(m.dateCriteria.to))/2)," days (within range): Show eligible slots nearest to booking date"]}),a.jsxs(s,{variant:"caption",sx:{display:"block",color:"#dc2626"},children:[a.jsx(xe,{sx:{color:"#dc2626",fontSize:16,verticalAlign:"middle",mr:.5}}),"At ",parseInt(m.dateCriteria.to)+14," days (after range): Show message to contact clinic"]})]})]}),"range"!==(null==(R=m.dateCriteria)?void 0:R.condition)&&(null==(q=m.dateCriteria)?void 0:q.value)&&a.jsxs(t,{sx:{mt:1.5,p:1.5,backgroundColor:"#f8fafc",borderRadius:1,border:"1px solid #e2e8f0"},children:[a.jsxs(s,{variant:"caption",sx:{fontWeight:500,color:"#374151",display:"block",mb:1},children:['Example for "',m.dateCriteria.condition," ",m.dateCriteria.value,' days" scan:']}),(null==(D=m.dateCriteria)?void 0:D.strictQualification)?a.jsx(t,{sx:{pl:1},children:"less than"===m.dateCriteria.condition?a.jsxs(a.Fragment,{children:[a.jsxs(s,{variant:"caption",sx:{display:"block",color:"#059669",mb:.5},children:[a.jsx(ue,{sx:{color:"#059669",fontSize:16,verticalAlign:"middle",mr:.5}}),"At ",Math.max(1,parseInt(m.dateCriteria.value)-14)," days: Patient qualified"]}),a.jsxs(s,{variant:"caption",sx:{display:"block",color:"#dc2626"},children:[a.jsx(K,{sx:{color:"#dc2626",fontSize:16,verticalAlign:"middle",mr:.5}}),"At ",parseInt(m.dateCriteria.value)+7," days: Patient disqualified"]})]}):a.jsxs(a.Fragment,{children:[a.jsxs(s,{variant:"caption",sx:{display:"block",color:"#dc2626",mb:.5},children:[a.jsx(K,{sx:{color:"#dc2626",fontSize:16,verticalAlign:"middle",mr:.5}}),"At ",Math.max(1,parseInt(m.dateCriteria.value)-7)," days: Patient disqualified"]}),a.jsxs(s,{variant:"caption",sx:{display:"block",color:"#059669"},children:[a.jsx(ue,{sx:{color:"#059669",fontSize:16,verticalAlign:"middle",mr:.5}}),"At ",parseInt(m.dateCriteria.value)+14," days: Patient qualified"]})]})}):a.jsx(t,{sx:{pl:1},children:a.jsxs(s,{variant:"caption",sx:{display:"block",color:"#6b7280",fontStyle:"italic"},children:['Loose qualification behavior applies based on the "',m.dateCriteria.condition,'" condition']})})]}),a.jsxs(s,{variant:"caption",sx:{color:"#374151",fontStyle:"italic"},children:["Note: Enter gestational age in days. The specified range/number becomes the qualifying criteria.",(null==(N=m.dateCriteria)?void 0:N.strictQualification)?" If the patient's value is outside the allowed days, they will be disqualified.":" Patients will see appropriate appointment slots or contact clinic message based on their gestational age."]})]})]},f)}),a.jsx(t,{sx:{mb:2},children:a.jsx(_,{label:"Add question",onClick:()=>{const i=[...e||[]];i.push({question:"",answerType:""}),c("preQualifyingQuestions",i)}})})]});ge.propTypes={preQualifyingQuestions:c.arrayOf(c.shape({question:c.string,answerType:c.oneOf(["","yesno","text","radio","multiselect","dateselect"]),yesNoTrue:c.oneOf(["qualify","disqualify"]),options:c.arrayOf(c.shape({text:c.string,qualifies:c.bool})),dateCriteria:c.shape({condition:c.oneOf(["range","less than","more than"]),from:c.oneOfType([c.string,c.number]),to:c.oneOfType([c.string,c.number]),value:c.oneOfType([c.string,c.number]),strictQualification:c.bool})})),errors:c.object,submitCount:c.number,setFieldValue:c.func.isRequired};const be=({value:e,onChange:i,error:t,helperText:s,...n})=>a.jsx(l,{...n,value:e||"",onChange:e=>{const a=e.target.value;if(""===a)return void i("");const t=parseInt(a,10);!isNaN(t)&&t>=1&&t<=999&&i(t)},onBlur:()=>{(!e||""===e||e<1)&&i(1)},error:t,helperText:s,type:"text",inputMode:"numeric",InputProps:{startAdornment:a.jsx(Y,{position:"start",children:a.jsx(m,{size:"small",onClick:()=>{const a=Math.max((e||0)-1,1);i(a)},disabled:e<=1,sx:{color:e<=1?"#d1d5db":"#6b7280","&:hover":{backgroundColor:e<=1?"transparent":"#f3f4f6"}},children:a.jsx(ce,{style:{fontSize:"14px"}})})}),endAdornment:a.jsx(Y,{position:"end",children:a.jsx(m,{size:"small",onClick:()=>{const a=Math.min((e||0)+1,999);i(a)},disabled:e>=999,sx:{color:e>=999?"#d1d5db":"#6b7280","&:hover":{backgroundColor:e>=999?"transparent":"#f3f4f6"}},children:a.jsx(Q,{style:{fontSize:"14px"}})})}),sx:{"& input":{textAlign:"center",fontWeight:500}}},sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff"},...n.sx}});be.propTypes={value:c.oneOfType([c.number,c.string]),onChange:c.func.isRequired,error:c.bool,helperText:c.string,sx:c.object},be.defaultProps={value:30,error:!1,helperText:"",sx:{}};const ve=({open:i,onClose:s,onSubmit:d,serviceId:c,initialData:u=null,mode:x="add"})=>{const m="edit"===x,D=f(),N=!((null==D?void 0:D.role)===q.CLINIC_STAFF_MEMBER)||"add"===x,A=e.useMemo(()=>y().shape({name:g().required("Scan name is required."),durationMinutes:v().min(1,"Duration must be at least 1 minute.").required("Duration is required."),description:g().required("Description is required."),bookableFrom:g().required("Start time is required."),bookableTo:g().required("End time is required.").when("bookableFrom",(e,i)=>i.test("is-after","End time must be after start time.",i=>{if(!e||!i)return!0;const a=new Date(`2000-01-01T${e}`);return new Date(`2000-01-01T${i}`)>a})),isGenderSensitive:b(),preQualifyingQuestions:h().of(y().shape({question:g(),answerType:g().when("question",{is:e=>(e||"").trim().length>0,then:e=>e.oneOf(["yesno","text","radio","multiselect","dateselect"]).required("Please choose an option."),otherwise:e=>e.oneOf(["","yesno","text","radio","multiselect","dateselect"]).nullable()}),options:h().of(y().shape({text:g().when("$parentAnswerType",(e,i)=>["radio","multiselect"].includes(e)?i.required("Option text is required."):i),qualifies:b()})).when("answerType",{is:e=>["radio","multiselect"].includes(e),then:e=>e.min(1,"At least one option is required."),otherwise:e=>e.strip()}),dateCriteria:j().when("answerType",{is:"dateselect",then:()=>y({condition:g().oneOf(["range","less than","more than"]).required("Condition is required."),from:v().typeError("From value is required.").when("condition",{is:"range",then:e=>e.required("From value is required."),otherwise:e=>e.strip()}),to:v().typeError("To value is required.").when("condition",{is:"range",then:e=>e.required("To value is required.").test("gt","To value must be greater than From value.",function(e){const{from:i}=this.parent;return null==e||null==i||e>i}),otherwise:e=>e.strip()}),value:v().typeError("Value is required.").when("condition",{is:e=>["less than","more than"].includes(e),then:e=>e.required("Value is required."),otherwise:e=>e.strip()})}),otherwise:()=>j().strip()})})),specialPreparationInstructions:g().when("requiresSpecialPreparation",{is:!0,then:e=>e.required("Special preparation instructions are required if special preparation is needed."),otherwise:e=>e}),bookingRules:h().test({name:"unique-rule-types",message:"Cannot have multiple rules of the same type",test:function(e){if(!e||0===e.length)return!0;const i=e.filter(e=>e&&e.ruleType).map(e=>e.ruleType),a=new Set(i);if(i.length!==a.size){const e=i.filter((e,a)=>i.indexOf(e)!==a)[0],a={1:"OB High-Risk Scan",2:"NT Scan (Nuchal Translucency)"}[e]||`Rule type ${e}`;return this.createError({message:`Cannot have multiple rules of the same type. Duplicate rule type: ${a}`})}return!0}})}),[]),O=e.useMemo(()=>"add"===x?{name:"",durationMinutes:30,scanBillingCode:"",synonymsList:[""],preQualifyingQuestions:[{question:"",answerType:""}],bookingRules:[],genderRequirement:"Male",isGenderSensitive:!1,description:"",preparationInstructions:"",requiresSpecialPreparation:!1,specialPreparationInstructions:"",requiresDedicatedTechnician:!1,isComplex:!1,bookableFrom:"",bookableTo:"",serviceId:c}:{scanTypeId:(null==u?void 0:u.scanTypeId)||"",serviceId:(null==u?void 0:u.serviceId)||c,serviceName:(null==u?void 0:u.serviceName)||"",categoryId:(null==u?void 0:u.categoryId)||"",categoryName:(null==u?void 0:u.categoryName)||"",clinicId:(null==u?void 0:u.clinicId)||"",clinicName:(null==u?void 0:u.clinicName)||"",name:(null==u?void 0:u.name)||"",durationMinutes:(null==u?void 0:u.durationMinutes)||30,scanBillingCode:(null==u?void 0:u.scanBillingCode)||"",synonymsList:(()=>{const e=me((null==u?void 0:u.synonyms)||[]);return e.length?e:[""]})(),genderRequirement:1===(null==u?void 0:u.genderRequirement)?"Male":2===(null==u?void 0:u.genderRequirement)?"Female":"Male",isGenderSensitive:(null==u?void 0:u.isGenderSensitive)||!1,description:(null==u?void 0:u.description)||"",preparationInstructions:(null==u?void 0:u.preparationInstructions)||"",requiresSpecialPreparation:(null==u?void 0:u.requiresSpecialPreparation)||!1,specialPreparationInstructions:(null==u?void 0:u.specialPreparationInstructions)||"",requiresDedicatedTechnician:(null==u?void 0:u.requiresDedicatedTechnician)||!1,isComplex:(null==u?void 0:u.isComplex)||!1,bookableFrom:(null==u?void 0:u.bookableFrom)?String(u.bookableFrom).slice(0,5):"",bookableTo:(null==u?void 0:u.bookableTo)?String(u.bookableTo).slice(0,5):"",preQualifyingQuestions:Array.isArray(null==u?void 0:u.questions)?u.questions.map(e=>{const i=(e=>{const i=Number(e);return isNaN(i)?"yesno"===String(e||"").toLowerCase()?"yesno":"text"===String(e||"").toLowerCase()?"text":"radiobutton"===String(e||"").toLowerCase()||"radio"===String(e||"").toLowerCase()?"radio":"multiselect"===String(e||"").toLowerCase()?"multiselect":"daterange"===String(e||"").toLowerCase()||"dateselect"===String(e||"").toLowerCase()?"dateselect":"":1===i?"yesno":2===i?"text":3===i?"radio":4===i?"multiselect":5===i?"dateselect":""})(e.type??e.Type),a=Array.isArray(e.options??e.Options)?e.options??e.Options:[],t=a.map(e=>{if(!e)return{id:void 0,text:"",qualifies:!1};const i=e.optionText??e.OptionText??e.text??"",a=e.scanTypeQuestionOptionId??e.ScanTypeQuestionOptionId??e.id??void 0,t=e.outcome??e.Outcome??null;return{id:a,text:i,qualifies:null!=t?Number(t)===se:Boolean(e.qualifies)}});let s,n;if("yesno"===i&&a.length){const e=a.find(e=>"yes"===String(e.optionText??e.OptionText??e.text??"").toLowerCase())??a[0],i=e?e.outcome??e.Outcome??null:null;null!=i&&(s=Number(i)===se?"qualify":"disqualify")}if("dateselect"===i&&a.length){const e=a[0],i=e.conditionType??e.ConditionType??e.conditionTypeId??e.ConditionTypeId??null;let t="range";if(null!=i){const e=Number(i);t=1===e?"range":2===e?"less than":3===e?"more than":"range"}const s=e=>null==e?"":String(Number(e));n="range"===t?{condition:"range",from:s(e.MinDays??e.minDays??null),to:s(e.MaxDays??e.maxDays??null),strictQualification:e.StrictQualification??e.strictQualification??!1}:"less than"===t?{condition:"less than",value:s(e.MaxDays??e.maxDays??null),strictQualification:e.StrictQualification??e.strictQualification??!1}:{condition:"more than",value:s(e.MinDays??e.minDays??null),strictQualification:e.StrictQualification??e.strictQualification??!1}}return{id:e.ScanTypeQuestionId??e.scanTypeQuestionId??e.id??void 0,question:e.QuestionText??e.questionText??e.question??"",answerType:i,options:t,yesNoTrue:s,dateCriteria:n}}):[{question:"",answerType:""}],bookingRules:Array.isArray(null==u?void 0:u.bookingRules)?u.bookingRules.map(e=>({scanTypeBookingRuleId:e.scanTypeBookingRuleId,ruleType:e.ruleType,ruleName:e.ruleName||"",description:e.description||"",minGestationalDays:e.minGestationalDays,maxGestationalDays:e.maxGestationalDays,priority:e.priority??0,requiredTimeframe:e.requiredTimeframe??0,maxAdvanceBookingDays:e.maxAdvanceBookingDays,minAdvanceBookingDays:e.minAdvanceBookingDays,earlyGestationalDaysStart:e.earlyGestationalDaysStart,earlyGestationalDaysEnd:e.earlyGestationalDaysEnd,earlyMaxAdvanceBookingDays:e.earlyMaxAdvanceBookingDays,urgentGestationalDaysStart:e.urgentGestationalDaysStart,urgentGestationalDaysEnd:e.urgentGestationalDaysEnd,urgentRequiredTimeframe:e.urgentRequiredTimeframe??0,isEnabled:!1!==e.isEnabled})):[]},[u,c,x]);return a.jsx(C,{initialValues:O,validationSchema:A,onSubmit:async(e,{resetForm:i})=>{var a,t,n,r;const o=(e.preQualifyingQuestions||[]).map(e=>({...e,question:(e.question||"").trim()})).filter(e=>e.question.length>0&&re[e.answerType]).map(e=>{const i=re[e.answerType];let a=[];if("yesno"===e.answerType){a=[{optionText:"Yes",outcome:"qualify"===e.yesNoTrue?se:ne,isDefault:!1,conditionType:null,minDays:null,maxDays:null},{optionText:"No",outcome:"qualify"===e.yesNoTrue?ne:se,isDefault:!1,conditionType:null,minDays:null,maxDays:null}]}if(["radio","multiselect"].includes(e.answerType)&&(a=(e.options||[]).map(e=>({...e.id?{scanTypeQuestionOptionId:e.id}:{},optionText:(e.text||"").trim(),outcome:e.text?e.qualifies?se:ne:te,isDefault:!1,conditionType:null,minDays:null,maxDays:null})).filter(e=>e.optionText.length>0)),"dateselect"===e.answerType&&e.dateCriteria){const i=ae[e.dateCriteria.condition];let t=null,s=null;const n=e=>""===e||null==e?null:Number(e);"range"===e.dateCriteria.condition?(t=n(e.dateCriteria.from),s=n(e.dateCriteria.to)):"less than"===e.dateCriteria.condition?s=n(e.dateCriteria.value):"more than"===e.dateCriteria.condition&&(t=n(e.dateCriteria.value)),a=[{optionText:"",outcome:se,isDefault:!1,conditionType:i,minDays:t,maxDays:s,strictQualification:e.dateCriteria.strictQualification||!1}]}return{...e.id?{scanTypeQuestionId:e.id}:{},questionText:e.question,type:i,...a.length>0?{options:a}:{}}}),l=(e.bookingRules||[]).map(e=>{var i,a;return{scanTypeBookingRuleId:e.scanTypeBookingRuleId||null,ruleType:e.ruleType,ruleName:(null==(i=e.ruleName)?void 0:i.trim())||"",description:(null==(a=e.description)?void 0:a.trim())||"",minGestationalDays:e.minGestationalDays||null,maxGestationalDays:e.maxGestationalDays||null,priority:e.priority??0,requiredTimeframe:e.requiredTimeframe??0,maxAdvanceBookingDays:e.maxAdvanceBookingDays||null,minAdvanceBookingDays:e.minAdvanceBookingDays||null,earlyGestationalDaysStart:e.earlyGestationalDaysStart||null,earlyGestationalDaysEnd:e.earlyGestationalDaysEnd||null,earlyMaxAdvanceBookingDays:e.earlyMaxAdvanceBookingDays||null,urgentGestationalDaysStart:e.urgentGestationalDaysStart||null,urgentGestationalDaysEnd:e.urgentGestationalDaysEnd||null,urgentRequiredTimeframe:e.urgentRequiredTimeframe??0,isEnabled:!1!==e.isEnabled}}),{synonymsList:u,...p}=e,x={...p,durationMinutes:parseInt(e.durationMinutes),serviceId:c,scanBillingCode:(null==(a=e.scanBillingCode)?void 0:a.trim())||null,synonyms:fe(u||[]),genderRequirement:e.isGenderSensitive?"Male"===e.genderRequirement?1:"Female"===e.genderRequirement?2:0:0,isGenderSensitive:e.isGenderSensitive,questions:o,bookingRules:l,bookableFrom:e.bookableFrom?5===e.bookableFrom.length?`${e.bookableFrom}:00`:e.bookableFrom:null,bookableTo:e.bookableTo?5===e.bookableTo.length?`${e.bookableTo}:00`:e.bookableTo:null};try{let e;if(m)return d(x),i(),void s();e=await w.post("https://healthco.clinic/api/api/scantypes",x),R.success("Scan type added successfully!"),i(),d(e.data),s()}catch(f){if(400===(null==(t=f.response)?void 0:t.status)||500===(null==(n=f.response)?void 0:n.status)){let e=`Failed to ${m?"update":"add"} scan type`;(null==(r=f.response)?void 0:r.data)?"string"==typeof f.response.data?e=f.response.data:f.response.data.detail?e=f.response.data.detail:f.response.data.message?e=f.response.data.message:f.response.data.title&&(e=f.response.data.title):e=f.message||`Failed to ${m?"update":"add"} scan type`,R.error(e)}else R.error(`Failed to ${m?"update":"add"} scan type. Please try again.`)}},enableReinitialize:!0,validateOnMount:!1,validateOnBlur:!0,validateOnChange:!0,children:({values:e,errors:d,touched:c,handleChange:u,handleBlur:x,handleSubmit:f,isValid:y,dirty:h,isSubmitting:g,setFieldValue:b,resetForm:v,submitCount:j})=>{const C=e=>c[e]||j>0?d[e]:void 0;return a.jsxs(I,{open:i,onClose:()=>{v(),s()},title:m?"Edit Scan Type":"Create New Scan Type",onSubmit:f,submitLabel:m?"Update":"Create Scan Type",disableSubmit:g||j>0&&!y,showActions:N,customActions:N?void 0:a.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",gap:1.5,mt:1},children:a.jsx(k,{onClick:()=>{v(),s()},sx:{textTransform:"none",color:"#6b7280",borderRadius:"8px",px:3,py:1.5,"&:hover":{backgroundColor:"rgba(59, 130, 246, 0.1)",color:"#2563eb"}},children:"Close"})}),children:[a.jsxs(t,{children:[a.jsxs(t,{sx:{display:"flex",gap:1,flexDirection:{xs:"column",sm:"row"}},children:[a.jsx(T,{label:"Scan Name",required:!0,placeholder:"e.g., Chest X-ray, Abdominal Ultrasound",value:e.name,onChange:u,onBlur:x,name:"name",error:C("name"),sx:{flex:1,width:"100%"}}),a.jsx(t,{sx:{display:"flex",alignItems:"center"},children:a.jsx(T,{label:"Duration (minutes)",required:!0,error:C("durationMinutes"),children:a.jsx(be,{value:e.durationMinutes,onChange:e=>b("durationMinutes",e),error:(w="durationMinutes",(c[w]||j>0)&&Boolean(d[w])),sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff"}},size:"medium"})})})]}),a.jsx(t,{sx:{display:"flex",gap:1,flexDirection:{xs:"column",sm:"row"},mt:1},children:a.jsx(T,{label:"Scan Billing Code",placeholder:"Optional billing code",value:e.scanBillingCode,onChange:u,onBlur:x,name:"scanBillingCode",sx:{flex:1,width:"100%"}})}),a.jsx(T,{label:"Description",required:!0,multiline:!0,rows:3,placeholder:"Detailed description of this scan type",value:e.description,onChange:u,onBlur:x,name:"description",error:C("description")}),a.jsx(T,{label:"Synonyms / Aliases",sx:{mt:1},children:a.jsxs(S,{spacing:1,sx:{width:"100%"},children:[(e.synonymsList||[]).map((i,s)=>a.jsxs(t,{sx:{display:"flex",gap:1,alignItems:"center"},children:[a.jsx(l,{fullWidth:!0,placeholder:`Alias ${s+1}`,value:i,onChange:i=>{const a=[...e.synonymsList||[]];a[s]=i.target.value,b("synonymsList",a)},name:`synonymsList[${s}]`,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#ffffff",height:40}}}),a.jsx(M,{onDelete:()=>{const i=[...e.synonymsList||[]];i.splice(s,1),0===i.length&&i.push(""),b("synonymsList",i)},fontSize:16})]},s)),a.jsx(t,{children:a.jsx(_,{label:"Add alias",onClick:()=>b("synonymsList",[...e.synonymsList||[],""]),variant:"inline"})})]})})]}),a.jsx(t,{children:a.jsxs(t,{sx:{display:"flex",gap:1,flexDirection:{xs:"column",sm:"row"}},children:[a.jsx(T,{label:"Available From",required:!0,type:"time",value:e.bookableFrom,onChange:u,onBlur:x,name:"bookableFrom",error:C("bookableFrom"),sx:{flex:1,width:"100%"}}),a.jsx(T,{label:"Available To",required:!0,type:"time",value:e.bookableTo,onChange:u,onBlur:x,name:"bookableTo",error:C("bookableTo"),sx:{flex:1,width:"100%"}})]})}),a.jsxs(t,{children:[a.jsx(T,{label:"Preparation Instructions",multiline:!0,rows:2,placeholder:"Any Special preparation required before the scan",value:e.preparationInstructions,onChange:u,onBlur:x,name:"preparationInstructions"}),a.jsx(p,{control:a.jsx(W,{checked:e.requiresSpecialPreparation,onChange:u,name:"requiresSpecialPreparation",size:"small"}),label:"Requires special preparation"}),e.requiresSpecialPreparation&&a.jsx(T,{label:"Special Preparation Instructions",required:!0,multiline:!0,rows:2,placeholder:"Describe special requirements",value:e.specialPreparationInstructions,onChange:u,onBlur:x,name:"specialPreparationInstructions",error:C("specialPreparationInstructions"),sx:{mt:1}}),a.jsx(p,{control:a.jsx(W,{checked:e.requiresDedicatedTechnician,onChange:u,name:"requiresDedicatedTechnician",size:"small"}),label:"Requires Dedicated Technician"}),a.jsx(p,{control:a.jsx(W,{checked:e.isComplex,onChange:u,name:"isComplex"}),label:"Is Complex"}),a.jsx(p,{control:a.jsx(W,{checked:e.isGenderSensitive,onChange:u,name:"isGenderSensitive"}),label:"Is Gender Sensitive"}),e.isGenderSensitive&&a.jsx(T,{label:"Which patients is this scan applicable to?",sx:{marginTop:1},error:C("genderRequirement"),required:!0,children:a.jsx(n,{fullWidth:!0,children:a.jsxs(r,{id:"genderRequirement",name:"genderRequirement",value:e.genderRequirement,onChange:u,onBlur:x,displayEmpty:!0,sx:{borderRadius:"8px",backgroundColor:"#ffffff"},children:[a.jsx(o,{value:"Male",children:"Male"}),a.jsx(o,{value:"Female",children:"Female"})]})})}),a.jsx(ge,{preQualifyingQuestions:e.preQualifyingQuestions,errors:d,submitCount:j,setFieldValue:b}),a.jsx(he,{bookingRules:e.bookingRules,errors:d,submitCount:j,setFieldValue:b})]})]});var w}})};ve.propTypes={open:c.bool.isRequired,onClose:c.func.isRequired,onSubmit:c.func.isRequired,serviceId:c.oneOfType([c.string,c.number]).isRequired,initialData:c.object,mode:c.oneOf(["add","edit"]).isRequired};const je=({service:i,onAddScan:n,onDeleteService:r,onDeleteScanType:o,onEditService:l,onEditScanType:d,onStatusChange:c})=>{var u;const[p,x]=e.useState(!1),m="undefined"!=typeof window&&window.matchMedia("(hover: hover)").matches,f=localStorage.getItem("userRole")===q.CLINIC_STAFF_MEMBER,[y,h]=e.useState(null);return a.jsxs(H,{onMouseEnter:()=>m&&x(!0),onMouseLeave:()=>m&&x(!1),onClick:()=>l&&l(i),sx:{cursor:"pointer"},children:[a.jsxs(t,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",mb:1},children:[a.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,flex:1,minWidth:0},children:[a.jsx(t,{sx:{width:12,height:12,borderRadius:"50%",backgroundColor:"#3b82f6",flexShrink:0}}),a.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:.25,minWidth:0,flex:1},children:[a.jsx(Z,{title:i.serviceName,children:a.jsx(s,{variant:"h6",sx:{fontWeight:600,fontSize:"18px",color:"#111928",minWidth:0,lineHeight:1.2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i.serviceName})}),i.serviceCode&&a.jsxs(s,{sx:{fontSize:"12px",color:"#6b7280",lineHeight:1.3,wordBreak:"break-word",overflowWrap:"break-word"},children:["Service Code: ",i.serviceCode]})]})]}),a.jsx(t,{sx:{display:"flex",alignItems:"center",gap:.25},children:a.jsxs(t,{sx:{display:"flex",gap:.25,alignItems:"center",transition:"opacity 0.25s cubic-bezier(0.4,0,0.2,1)",opacity:m?p?1:0:1,pointerEvents:m?p?"auto":"none":"auto"},onClick:e=>e.stopPropagation(),children:[!f&&a.jsx(X,{onEdit:()=>l(i)}),!f&&a.jsx(M,{onDelete:()=>r(i.serviceId,i.serviceName)})]})})]}),a.jsx(Z,{title:i.description,children:a.jsx(s,{sx:{color:"#6b7280",fontSize:"12px",mb:1.5,lineHeight:1.3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i.description})}),a.jsx(D,{sx:{mb:1.5}}),a.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1.5},children:[a.jsx(s,{sx:{fontWeight:600,fontSize:"14px",color:"#111928",mb:.5},children:"Scan Types"}),a.jsx(k,{variant:"outlined",size:"small",startIcon:a.jsx(Q,{style:{fontSize:"12px"}}),onClick:e=>{e.stopPropagation(),n(i.serviceId)},sx:{textTransform:"none",borderRadius:"6px",color:"#6b7280",fontSize:"11px",px:1,py:.25,minWidth:"auto",minHeight:"24px",border:"1px solid #e5e7eb",backgroundColor:"#ffffff","&:hover":{backgroundColor:"#f9fafb",borderColor:"#d1d5db"}},children:"Add Scan"})]}),a.jsx(ee,{minHeight:"120px",maxHeight:"200px",children:(null==(u=i.scanTypes)?void 0:u.length)>0?a.jsx(t,{sx:{display:"flex",flexDirection:"column",gap:.5},children:i.scanTypes.sort((e,i)=>e.name.localeCompare(i.name)).map(e=>a.jsxs(t,{onMouseEnter:()=>m&&h(e.scanTypeId),onMouseLeave:()=>m&&h(i=>i===e.scanTypeId?null:i),onClick:a=>{a.stopPropagation(),d&&d(e,i.serviceId)},sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:.5,borderRadius:"8px",border:"1px solid #e5e7eb",background:"#fff",boxShadow:"0 1px 2px rgba(0,0,0,0.03)",transition:"box-shadow 0.2s",cursor:"pointer","&:hover":{boxShadow:"0 2px 4px rgba(0,0,0,0.08)",borderColor:"#3b82f6"}},children:[a.jsxs(t,{sx:{flex:1,minWidth:0,p:.5},children:[a.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mb:.25},children:[a.jsx(Z,{title:e.name,children:a.jsx(s,{sx:{fontWeight:600,fontSize:"13px",color:"#111928",minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name})}),a.jsxs(ie,{backgroundColor:"#eff6ff",color:"#2563eb",children:[e.durationMinutes,"m"]}),e.requiresDedicatedTechnician&&a.jsx(ie,{backgroundColor:"#fef3c7",color:"#92400e",children:"DT"}),e.isComplex&&a.jsx(ie,{backgroundColor:"#fce7f3",color:"#9f1239",children:"CS"}),e.isGenderSensitive&&a.jsx(ie,{backgroundColor:"#dbeafe",color:"#1e40af",children:"GS"})]}),a.jsx(Z,{title:e.description,children:a.jsx(s,{sx:{color:"#6b7280",fontSize:"11px",mb:.25,lineHeight:1.3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.description})})]}),a.jsx(t,{sx:{display:"flex",alignItems:"center",gap:.25,flexShrink:0},children:a.jsx(t,{sx:{display:"flex",gap:.15,alignItems:"center",transition:"opacity 0.25s cubic-bezier(0.4,0,0.2,1)",opacity:m?y===e.scanTypeId?1:0:1,pointerEvents:m?y===e.scanTypeId?"auto":"none":"auto",minWidth:0},onClick:e=>e.stopPropagation(),children:!f&&a.jsxs(a.Fragment,{children:[a.jsx(X,{onEdit:()=>d(e,i.serviceId),fontSize:12}),a.jsx(M,{onDelete:()=>o(e.scanTypeId,e.name),fontSize:12})]})})})]},e.scanTypeId))}):a.jsxs(t,{sx:{textAlign:"center",py:1.5,border:"1.5px dashed #d1d5db",borderRadius:"10px",backgroundColor:"#fcfcfd",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:.5,mt:.5},children:[a.jsx(t,{sx:{width:24,height:24,borderRadius:"50%",backgroundColor:"#e5e7eb",display:"flex",alignItems:"center",justifyContent:"center",mb:.5},children:a.jsx(s,{sx:{fontSize:"13px",color:"#94a3b8",fontWeight:700},children:"!"})}),a.jsx(s,{sx:{color:"#64748b",fontWeight:500,fontSize:"13px",mb:.25},children:"No scan types yet"}),a.jsx(k,{variant:"text",startIcon:a.jsx(Q,{style:{fontSize:"12px"}}),onClick:e=>{e.stopPropagation(),n(i.serviceId)},sx:{textTransform:"none",borderRadius:"4px",fontSize:"12px",fontWeight:600,px:1,py:.5,color:"#111928",minWidth:0,"&:hover":{backgroundColor:"#f3f4f6"}},children:"Add First Scan Type"})]})})]})};je.propTypes={service:c.shape({serviceId:c.oneOfType([c.string,c.number]).isRequired,serviceName:c.string.isRequired,serviceCode:c.string,description:c.string,categoryId:c.oneOfType([c.string,c.number]),categoryName:c.string,entityState:c.string,entityStateName:c.string,scanTypes:c.arrayOf(c.shape({scanTypeId:c.oneOfType([c.string,c.number]).isRequired,name:c.string.isRequired,description:c.string,durationMinutes:c.number.isRequired,requiresDedicatedTechnician:c.bool,isComplex:c.bool,isGenderSensitive:c.bool,entityState:c.string,entityStateName:c.string}))}).isRequired,onAddScan:c.func.isRequired,onDeleteService:c.func.isRequired,onDeleteScanType:c.func.isRequired,onEditService:c.func,onEditScanType:c.func,onStatusChange:c.func};const Ce=({open:i,onClose:s,onSubmit:d,mode:c="add",initialData:u=null,categories:p=[],clinicId:x})=>{const m="edit"===c,h=f(),b=!((null==h?void 0:h.role)===q.CLINIC_STAFF_MEMBER)||"add"===c,v=e.useMemo(()=>function(e=!1){const i={serviceName:g().required("Service Name is required."),description:g().required("Description is required."),serviceCode:g().notRequired()};return e||(i.categoryId=g().required("Category is required.")),y().shape(i)}(m),[m]),j=e.useMemo(()=>function(e=!1,i=null){return e&&i?{serviceId:i.serviceId||"",serviceName:i.serviceName||"",categoryId:i.categoryId||"",categoryName:i.categoryName||"",clinicId:i.clinicId||"",clinicName:i.clinicName||"",description:i.description||"",serviceCode:i.serviceCode||""}:{categoryId:"",serviceName:"",description:"",serviceCode:""}}(m,u),[m,u]),S=()=>({title:m?"Edit Service":"Create New Service",submitLabel:m?"Update Service":"Create Service"});return a.jsx(C,{initialValues:j,validationSchema:v,onSubmit:async(e,{resetForm:i})=>{var a,t,n;if(m)d({...e,serviceName:e.serviceName.trim(),serviceCode:e.serviceCode}),i(),s();else try{const a={...e,serviceName:e.serviceName.trim(),clinicId:x,serviceCode:e.serviceCode},t=await w.post("https://healthco.clinic/api/api/services",a);R.success("Service added successfully!"),i(),s(),d(t.data)}catch(r){if(400===(null==(a=r.response)?void 0:a.status)||500===(null==(t=r.response)?void 0:t.status)){let e="Failed to add service";(null==(n=r.response)?void 0:n.data)?"string"==typeof r.response.data?e=r.response.data:r.response.data.detail?e=r.response.data.detail:r.response.data.message?e=r.response.data.message:r.response.data.title&&(e=r.response.data.title):e=r.message||"Failed to add service",R.error(e)}else R.error("Failed to add service. Please try again.")}},enableReinitialize:!0,validateOnMount:!1,validateOnBlur:!0,validateOnChange:!0,children:({values:e,errors:d,touched:u,handleChange:f,handleBlur:y,handleSubmit:h,isValid:g,dirty:v,isSubmitting:j,resetForm:C,submitCount:w})=>a.jsxs(I,{open:i,onClose:()=>{C(),s()},title:S().title,onSubmit:h,submitLabel:S().submitLabel,disableSubmit:j||"edit"!==c&&null==x||w>0&&!g,showActions:b,customActions:b?void 0:a.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",gap:1.5,mt:1},children:a.jsx(k,{onClick:()=>{C(),s()},sx:{textTransform:"none",color:"#6b7280",borderRadius:"8px",px:3,py:1.5,"&:hover":{backgroundColor:"rgba(59, 130, 246, 0.1)",color:"#2563eb"}},children:"Close"})}),children:[a.jsx(T,{label:"Service Name",required:!0,placeholder:"e.g., X-ray, Ultrasound, MRI",value:e.serviceName,onChange:f,onBlur:y,name:"serviceName",error:(u.serviceName||w>0)&&d.serviceName}),a.jsx(T,{label:"Service Code",placeholder:"e.g., XRAY-01",value:e.serviceCode,onChange:f,onBlur:y,name:"serviceCode",error:(u.serviceCode||w>0)&&d.serviceCode}),a.jsx(T,{label:"Category",required:!m,error:(u.categoryId||w>0)&&d.categoryId,children:m?a.jsx(l,{fullWidth:!0,value:e.categoryName,disabled:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#f3f4f6"}}}):a.jsx(n,{fullWidth:!0,error:Boolean((u.categoryId||w>0)&&d.categoryId),children:a.jsxs(r,{id:"categoryId",name:"categoryId",value:e.categoryId,onChange:f,onBlur:y,displayEmpty:!0,sx:{borderRadius:"8px",backgroundColor:"#ffffff"},children:[a.jsx(o,{value:"",disabled:!0,children:a.jsx("span",{style:{color:"#9ca3af"},children:"Select a Category"})}),p.map(e=>a.jsx(o,{value:e.categoryId,children:e.categoryName},e.categoryId))]})})}),a.jsx(T,{label:"Description",required:!0,multiline:!0,rows:4,placeholder:"Brief description of this service",value:e.description,onChange:f,onBlur:y,name:"description",error:(u.description||w>0)&&d.description})]})})};Ce.propTypes={open:c.bool.isRequired,onClose:c.func.isRequired,onSubmit:c.func.isRequired,mode:c.oneOf(["add","edit"]),initialData:c.object,clinicId:function(e,i,a){return"edit"===e.mode||void 0!==e[i]&&null!==e[i]?void 0!==e[i]&&"string"!=typeof e[i]&&"number"!=typeof e[i]?new Error(`Invalid prop \`${i}\` of type \`${typeof e[i]}\` supplied to \`${a}\`, expected \`string\` or \`number\`.`):void 0:new Error(`Invalid prop \`${i}\` supplied to \`${a}\`. \`${i}\` is required when mode is 'add'.`)},categories:c.arrayOf(c.shape({categoryId:c.oneOfType([c.string,c.number]).isRequired,categoryName:c.string.isRequired}))};const Ie=()=>{const e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}},Te=e=>Array.isArray(e)?e.map(e=>({...e,scanTypes:(e.scanTypes||[]).sort((e,i)=>(parseInt(e.scanTypeId)||0)-(parseInt(i.scanTypeId)||0))})):e,Se=()=>{const{selectedClinicId:i,clinicList:n,loadingClinics:r,clinicError:o}=z(),[l,d]=e.useState({}),[c,u]=e.useState(!1),[p,x]=e.useState([]),[m,f]=e.useState(!1),[y,h]=e.useState(!1),[g,b]=e.useState(null),[v,j]=e.useState("add"),[C,I]=e.useState(null),[T,S]=e.useState(null),[k,q]=e.useState({open:!1,serviceId:null,serviceName:""}),[D,M]=e.useState({open:!1,scanTypeId:null,scanTypeName:"",serviceId:null}),H=e=>{S(e)},_=async(e,i)=>{var a;try{const t=await w.get(`https://healthco.clinic/api/api/scantypes/${e.scanTypeId}`,{headers:Ie()}),s=(null==(a=null==t?void 0:t.data)?void 0:a.value)??(null==t?void 0:t.data);I({...s,serviceId:i})}catch(t){I({...e,serviceId:i})}finally{j("edit"),b(i),h(!0)}};e.useEffect(()=>{(async()=>{if(i)try{const e=await w.get(`https://healthco.clinic/api/api/categories/GetCategoriesByClinicId/${i}`,{headers:Ie()});x(e.data)}catch(e){}})()},[i]),e.useEffect(()=>{(async()=>{if(i){f(!0);try{const e=await w.get(`https://healthco.clinic/api/api/services/clinic/${i}`,{headers:Ie()});d(a=>({...a,[i]:Te(e.data)}))}catch(e){R.error("Failed to load services")}finally{f(!1)}}})()},[i]);const Q=()=>(l[i]||[]).sort((e,i)=>e.serviceName.localeCompare(i.serviceName)),W=e=>{b(e),j("add"),I(null),h(!0)},F=()=>{h(!1),b(null),j("add"),I(null)},P=async(e,a,t)=>{if("service"===e&&i)try{f(!0);const e=await w.get(`https://healthco.clinic/api/api/services/clinic/${i}`,{headers:Ie()});d(a=>({...a,[i]:Te(e.data)}))}catch(s){}finally{f(!1)}};return a.jsxs(t,{children:[a.jsx(E,{icon:N.Services,title:"Service Management",description:"Manage diagnostic services and scan types",clinics:n,selectedClinicId:i,addButtonLabel:"Add New Service",onAdd:()=>u(!0),addButtonDisabled:!i,loadingClinics:r,clinicError:o}),o&&a.jsx(s,{variant:"caption",color:"error",children:o}),i&&m&&0===Q().length&&a.jsx(A,{}),i&&!m&&0===Q().length&&a.jsx(O,{message:"No services found"}),a.jsx(G,{children:!m&&Q().map(e=>a.jsx(je,{service:e,onAddScan:W,onDeleteService:()=>{return i=e.serviceId,a=e.serviceName,void q({open:!0,serviceId:i,serviceName:a});var i,a},onDeleteScanType:(i,a)=>((e,i,a)=>{M({open:!0,scanTypeId:e,scanTypeName:a,serviceId:i})})(i,e.serviceId,a),onEditService:H,onEditScanType:_,onStatusChange:P},e.serviceId))}),a.jsx(Ce,{mode:"add",open:c,onClose:()=>u(!1),onSubmit:async e=>{var a;if(!i||!e)return;let t=e.serviceId||e.id;const s=(null==(a=p.find(i=>i.categoryId===e.categoryId))?void 0:a.categoryName)||"Unknown Category",n={...e,serviceId:t,categoryName:s,scanTypes:(e.scanTypes||[]).sort((e,i)=>(parseInt(e.scanTypeId)||0)-(parseInt(i.scanTypeId)||0))};if(t)d(e=>({...e,[i]:[...e[i]||[],n]})),u(!1);else try{const e=await w.get(`https://healthco.clinic/api/api/services/clinic/${i}`,{headers:Ie()});d(a=>({...a,[i]:Te(e.data)})),u(!1)}catch(r){R.error("Service added, but failed to refresh list. Please reload manually.")}},categories:p,clinicId:i}),y&&a.jsx(ve,{open:y,onClose:F,onSubmit:async e=>{if("add"===v){let t=(null==e?void 0:e.scanTypeId)||(null==e?void 0:e.id);if(t)d(a=>{const s=a[i].map(i=>i.serviceId===g?{...i,scanTypes:[...i.scanTypes||[],{...e,scanTypeId:t}].sort((e,i)=>(parseInt(e.scanTypeId)||0)-(parseInt(i.scanTypeId)||0))}:i);return{...a,[i]:s}}),F();else try{const e=await w.get(`https://healthco.clinic/api/api/services/clinic/${i}`,{headers:Ie()});d(a=>({...a,[i]:Te(e.data)})),F()}catch(a){R.error("Scan type added, but failed to refresh list. Please reload manually."),F()}}else if("edit"===v)try{if(!(null==e?void 0:e.scanTypeId))return void R.warn("Missing Scan Type ID");const{preQualifyingQuestions:a,...t}=e||{},s={...t},n=await fetch(`https://healthco.clinic/api/api/scantypes/${e.scanTypeId}`,{method:"PUT",headers:{"Content-Type":"application/json",...Ie()},body:JSON.stringify(s)});if(200!==n.status&&204!==n.status){let e="Failed to update scan type";try{const i=await n.json();e=i.detail||i.message||i.title||`Failed to update scan type (${n.status})`}catch{e=await n.text()||`Failed to update scan type (${n.status})`}throw new Error(e)}d(a=>{const t=a[i].map(i=>i.serviceId===e.serviceId?{...i,scanTypes:i.scanTypes.map(i=>i.scanTypeId===e.scanTypeId?{...i,...e}:i).sort((e,i)=>(parseInt(e.scanTypeId)||0)-(parseInt(i.scanTypeId)||0))}:i);return{...a,[i]:t}}),R.success("Scan type updated successfully"),F()}catch(a){R.error(a.message)}},serviceId:g,initialData:C,mode:v}),T&&a.jsx(Ce,{mode:"edit",open:!!T,initialData:T,onClose:()=>S(null),onSubmit:async e=>{try{if(!(null==e?void 0:e.serviceId))return void R.error("Cannot update service: Missing Service ID");const a=await fetch(`https://healthco.clinic/api/api/services/${e.serviceId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){let e="Failed to update service";try{const i=await a.json();e=i.detail||i.message||i.title||"Failed to update service"}catch{e=await a.text()||"Failed to update service"}throw new Error(e)}d(a=>{const t=a[i].map(i=>{var a;if(i.serviceId===e.serviceId){let t=e.categoryName;return e.categoryId&&e.categoryId!==i.categoryId&&(t=(null==(a=p.find(i=>i.categoryId===e.categoryId))?void 0:a.categoryName)||"Unknown Category"),{...i,...e,categoryName:t||i.categoryName}}return i});return{...a,[i]:t}}),R.success(" Service updated successfully"),S(null)}catch(a){R.error(a.message)}}}),a.jsx(B,{open:k.open,onClose:()=>{q({open:!1,serviceId:null,serviceName:""})},onConfirm:async()=>{var e,a,t;try{await w.delete(`https://healthco.clinic/api/api/services/${k.serviceId}`,{headers:Ie()}),d(e=>({...e,[i]:e[i].filter(e=>e.serviceId!==k.serviceId)})),R.success("Service deleted successfully"),q({open:!1,serviceId:null,serviceName:""})}catch(s){if(400===(null==(e=s.response)?void 0:e.status)||500===(null==(a=s.response)?void 0:a.status)){let e="Failed to delete service";(null==(t=s.response)?void 0:t.data)?"string"==typeof s.response.data?e=s.response.data:s.response.data.detail?e=s.response.data.detail:s.response.data.message?e=s.response.data.message:s.response.data.title&&(e=s.response.data.title):e=s.message||"Failed to delete service","string"==typeof e&&(e.includes("active ScanTypes")||e.includes("cannot be deleted because it has active ScanTypes"))?R.error("Cannot delete service: Please delete all scan types first before deleting the service."):R.error(e)}else R.error("Failed to delete service. Please try again.");q({open:!1,serviceId:null,serviceName:""})}},title:"Delete Service",message:`Are you sure you want to delete the service "${k.serviceName}"? This will also delete all associated scan types. This action cannot be undone. To confirm, type DELETE below.`}),a.jsx(B,{open:D.open,onClose:()=>{M({open:!1,scanTypeId:null,scanTypeName:"",serviceId:null})},onConfirm:async()=>{var e,a,t;try{await w.delete(`https://healthco.clinic/api/api/scanTypes/${D.scanTypeId}`,{headers:Ie()}),d(e=>{const a=e[i].map(e=>e.serviceId===D.serviceId?{...e,scanTypes:e.scanTypes.filter(e=>e.scanTypeId!==D.scanTypeId)}:e);return{...e,[i]:a}}),R.success("Scan type deleted successfully"),M({open:!1,scanTypeId:null,scanTypeName:"",serviceId:null})}catch(s){if(400===(null==(e=s.response)?void 0:e.status)||500===(null==(a=s.response)?void 0:a.status)){let e="Failed to delete scan type";(null==(t=s.response)?void 0:t.data)?"string"==typeof s.response.data?e=s.response.data:s.response.data.detail?e=s.response.data.detail:s.response.data.message?e=s.response.data.message:s.response.data.title&&(e=s.response.data.title):e=s.message||"Failed to delete scan type",R.error(e)}else R.error("Failed to delete scan type");M({open:!1,scanTypeId:null,scanTypeName:"",serviceId:null})}},title:"Delete Scan Type",message:`Are you sure you want to delete the scan type "${D.scanTypeName}"? This action cannot be undone. To confirm, type DELETE below.`}),i&&Q().length>0&&a.jsxs(t,{sx:{mt:3,p:2,borderRadius:"8px",backgroundColor:"#f9fafb",border:"1px solid #e5e7eb"},children:[a.jsx(s,{sx:{fontWeight:600,fontSize:"14px",color:"#111928",mb:1.5},children:"Scan Type Tags"}),a.jsxs(t,{sx:{display:"flex",flexWrap:"wrap",gap:2,alignItems:"center"},children:[a.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(t,{sx:{px:1,py:.5,borderRadius:2,backgroundColor:"#fef3c7",color:"#92400e",fontSize:"0.7rem",fontWeight:600},children:"DT"}),a.jsx(s,{sx:{fontSize:"13px",color:"#6b7280"},children:"Dedicated Technician"})]}),a.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(t,{sx:{px:1,py:.5,borderRadius:2,backgroundColor:"#fce7f3",color:"#9f1239",fontSize:"0.7rem",fontWeight:600},children:"CS"}),a.jsx(s,{sx:{fontSize:"13px",color:"#6b7280"},children:"Complex Scan"})]}),a.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(t,{sx:{px:1,py:.5,borderRadius:2,backgroundColor:"#dbeafe",color:"#1e40af",fontSize:"0.7rem",fontWeight:600},children:"GS"}),a.jsx(s,{sx:{fontSize:"13px",color:"#6b7280"},children:"Gender Sensitive"})]})]})]})]})};export{Se as default};
