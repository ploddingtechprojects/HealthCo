import{u as e,R as s,j as a,F as i,c as r,G as n,A as t,S as l,I as o,O as d,a as c,b as m,d as h,T as u,L as p,B as x,e as j,f as g,g as w,D as b,h as v,i as f,k as y,C,l as A,m as S,U as k,y as I,P as D}from"./index-DyR0ftVW.js";import{A as E}from"./AuthWrapper-GYASWwfi.js";import{C as P}from"./CommonCheckbox-aJ2wZ0C8.js";import{E as z,a as W,A as M}from"./EyeOutlined-CkyY2bNd.js";import{U as B}from"./UserOutlined-B3a180eP.js";import{I as F}from"./InputAdornment-BBfdgTpM.js";import{D as L}from"./DialogActions-BmwBtQrJ.js";function T({isDemo:D=!1}){const E=e(),[T,N]=s.useState(!1),[q,O]=s.useState(!1),[R,G]=s.useState(!1),[U,V]=s.useState(null),[_,H]=s.useState(!1),[$,J]=s.useState(""),[K,Q]=s.useState(""),[X,Y]=s.useState(""),[Z,ee]=s.useState(!1),se=()=>{O(!q)},ae=e=>{e.preventDefault()};return a.jsxs(a.Fragment,{children:[a.jsx(i,{initialValues:{email:"",password:"",submit:null},validationSchema:r().shape({email:w({requiredMessage:"Email is required",invalidMessage:"Must be a valid email"}).max(255),password:g().required("Password is required").test("no-leading-trailing-whitespace","Password cannot start or end with spaces",e=>e===(null==e?void 0:e.trim())).min(6,"Password must be at least 6 characters").max(50,"Password must be less than 50 characters")}),onSubmit:async(e,{setSubmitting:s})=>{var a,i,r;try{G(!0),V(null);const s=await A(e.email,e.password);if(s.success){const e=s.data,i=e.role||(null==(a=e.userRoles)?void 0:a[0])||"";switch(setTimeout(()=>{},100),i){case k.GLOBAL_ADMIN:case"GlobalAdmin":case k.CLINIC_ADMIN:case"ClinicAdmin":case k.CLINIC:case"Clinic":E("/dashboard/default");break;case k.TECHNICIAN:case"Technician":E("/calendar-view-technician");break;default:E("/dashboard/default")}I.success("Login successful!")}else V(s.errorMessage||"Invalid user credentials!")}catch(n){V((null==(r=null==(i=n.response)?void 0:i.data)?void 0:r.message)||n.message||"Authentication failed. Please try again.")}finally{G(!1),s(!1)}},children:({errors:e,handleBlur:s,handleChange:i,handleSubmit:r,touched:g,values:w,isSubmitting:b})=>a.jsx("form",{noValidate:!0,onSubmit:r,children:a.jsxs(n,{container:!0,spacing:3,children:[U&&a.jsx(n,{size:12,children:a.jsx(t,{severity:"error",sx:{mb:2},children:U})}),a.jsxs(n,{size:12,children:[a.jsxs(l,{sx:{gap:1},children:[a.jsx(o,{htmlFor:"email-login",children:"Email Address"}),a.jsx(d,{id:"email-login",type:"email",value:w.email,name:"email",onBlur:s,onChange:i,placeholder:"Enter email address",fullWidth:!0,error:Boolean(g.email&&e.email),startAdornment:a.jsx(F,{position:"start",children:a.jsx(B,{})})})]}),g.email&&e.email&&a.jsx(c,{error:!0,id:"standard-weight-helper-text-email-login",children:e.email})]}),a.jsxs(n,{size:12,children:[a.jsxs(l,{sx:{gap:1},children:[a.jsx(o,{htmlFor:"password-login",children:"Password"}),a.jsx(d,{fullWidth:!0,error:Boolean(g.password&&e.password),id:"password-login",type:q?"text":"password",value:w.password,name:"password",onBlur:s,onChange:i,endAdornment:a.jsx(F,{position:"end",children:a.jsx(m,{"aria-label":"toggle password visibility",onClick:se,onMouseDown:ae,edge:"end",color:"secondary",children:q?a.jsx(z,{}):a.jsx(W,{})})}),placeholder:"Enter password"})]}),g.password&&e.password&&a.jsx(c,{error:!0,id:"standard-weight-helper-text-password-login",children:e.password})]}),a.jsx(n,{sx:{mt:-1},size:12,children:a.jsxs(l,{direction:"row",sx:{gap:2,alignItems:"baseline",justifyContent:"space-between",flexWrap:"wrap"},children:[a.jsx(h,{control:a.jsx(P,{checked:T,onChange:e=>N(e.target.checked),name:"checked",color:"primary",size:"small"}),label:a.jsx(u,{variant:"h6",children:"Remember me"})}),a.jsx(p,{variant:"h6",component:"button",type:"button",onClick:e=>{e.preventDefault(),H(!0)},color:"primary",sx:{textDecoration:"none",background:"none",border:"none",cursor:"pointer","&:hover":{textDecoration:"underline"}},children:"Forgot Password?"})]})}),a.jsx(n,{size:12,children:a.jsx(M,{children:a.jsx(x,{disableElevation:!0,disabled:R,fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"primary",children:R?a.jsx(j,{}):"Sign in"})})})]})})}),a.jsxs(b,{open:_,onClose:()=>H(!1),maxWidth:"sm",fullWidth:!0,sx:{"& .MuiDialog-paper":{minWidth:500,padding:2}},children:[a.jsx(v,{children:"Forgot Password"}),a.jsxs(f,{children:[a.jsx(u,{variant:"body2",sx:{mb:1},children:"Enter your email address to receive a password reset link."}),a.jsx(y,{autoFocus:!0,fullWidth:!0,label:"Email Address",type:"email",value:$,onChange:e=>J(e.target.value),margin:"normal"}),K&&a.jsx(t,{severity:"error",sx:{mt:1},children:K}),X&&a.jsx(t,{severity:"success",sx:{mt:1},children:X})]}),a.jsxs(L,{children:[a.jsx(x,{onClick:()=>H(!1),color:"secondary",children:"Cancel"}),a.jsx(x,{onClick:async()=>{var e,s;if(ee(!0),Q(""),Y(""),!$||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test($))return Q("Please enter a valid email address."),void ee(!1);try{const e=(await S.post("https://healthco.clinic/api/api/account/forgot-password",{email:$})).data;Y((null==e?void 0:e.value)||"A reset link has been sent to your registered email."),setTimeout(()=>{H(!1),J("")},3e3)}catch(a){const i=null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.detail;Y(i||"If an account with that email exists, a password reset link has been sent."),setTimeout(()=>{H(!1),J("")},3e3)}finally{ee(!1)}},color:"primary",variant:"contained",disabled:Z||!$,children:Z?a.jsx(C,{size:20}):"Send Reset Link"})]})]})]})}function N(){return a.jsx(E,{children:a.jsx(n,{container:!0,spacing:3,children:a.jsx(n,{size:12,children:a.jsx(T,{})})})})}T.propTypes={isDemo:D.bool};export{N as default};
