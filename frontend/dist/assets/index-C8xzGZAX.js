import{m as e,r as t,c as a,f as i,V as n,X as r,j as s,F as o,am as c,G as l,ac as d,k as m,T as u,P as g,af as h,ag as y,ah as p,ai as C,S as x,ak as j,e as f,p as w,al as E,y as I}from"./index-DyR0ftVW.js";import{D as b}from"./DeleteConfirmationDialog-DKqJK7p7.js";import{u as v}from"./useClinicSync-pPWROp7F.js";import{formatDateISO as N}from"./appointmentLogic-ihgp36Gl.js";import{T as S}from"./TableWithSearchAndPagination-DhcMeN2g.js";import{T as A}from"./Tooltip-Cof9Jr1h.js";import{R as T,a as D}from"./EditOutlined-CjO-a_sD.js";import{M as F}from"./ManagementHeader-ym6m9w7H.js";import"./WarningOutlined-Pm6jC2mV.js";import"./AntdIcon-2OxomVw-.js";import"./DialogActions-BmwBtQrJ.js";import"./InputAdornment-BBfdgTpM.js";const L="https://healthco.clinic/api/api/categories",k=()=>{const e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}},B=e=>{const{data:t}=e;if(!t.success&&void 0!==t.success)throw new Error(t.message||"An error occurred");return t},P=e=>{var t;if(e.response){const a=(null==(t=e.response.data)?void 0:t.message)||e.response.statusText;throw new Error(a)}throw e.request?new Error("No response received from server"):e},q=async t=>{try{const a=await e.get(`https://healthco.clinic/api/api/categories/GetCategoriesByClinicId/${t}`,{headers:k()});return a.data.map(e=>({id:e.categoryId,name:e.categoryName,clinicId:e.clinicId,clinicName:e.clinicName,createdAt:N(new Date(e.createdOn)).split("T")[0]}))}catch(a){throw P(a)}},O=async t=>{try{const a=await e.post(L,t,{headers:k()});return B(a)}catch(a){throw P(a)}},W=async(t,a)=>{try{const i=await e.put(`${L}/${t}`,{id:t,...a},{headers:k()});return B(i)}catch(i){throw P(i)}},$=async t=>{try{const a=await e.delete(`${L}/${t}`,{headers:k()});return B(a)}catch(a){throw P(a)}},M=()=>{const[e,a]=t.useState([]),[i,n]=t.useState(!0),[r,s]=t.useState(null),o=t.useCallback(async()=>{try{n(!0),s(null);const e=await q(0);a(e)}catch(e){s(e.message)}finally{n(!1)}},[]);t.useEffect(()=>{o()},[o]);return{categories:e,loading:i,error:r,createCategory:async e=>{try{n(!0),s(null);const t=await O(e);return await o(),t}catch(t){throw s(t.message),t}finally{n(!1)}},deleteCategory:async e=>{try{n(!0),s(null),await $(e),await o()}catch(t){throw s(t.message),t}finally{n(!1)}},updateCategory:async(e,t)=>{try{n(!0),s(null);const a=await W(e,t);return await o(),a}catch(a){throw s(a.message),a}finally{n(!1)}},refetch:o}},V=({open:e,onClose:g,onCategoryAdded:h,categoryToEdit:y,isEditing:p,onCancelEdit:C,selectedClinicId:x,selectedClinicName:j})=>{const[f,w]=t.useState(""),[E,I]=t.useState({isValid:!1,isDirty:!1,isSubmitting:!1}),{categories:b}=M(),v=t.useMemo(()=>a().shape({name:i().required("Category name is required").min(2,"Category name must be at least 2 characters").max(50,"Category name must not exceed 50 characters")}),[]),N=t.useMemo(()=>{var e;return y?{clinicId:(null==(e=y.clinicId)?void 0:e.toString())||"",clinicName:y.clinicName||"",name:y.name||""}:{clinicId:x||"",clinicName:j||"",name:""}},[y,x,j]),S=n(),A=r(S.breakpoints.down("sm"));return s.jsx(o,{initialValues:N,validationSchema:v,onSubmit:async(e,{resetForm:t,setFieldError:a})=>{try{w("");const i=p?e.clinicId:x;if(!i)return void a("clinicId","Clinic is required");const n=(e.name||"").trim();if(b.find(e=>e.name.toLowerCase()===n.toLowerCase()&&e.clinicId===parseInt(i)&&(!p||e.id!==(null==y?void 0:y.id))))return void a("name","Category name already exists for this clinic");await h({clinicId:parseInt(i),categoryName:n}),t(),g&&g()}catch(i){i&&i.fieldErrors&&"function"==typeof a?Object.entries(i.fieldErrors).forEach(([e,t])=>{a(e,t)}):w((null==i?void 0:i.message)||`Failed to ${p?"update":"create"} category`)}},enableReinitialize:!0,validateOnMount:!1,validateOnBlur:!0,validateOnChange:!0,children:({errors:a,handleBlur:i,handleChange:n,handleSubmit:r,isSubmitting:o,touched:h,values:y,isValid:j,dirty:E,resetForm:b,submitCount:v,setFieldError:N})=>{t.useEffect(()=>{I({isValid:j,isDirty:E,isSubmitting:o})},[j,E,o]);const S=e=>(h[e]||v>0)&&Boolean(a[e]);return s.jsx(c,{open:e,onClose:()=>(e=>{w(""),e(),C&&C(),g&&g()})(b),title:p?"Edit Category":"Add Category",onSubmit:r,submitLabel:o?p?"Updating...":"Adding...":p?"Update Category":"Add Category",disableSubmit:o||!(p?y.clinicId:x)||v>0&&!j,showActions:!0,maxWidth:"sm",customWidth:A?void 0:"500px",children:s.jsx("form",{noValidate:!0,children:s.jsxs(l,{container:!0,direction:"row",alignItems:"flex-start",justifyContent:"center",spacing:1,sx:{mt:1},children:[s.jsx(l,{item:!0,xs:12,sm:8,md:6,lg:5,xl:4,sx:{width:"100%",maxWidth:220},children:s.jsx(d,{label:"Clinic Name",required:!0,sx:{mb:1},children:s.jsx(m,{id:"clinicName",name:"clinicName",value:y.clinicName||"",disabled:!0,fullWidth:!0})})}),s.jsx(l,{item:!0,xs:12,sm:8,md:6,lg:5,xl:4,sx:{width:"100%",maxWidth:220},children:s.jsx(d,{label:"Category Name",required:!0,error:S("name"),helperText:S("name")?a.name:"",sx:{mb:1},children:s.jsx(m,{id:"name",name:"name",value:y.name,onBlur:i,onChange:n,placeholder:"Enter category name",fullWidth:!0,error:S("name"),helperText:S("name")?a.name:""})})}),f&&s.jsx(l,{item:!0,xs:12,sx:{mt:1},children:s.jsx(u,{color:"error",variant:"body2",align:"center",children:f})})]})})})}})};V.propTypes={open:g.bool,onClose:g.func,onCategoryAdded:g.func.isRequired,categoryToEdit:g.object,isEditing:g.bool,onCancelEdit:g.func,selectedClinicId:g.oneOfType([g.string,g.number]),selectedClinicName:g.string},V.defaultProps={isEditing:!1,open:!1,onClose:void 0,selectedClinicId:"",selectedClinicName:""};const R=({categories:e,onEdit:t,onDelete:a})=>{const i=e=>{t&&t(e)};return s.jsx(S,{data:e,customFilter:(e,t)=>e.name.toLowerCase().includes(t)||e.createdAt.includes(t)||e.clinicName&&e.clinicName.toLowerCase().includes(t),searchPlaceholder:"Search categories...",totalLabel:"Total Categories",defaultRowsPerPage:5,children:({paginatedData:e,page:t,rowsPerPage:n})=>s.jsxs(s.Fragment,{children:[s.jsx(h,{children:s.jsxs(y,{children:[s.jsx(p,{children:"S.No"}),s.jsx(p,{children:"Clinic Name"}),s.jsx(p,{children:"Category Name"}),s.jsx(p,{children:"Created Date"}),s.jsx(p,{align:"center",children:"Actions"})]})}),s.jsx(C,{children:0===e.length?s.jsx(y,{children:s.jsx(p,{colSpan:5,align:"center",children:"No categories found"})}):e.map((e,r)=>s.jsxs(y,{hover:!0,sx:{cursor:"pointer"},onClick:()=>i(e),children:[s.jsx(p,{children:t*n+r+1}),s.jsx(p,{children:e.clinicName||"N/A"}),s.jsx(p,{children:e.name}),s.jsx(p,{children:e.createdAt}),s.jsx(p,{align:"center",onClick:e=>e.stopPropagation(),children:s.jsxs(x,{direction:"row",justifyContent:"center",spacing:0,children:[s.jsx(A,{title:"Edit",children:s.jsx(j,{color:"primary",onClick:()=>i(e),children:s.jsx(T,{})})}),s.jsx(A,{title:"Delete",children:s.jsx(j,{color:"error",onClick:()=>a(e.id,e.name),children:s.jsx(D,{})})})]})})]},e.id))})]})})};R.propTypes={categories:g.array.isRequired,onEdit:g.func,onDelete:g.func};const z=()=>{var e;const{categories:a,loading:i,error:n,createCategory:r,deleteCategory:o,updateCategory:c,refetch:l}=M(),{selectedClinicId:d,clinicList:m,loadingClinics:u,clinicError:g}=v(),[h,y]=t.useState(null),[p,C]=t.useState(!1),[x,j]=t.useState(!1),[N,S]=t.useState({open:!1,categoryId:null,categoryName:"",loading:!1}),A=()=>{y(null),C(!1)};return i||u?s.jsx(f,{}):n?s.jsxs("div",{children:["Error: ",n]}):s.jsxs(w,{children:[s.jsx(F,{icon:E.Categories,title:"Category Management",description:"Manage your categories efficiently with our intuitive interface",clinics:m,selectedClinicId:d,onClinicChange:e=>{},addButtonLabel:"Add Category",onAdd:()=>{y(null),C(!1),j(!0)},addButtonDisabled:!d,loadingClinics:u,clinicError:g}),s.jsx(V,{open:x||p,onClose:()=>{j(!1),A()},onCategoryAdded:async e=>{await(async e=>{try{p?(await c(h.id,e),I.success("Category updated successfully!")):(await r(e),I.success("Category created successfully!")),y(null),C(!1),await l()}catch(t){throw t}})(e),j(!1)},categoryToEdit:h,isEditing:p,onCancelEdit:()=>{A(),j(!1)},selectedClinicId:d,selectedClinicName:(null==(e=m.find(e=>e.id===parseInt(d)))?void 0:e.name)||""}),s.jsx(w,{sx:{mt:3},children:s.jsx(R,{categories:d?a.filter(e=>e.clinicId===parseInt(d)):a,onEdit:e=>{y(e),C(!0),j(!0)},onDelete:(e,t)=>{S({open:!0,categoryId:e,categoryName:t})}})}),s.jsx(b,{open:N.open,onClose:()=>{S({open:!1,categoryId:null,categoryName:"",loading:!1})},onConfirm:async()=>{var e,t;try{S(e=>({...e,loading:!0})),await o(N.categoryId),I.success("Category deleted successfully!"),S({open:!1,categoryId:null,categoryName:"",loading:!1})}catch(a){const i=(null==(t=null==(e=null==a?void 0:a.response)?void 0:e.data)?void 0:t.detail)||(null==a?void 0:a.message)||"Failed to delete category!";I.error(i),S({open:!1,categoryId:null,categoryName:"",loading:!1})}},loading:N.loading,title:"Delete Category",message:`Are you sure you want to delete the category "${N.categoryName}"? This action cannot be undone. To confirm, type DELETE below.`})]})};export{z as default};
